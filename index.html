<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novan Agency | Painel Futurista</title>
    <!-- Carrega Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!-- Carrega html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        setTimeout(() => {
            if (typeof tailwind !== 'undefined') {
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                'novan-bg': '#020617',     /* Slate 950 - Fundo Profundo */
                                'novan-card': '#0f172a',   /* Slate 900 - Cards */
                                'novan-primary': '#06b6d4', /* Cyan 500 - Acento Principal Futurista */
                                'novan-hover': '#0891b2',   /* Cyan 600 */
                                'novan-secondary': '#1e293b', /* Slate 800 */
                                'novan-light': '#f8fafc',
                            },
                            fontFamily: {
                                sans: ['Poppins', 'sans-serif'],
                            },
                            boxShadow: {
                                'neon': '0 0 10px rgba(6, 182, 212, 0.5), 0 0 20px rgba(6, 182, 212, 0.3)',
                                'neon-pink': '0 0 10px rgba(236, 72, 153, 0.5), 0 0 20px rgba(236, 72, 153, 0.3)',
                            }
                        }
                    }
                }
            }
        }, 0);
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #020617; /* Fundo muito escuro */
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 70%); /* Gradiente sutil */
            color: #e2e8f0;
            scroll-behavior: smooth;
        }

        /* Scrollbar Futurista */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #020617; 
        }
        ::-webkit-scrollbar-thumb {
            background: #1e293b; 
            border-radius: 4px;
            border: 1px solid #0f172a;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #06b6d4; 
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); filter: blur(4px); }
            to { opacity: 1; transform: translateY(0); filter: blur(0); }
        }

        /* Sidebar Item - Estilo Caixinha Animada (Novo) */
        .sidebar-item {
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 0.75rem;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(51, 65, 85, 0.4); /* Slate 700 / Transparente */
            background: rgba(15, 23, 42, 0.4); /* Slate 900 / Vidro */
            padding: 10px 14px;
            display: flex;
            align-items: center;
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        /* Anima√ß√£o dos √çcones Base (Evolu√≠do para Emojis Animados) */
        .sidebar-item .menu-emoji {
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: inline-block;
            font-size: 1.3rem;
            margin-right: 12px;
            filter: grayscale(0.3) drop-shadow(0 2px 4px rgba(0,0,0,0.5));
            transform-origin: center;
        }
        .sidebar-item:hover .menu-emoji {
            transform: scale(1.4) rotate(-10deg) translateY(-2px);
            filter: grayscale(0) drop-shadow(0 0 12px currentColor);
        }
        .sidebar-item.active .menu-emoji {
            transform: scale(1.25);
            filter: grayscale(0) drop-shadow(0 0 8px currentColor);
            animation: bounceEmoji 2s ease-in-out infinite;
        }

        @keyframes bounceEmoji {
            0%, 100% { transform: scale(1.25) translateY(0); }
            50% { transform: scale(1.25) translateY(-4px); }
        }

        /* T√≠tulos de Se√ß√£o (Subt√≠tulos) */
        .sidebar-header {
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 0.75rem;
            margin-top: 2rem;
            padding-left: 0.5rem;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .sidebar-header::before {
            content: '';
            display: block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: pulseHeaderDot 2s infinite;
        }
        @keyframes pulseHeaderDot {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.5); opacity: 1; }
        }

        /* THEME CYAN (Tr√°fego / Clientes) */
        .header-cyan { color: #22d3ee; }
        .header-cyan::before { background: #06b6d4; box-shadow: 0 0 8px #06b6d4; }
        .sidebar-item.theme-cyan:hover {
            border-color: rgba(6, 182, 212, 0.5);
            background: rgba(6, 182, 212, 0.1);
            color: #22d3ee;
            transform: translateX(6px) scale(1.02);
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.2), inset 0 0 10px rgba(6, 182, 212, 0.1);
        }
        .sidebar-item.theme-cyan.active {
            border-color: #06b6d4;
            background: linear-gradient(90deg, rgba(6, 182, 212, 0.2) 0%, rgba(15, 23, 42, 0) 100%);
            color: #fff;
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3), inset 0 0 12px rgba(6, 182, 212, 0.2);
        }
        .sidebar-item.theme-cyan:hover .menu-emoji, .sidebar-item.theme-cyan.active .menu-emoji { color: #06b6d4; }

        /* THEME PINK (Social) */
        .header-pink { color: #f472b6; }
        .header-pink::before { background: #ec4899; box-shadow: 0 0 8px #ec4899; }
        .sidebar-item.theme-pink:hover {
            border-color: rgba(236, 72, 153, 0.5);
            background: rgba(236, 72, 153, 0.1);
            color: #f472b6;
            transform: translateX(6px) scale(1.02);
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.2), inset 0 0 10px rgba(236, 72, 153, 0.1);
        }
        .sidebar-item.theme-pink.active {
            border-color: #ec4899;
            background: linear-gradient(90deg, rgba(236, 72, 153, 0.2) 0%, rgba(15, 23, 42, 0) 100%);
            color: #fff;
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3), inset 0 0 12px rgba(236, 72, 153, 0.2);
        }
        .sidebar-item.theme-pink:hover .menu-emoji, .sidebar-item.theme-pink.active .menu-emoji { color: #ec4899; }

        /* THEME EMERALD (Gest√£o) */
        .header-emerald { color: #34d399; }
        .header-emerald::before { background: #10b981; box-shadow: 0 0 8px #10b981; }
        .sidebar-item.theme-emerald:hover {
            border-color: rgba(16, 185, 129, 0.5);
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
            transform: translateX(6px) scale(1.02);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2), inset 0 0 10px rgba(16, 185, 129, 0.1);
        }
        .sidebar-item.theme-emerald.active {
            border-color: #10b981;
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.2) 0%, rgba(15, 23, 42, 0) 100%);
            color: #fff;
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3), inset 0 0 12px rgba(16, 185, 129, 0.2);
        }
        .sidebar-item.theme-emerald:hover .menu-emoji, .sidebar-item.theme-emerald.active .menu-emoji { color: #10b981; }

        /* THEME ORANGE (Produ√ß√£o / V√≠deos) */
        .header-orange { color: #fb923c; }
        .header-orange::before { background: #f97316; box-shadow: 0 0 8px #f97316; }
        .sidebar-item.theme-orange:hover {
            border-color: rgba(249, 115, 22, 0.5);
            background: rgba(249, 115, 22, 0.1);
            color: #fb923c;
            transform: translateX(6px) scale(1.02);
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.2), inset 0 0 10px rgba(249, 115, 22, 0.1);
        }
        .sidebar-item.theme-orange.active {
            border-color: #f97316;
            background: linear-gradient(90deg, rgba(249, 115, 22, 0.2) 0%, rgba(15, 23, 42, 0) 100%);
            color: #fff;
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3), inset 0 0 12px rgba(249, 115, 22, 0.2);
        }
        .sidebar-item.theme-orange:hover .menu-emoji, .sidebar-item.theme-orange.active .menu-emoji { color: #f97316; }

        /* THEME PURPLE (Intelig√™ncia) */
        .header-purple { color: #c084fc; }
        .header-purple::before { background: #a855f7; box-shadow: 0 0 8px #a855f7; }
        
        /* THEME RED (Logout) */
        .sidebar-item.theme-red { margin-top: 2rem; }
        .sidebar-item.theme-red:hover {
            border-color: rgba(239, 68, 68, 0.5);
            background: rgba(239, 68, 68, 0.1);
            color: #f87171;
            transform: translateX(6px) scale(1.02);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2), inset 0 0 10px rgba(239, 68, 68, 0.1);
        }
        .sidebar-item.theme-red:hover .menu-emoji { color: #ef4444; }
        
        /* Calendario Premium (Futurista e Modernizado) */
        #calendarGrid {
            gap: 12px; /* Espa√ßamento maior, mais respiro e eleg√¢ncia */
        }
        .calendar-day {
            min-height: 125px; 
            border: 1px solid rgba(51, 65, 85, 0.3);
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.6) 0%, rgba(2, 6, 23, 0.4) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 1rem; /* Borda bem arredondada (Moderno) */
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Efeito el√°stico no hover */
            color: #94a3b8;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            flex-col;
        }
        .calendar-day:hover {
            transform: translateY(-6px) scale(1.02);
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.8) 100%);
            border-color: rgba(6, 182, 212, 0.5);
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.5), 0 0 20px rgba(6, 182, 212, 0.15), inset 0 0 10px rgba(6, 182, 212, 0.05);
            z-index: 10;
        }
        
        /* Indicador do Dia Atual (Estilo HUD Visor LED) */
        .calendar-day.is-today {
            border-color: rgba(6, 182, 212, 0.8);
            background: linear-gradient(145deg, rgba(6, 182, 212, 0.05) 0%, rgba(15, 23, 42, 0.8) 100%);
            box-shadow: inset 0 0 20px rgba(6, 182, 212, 0.1);
        }
        .calendar-day.is-today::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40%;
            height: 3px;
            background: #06b6d4;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 2px 10px #06b6d4, 0 5px 20px rgba(6,182,212,0.5);
        }
        .calendar-day.is-today .day-number {
            color: #22d3ee;
            font-weight: 900;
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.6);
            font-size: 1.1rem;
        }
        
        .calendar-day.is-selected {
            border-color: #22d3ee;
            box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.4), inset 0 0 20px rgba(34, 211, 238, 0.2);
            transform: scale(1.03);
            z-index: 11;
        }

        /* Espa√ßos Vazios da Grade */
        .calendar-empty {
            min-height: 125px;
            border: 1px dashed rgba(51, 65, 85, 0.3);
            border-radius: 1rem;
            background: rgba(2, 6, 23, 0.2);
            pointer-events: none;
        }

        /* Scrollbar Interno das C√©lulas (Invis√≠vel at√© precisar) */
        .calendar-cell-scroll::-webkit-scrollbar {
            width: 3px;
        }
        .calendar-cell-scroll::-webkit-scrollbar-thumb {
            background-color: rgba(100, 116, 139, 0.3);
            border-radius: 10px;
        }
        .calendar-day:hover .calendar-cell-scroll::-webkit-scrollbar-thumb {
            background-color: rgba(6, 182, 212, 0.5);
        }
        
        /* Alpha Index Sidebar */
        .alpha-sidebar {
            position: sticky;
            top: 50%;
            transform: translateY(-50%);
            height: fit-content;
            max-height: 80vh;
            overflow-y: auto;
            animation: fadeInRightAlpha 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .alpha-sidebar::-webkit-scrollbar {
            display: none;
        }
        @keyframes fadeInRightAlpha {
            from { opacity: 0; transform: translate(20px, -50%); }
            to { opacity: 1; transform: translate(0, -50%); }
        }
        .alpha-link {
            display: block;
            text-align: center;
            font-size: 14px;
            font-weight: 800;
            color: #64748b;
            padding: 6px 4px;
            margin-bottom: 2px;
            border-radius: 6px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }
        .alpha-link:hover, .alpha-link.active {
            background-color: rgba(6, 182, 212, 0.2);
            color: #22d3ee;
            transform: scale(1.2) translateX(-4px);
            box-shadow: 0 0 12px rgba(6, 182, 212, 0.4);
        }
        
        /* Login Page */
        #login-page {
            background-color: #020617;
            position: relative;
            overflow: hidden;
        }

        #matrixCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; 
            opacity: 0.8;
        }
        
        /* Floating Pieces - Marketing Icons */
        .futuristic-piece {
            position: absolute;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: floatPiece 15s ease-in-out infinite alternate, pulsePiece 4s ease-in-out infinite;
        }

        .piece-1 { top: 15%; left: 10%; width: 70px; height: 70px; color: #06b6d4; border-color: rgba(6, 182, 212, 0.3); box-shadow: 0 0 20px rgba(6, 182, 212, 0.2); }
        .piece-2 { bottom: 20%; right: 12%; width: 90px; height: 90px; animation-delay: -2s; color: #ec4899; border-color: rgba(236, 72, 153, 0.3); box-shadow: 0 0 20px rgba(236, 72, 153, 0.2); }
        .piece-3 { top: 25%; right: 15%; width: 60px; height: 60px; animation-delay: -5s; color: #8b5cf6; border-color: rgba(139, 92, 246, 0.3); box-shadow: 0 0 20px rgba(139, 92, 246, 0.2); }
        .piece-4 { bottom: 15%; left: 20%; width: 80px; height: 80px; animation-delay: -8s; color: #10b981; border-color: rgba(16, 185, 129, 0.3); box-shadow: 0 0 20px rgba(16, 185, 129, 0.2); }

        @keyframes floatPiece {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(40px, -40px) rotate(15deg); }
        }

        @keyframes pulsePiece {
            0%, 100% { filter: drop-shadow(0 0 5px currentColor); }
            50% { filter: drop-shadow(0 0 15px currentColor); }
        }
        
        /* --- Anima√ß√µes e Estilos da Logo (Novo) --- */
        .logo-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.4);
            animation: floatLogo 3s ease-in-out infinite;
            z-index: 1;
        }
        /* Borda girat√≥ria neon */
        .logo-wrapper::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 14px;
            background: conic-gradient(from 0deg, transparent 0%, #06b6d4 25%, transparent 50%, #ec4899 75%, transparent 100%);
            z-index: -2;
            animation: spinBorder 3s linear infinite;
        }
        /* Fundo escuro interno da logo */
        .logo-wrapper::after {
            content: '';
            position: absolute;
            inset: 0px;
            border-radius: 12px;
            background: #0f172a;
            z-index: -1;
        }
        .logo-wrapper:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 0 25px rgba(6, 182, 212, 0.8);
            transition: all 0.3s ease;
        }
        /* Efeito do tra√ßado do 'N' */
        .n-path {
            stroke-dasharray: 60;
            stroke-dashoffset: 60;
            animation: dashLoop 3s ease-in-out infinite alternate;
            stroke: #22d3ee;
            filter: drop-shadow(0 0 4px #22d3ee);
        }
        @keyframes dashLoop {
            0% { stroke-dashoffset: 60; fill: transparent; }
            50% { stroke-dashoffset: 0; fill: rgba(34, 211, 238, 0.3); }
            100% { stroke-dashoffset: -60; fill: transparent; }
        }
        @keyframes floatLogo {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }
        @keyframes spinBorder {
            100% { transform: rotate(360deg); }
        }
        /* Brilho infinito no texto Novan */
        .logo-text {
            background: linear-gradient(to right, #e2e8f0 20%, #22d3ee 40%, #22d3ee 60%, #e2e8f0 80%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shineText 4s linear infinite;
        }
        @keyframes shineText {
            to { background-position: 200% center; }
        }

        /* --- Anima√ß√µes e Estilos da Logo (Login) --- */
        .login-logo-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 72px;
            height: 72px;
            border-radius: 20px;
            box-shadow: 0 0 25px rgba(6, 182, 212, 0.6);
            animation: floatLogo 3s ease-in-out infinite;
            z-index: 1;
            margin: 0 auto 1.5rem auto;
        }
        .login-logo-wrapper::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 23px;
            background: conic-gradient(from 0deg, transparent 0%, #06b6d4 25%, transparent 50%, #ec4899 75%, transparent 100%);
            z-index: -2;
            animation: spinBorder 3s linear infinite;
        }
        .login-logo-wrapper::after {
            content: '';
            position: absolute;
            inset: 0px;
            border-radius: 20px;
            background: #0f172a;
            z-index: -1;
        }

        /* --- Anima√ß√µes dos T√≠tulos das P√°ginas --- */
        .title-wrapper {
            position: relative;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            box-shadow: 0 0 12px rgba(6, 182, 212, 0.3);
            margin-right: 12px;
            z-index: 1;
        }
        .title-wrapper::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 12px;
            background: conic-gradient(from 0deg, transparent 0%, #06b6d4 25%, transparent 50%, #ec4899 75%, transparent 100%);
            z-index: -2;
            animation: spinBorder 3s linear infinite;
        }
        .title-wrapper::after {
            content: '';
            position: absolute;
            inset: 0px;
            border-radius: 10px;
            background: #0f172a;
            z-index: -1;
        }
        .title-wrapper.pink-theme { box-shadow: 0 0 12px rgba(236, 72, 153, 0.3); }
        
        .title-path {
            stroke-dasharray: 80;
            stroke-dashoffset: 80;
            animation: dashTitle 3s ease-in-out infinite alternate;
            stroke: #22d3ee;
            filter: drop-shadow(0 0 3px #22d3ee);
        }
        .title-path-pink {
            stroke-dasharray: 80;
            stroke-dashoffset: 80;
            animation: dashTitlePink 3s ease-in-out infinite alternate;
            stroke: #f472b6;
            filter: drop-shadow(0 0 3px #f472b6);
        }
        
        @keyframes dashTitle {
            0% { stroke-dashoffset: 80; fill: transparent; }
            50% { stroke-dashoffset: 0; fill: rgba(34, 211, 238, 0.2); }
            100% { stroke-dashoffset: -80; fill: transparent; }
        }
        @keyframes dashTitlePink {
            0% { stroke-dashoffset: 80; fill: transparent; }
            50% { stroke-dashoffset: 0; fill: rgba(244, 114, 182, 0.2); }
            100% { stroke-dashoffset: -80; fill: transparent; }
        }
        
        .title-text-glow {
            background: linear-gradient(to right, #ffffff 20%, #22d3ee 40%, #22d3ee 60%, #ffffff 80%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shineText 4s linear infinite;
        }
        .title-text-glow-pink {
            background: linear-gradient(to right, #ffffff 20%, #f472b6 40%, #f472b6 60%, #ffffff 80%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shineText 4s linear infinite;
        }
        
        .title-wrapper.orange-theme { box-shadow: 0 0 12px rgba(249, 115, 22, 0.3); }
        .title-wrapper.orange-theme::before { background: conic-gradient(from 0deg, transparent 0%, #f97316 25%, transparent 50%, #fcd34d 75%, transparent 100%); }
        .title-path-orange {
            stroke-dasharray: 80;
            stroke-dashoffset: 80;
            animation: dashTitleOrange 3s ease-in-out infinite alternate;
            stroke: #fb923c;
            filter: drop-shadow(0 0 3px #fb923c);
        }
        @keyframes dashTitleOrange {
            0% { stroke-dashoffset: 80; fill: transparent; }
            50% { stroke-dashoffset: 0; fill: rgba(251, 146, 60, 0.2); }
            100% { stroke-dashoffset: -80; fill: transparent; }
        }
        .title-text-glow-orange {
            background: linear-gradient(to right, #ffffff 20%, #fb923c 40%, #fb923c 60%, #ffffff 80%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shineText 4s linear infinite;
        }

        .chart-container {
            min-height: 250px;
            width: 100%;
        }
        .chart-container canvas {
            max-height: 100%;
        }

        /* Inputs, Selects e Textareas Futuristas */
        input, textarea {
            background-color: #0f172a !important;
            border: 1px solid #334155 !important;
            color: #f1f5f9 !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            outline: none !important;
        }
        
        input:hover, textarea:hover {
            border-color: #06b6d4 !important;
            background-color: #1e293b !important;
            box-shadow: inset 0 0 8px rgba(6, 182, 212, 0.15) !important;
        }

        input:focus, textarea:focus {
            border-color: #06b6d4 !important;
            box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.2), 0 0 15px rgba(6, 182, 212, 0.3) !important;
            background-color: #020617 !important;
            transform: translateY(-2px);
        }

        /* --- Custom Select Component (Animado e Vidro) --- */
        select.select-hidden {
            position: absolute !important;
            bottom: 0 !important;
            left: 50% !important;
            opacity: 0 !important;
            width: 1px !important;
            height: 1px !important;
            pointer-events: none !important;
            z-index: -1 !important;
        }

        .custom-select-wrapper {
            position: relative;
            width: 100%;
            user-select: none;
        }
        .custom-select-trigger {
            background-color: #0f172a;
            border: 1px solid #334155;
            color: #f1f5f9;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            position: relative;
            overflow: hidden;
            min-height: 42px;
        }
        
        .custom-select-trigger:hover {
            border-color: #06b6d4 !important;
            background-color: #1e293b;
            box-shadow: inset 0 0 8px rgba(6, 182, 212, 0.15) !important;
        }
        
        .custom-select-wrapper.open .custom-select-trigger {
            border-color: #06b6d4 !important;
            box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.2), 0 0 15px rgba(6, 182, 212, 0.3) !important;
            background-color: #020617 !important;
        }

        .custom-select-wrapper.open {
            z-index: 999;
        }

        .custom-select-options {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.85); 
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid #06b6d4;
            border-radius: 0.75rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8), 0 0 20px rgba(6, 182, 212, 0.25);
            z-index: 99999;
            max-height: 400px;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-15px) scale(0.95) rotateX(-10deg);
            transform-origin: top center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .custom-select-wrapper.open .custom-select-options {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1) rotateX(0);
        }

        .custom-select-search {
            padding: 8px;
            position: sticky;
            top: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(8px);
            z-index: 10;
            border-bottom: 1px solid rgba(6, 182, 212, 0.3);
        }
        .custom-select-search input {
            width: 100% !important;
            padding: 10px 12px !important;
            background: rgba(2, 6, 23, 0.8) !important;
            border: 1px solid rgba(51, 65, 85, 0.8) !important;
            border-radius: 6px !important;
            color: white !important;
            font-size: 0.85rem !important;
            transition: all 0.3s !important;
        }
        .custom-select-search input:focus {
            border-color: #06b6d4 !important;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.2) !important;
        }
        
        .custom-select-option {
            padding: 0.85rem 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid rgba(51, 65, 85, 0.4);
            color: #94a3b8;
            font-size: 0.9rem;
            opacity: 0;
        }
        .custom-select-option:last-child {
            border-bottom: none;
        }
        .custom-select-option:hover {
            background: linear-gradient(90deg, rgba(6, 182, 212, 0.15) 0%, transparent 100%);
            color: #22d3ee;
            padding-left: 1.5rem;
            border-left: 2px solid #06b6d4;
        }
        .custom-select-option.selected {
            color: #06b6d4;
            font-weight: 600;
            background: rgba(6, 182, 212, 0.05);
        }

        @keyframes slideInOption {
            from { opacity: 0; transform: translateX(-15px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Modal Transitions */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.2s ease-out; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: all 0.2s ease-in; }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Markdown Styles in Modal */
        #summaryContent h1, #summaryContent h2, #summaryContent h3 { color: #22d3ee; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
        #summaryContent p { margin-bottom: 0.8em; line-height: 1.6; }
        #summaryContent ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 0.8em; }
        #summaryContent li { margin-bottom: 0.4em; }
        #summaryContent strong { color: white; }

        /* --- ESTILOS DE EXPORTA√á√ÉO MOBILE (Story Format) --- */
        .export-mobile {
            width: 1080px !important; /* Largura Story/HD Mobile */
            max-width: none !important;
            height: auto !important;
            min-height: 1920px !important;
            padding: 80px 60px !important; /* Mais respiro lateral e superior */
            background-color: #020617 !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            z-index: -100 !important; /* Esconde visualmente mas permite renderiza√ß√£o */
            text-rendering: optimizeLegibility !important;
            -webkit-font-smoothing: antialiased !important;
            -moz-osx-font-smoothing: grayscale !important;
            transform: translateZ(0) !important; /* For√ßa renderiza√ß√£o por hardware e remove blur */
        }

        /* For√ßa a remo√ß√£o de desfoque e transpar√™ncias que quebram o html2canvas */
        .export-mobile * {
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
        }

        /* Ajuste de Layout para Mobile */
        .export-mobile #reportSummaryAggregated, 
        .export-mobile #socialReportSummaryAggregated {
            display: grid !important;
            grid-template-columns: repeat(2, 1fr) !important; /* 2 colunas para KPIs */
            gap: 30px !important;
        }
        
        /* For√ßa gr√°ficos a ficarem um abaixo do outro */
        .export-mobile .grid {
            display: flex !important;
            flex-direction: column !important;
            gap: 60px !important;
        }

        /* Ajuste de Gr√°ficos */
        .export-mobile .chart-container {
            height: 600px !important; /* Gr√°ficos mais altos para mobile */
            margin-bottom: 20px !important;
        }

        /* Tipografia Gigante para Mobile/Story */
        .export-mobile h3 { font-size: 32px !important; margin-bottom: 30px !important; color: #fff !important; text-transform: uppercase !important; letter-spacing: 2px !important; border-left: 5px solid #06b6d4; padding-left: 15px; }
        .export-mobile p.text-\[9px\] { font-size: 20px !important; } /* Label KPI pequeno */
        .export-mobile p.text-\[10px\] { font-size: 20px !important; } /* Label KPI Social */
        .export-mobile p.text-sm { font-size: 36px !important; } /* Valor KPI Traffic */
        .export-mobile p.text-2xl { font-size: 48px !important; } /* Valor KPI Social */
        .export-mobile .text-xs { font-size: 24px !important; }
        
        /* Branding no Export */
        .export-mobile::after {
            content: 'Novan Agency';
            position: absolute;
            bottom: 40px;
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(6, 182, 212, 0.4);
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        /* Anima√ß√µes Especiais para Tarefas (Novo) */
        @keyframes shineProgress {
            0% { background-position: 200% center; }
            100% { background-position: -200% center; }
        }
        .task-card-progress {
            background: linear-gradient(90deg, rgba(15,23,42,1) 0%, rgba(66,32,6,0.3) 50%, rgba(15,23,42,1) 100%);
            background-size: 200% auto;
            animation: shineProgress 3s linear infinite;
            border-left: 4px solid #eab308; /* Yellow 500 */
        }
        .task-card-completed {
            background: linear-gradient(90deg, rgba(15,23,42,1) 0%, rgba(20,83,45,0.5) 50%, rgba(15,23,42,1) 100%);
            background-size: 200% auto;
            animation: shineProgress 3s linear infinite;
            border-left: 4px solid #22c55e; /* Green 500 */
        }
        .task-card-overdue {
            border-left: 4px solid #ef4444; /* Red 500 */
            background: rgba(127,29,29,0.1);
        }
        .task-card-pending {
            background: linear-gradient(90deg, rgba(15,23,42,1) 0%, rgba(30,58,138,0.4) 50%, rgba(15,23,42,1) 100%);
            background-size: 200% auto;
            animation: shineProgress 3s linear infinite;
            border-left: 4px solid #3b82f6; /* Blue 500 */
        }

        /* --- Anima√ß√µes KPIs --- */
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(20px); filter: blur(4px); }
            to { opacity: 1; transform: translateY(0); filter: blur(0); }
        }
        .animate-kpi {
            animation: slideUpFade 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            opacity: 0;
        }

        /* Anima√ß√£o Live Metrics (Novo) */
        @keyframes livePulse {
            0% { box-shadow: inset 0 0 0 rgba(6, 182, 212, 0); background-color: rgba(30, 41, 59, 1); }
            50% { box-shadow: inset 0 0 20px rgba(6, 182, 212, 0.4); background-color: rgba(6, 182, 212, 0.15); border-color: #06b6d4; }
            100% { box-shadow: inset 0 0 0 rgba(6, 182, 212, 0); background-color: rgba(30, 41, 59, 1); }
        }
        .metric-update {
            animation: livePulse 0.6s ease-out;
        }

        /* --- Anima√ß√£o Cascata dos Cards de Clientes (Novo) --- */
        @keyframes slideUpFadeIn {
            0% { opacity: 0; transform: translateY(30px) scale(0.95); filter: blur(5px); }
            100% { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
        }
        .client-card-animate {
            animation: slideUpFadeIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            opacity: 0;
        }
        
        /* --- Anima√ß√µes para Bot√µes de A√ß√£o Principais (Novo) --- */
        @keyframes pulseGlowCyan {
            0%, 100% { box-shadow: 0 0 10px rgba(6, 182, 212, 0.3), 0 0 20px rgba(6, 182, 212, 0.1); }
            50% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.6), 0 0 35px rgba(6, 182, 212, 0.3); }
        }
        @keyframes pulseGlowPink {
            0%, 100% { box-shadow: 0 0 10px rgba(236, 72, 153, 0.3), 0 0 20px rgba(236, 72, 153, 0.1); }
            50% { box-shadow: 0 0 20px rgba(236, 72, 153, 0.6), 0 0 35px rgba(236, 72, 153, 0.3); }
        }
        @keyframes pulseGlowOrange {
            0%, 100% { box-shadow: 0 0 10px rgba(249, 115, 22, 0.3), 0 0 20px rgba(249, 115, 22, 0.1); }
            50% { box-shadow: 0 0 20px rgba(249, 115, 22, 0.6), 0 0 35px rgba(249, 115, 22, 0.3); }
        }
        @keyframes btnShineContinuous {
            0% { left: -100%; }
            15% { left: 200%; }
            100% { left: 200%; }
        }
        .btn-animate-cyan {
            animation: pulseGlowCyan 3s infinite ease-in-out;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(6, 182, 212, 0.4);
        }
        .btn-animate-pink {
            animation: pulseGlowPink 3s infinite ease-in-out;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(236, 72, 153, 0.4);
        }
        .btn-animate-orange {
            animation: pulseGlowOrange 3s infinite ease-in-out;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(249, 115, 22, 0.4);
        }
        .btn-animate-cyan::after, .btn-animate-pink::after, .btn-animate-orange::after {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
            animation: btnShineContinuous 4s infinite cubic-bezier(0.4, 0, 0.2, 1);
            transform: skewX(-20deg);
        }

        /* --- Anima√ß√£o Loader de Transi√ß√£o (Nova P√°gina) --- */
        @keyframes loadProgress {
            0% { transform: scaleX(0); }
            100% { transform: scaleX(1); }
        }
        .animate-load-progress {
            animation: loadProgress 0.7s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            transform-origin: left;
        }
    </style>
</head>
<body class="flex flex-col lg:flex-row min-h-screen text-slate-200">
    
    <!-- Loader de Transi√ß√£o de P√°gina (Efeito de Navega√ß√£o) -->
    <div id="pageTransitionLoader" class="hidden fixed inset-0 z-[100] flex-col items-center justify-center bg-slate-950/95 backdrop-blur-3xl transition-opacity duration-300 opacity-0">
        <div class="relative w-28 h-28 mb-8">
            <div class="absolute inset-0 border-4 border-slate-800 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-cyan-500 rounded-full border-t-transparent animate-spin" style="animation-duration: 0.8s;"></div>
            <div class="absolute inset-4 border-4 border-pink-500/50 rounded-full border-b-transparent animate-spin border-dashed" style="animation-duration: 1.2s; animation-direction: reverse;"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
            </div>
        </div>
        <h2 id="transitionLoaderText" class="text-xl md:text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-white to-pink-500 uppercase tracking-[0.3em] animate-pulse text-center px-4">
            Acessando M√≥dulo...
        </h2>
        <div class="w-64 h-1.5 bg-slate-800 rounded-full mt-8 overflow-hidden shadow-[0_0_15px_rgba(6,182,212,0.3)]">
            <div id="transitionProgressBar" class="h-full bg-gradient-to-r from-cyan-500 to-pink-500 w-full rounded-full origin-left"></div>
        </div>
    </div>

    <!-- Tela de Login -->
    <div id="login-page" class="flex items-center justify-center min-h-screen w-full">
        <canvas id="matrixCanvas"></canvas>
        
        <!-- √çcones Flutuantes de Marketing -->
        <div class="futuristic-piece piece-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg> <!-- Gr√°fico -->
        </div>
        <div class="futuristic-piece piece-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" /></svg> <!-- Cursor/Tr√°fego -->
        </div>
        <div class="futuristic-piece piece-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg> <!-- Cora√ß√£o/Engajamento -->
        </div>
        <div class="futuristic-piece piece-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" /></svg> <!-- Megafone/Ads -->
        </div>

        <!-- Cart√£o Login Estilo Glass -->
        <div class="bg-slate-900/80 backdrop-blur-md p-8 rounded-2xl shadow-2xl w-full max-w-md z-10 border border-slate-700/50">
            <div class="login-logo-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 20V4l14 16V4" class="n-path" />
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-center text-white mb-2 tracking-wide logo-text">Novan Agency</h1>
            <p class="text-center text-cyan-400 mb-8 text-sm uppercase tracking-widest">Portal de Gest√£o</p>
            
            <form id="loginForm" class="space-y-5">
                <div class="relative">
                    <input type="email" id="login_email" placeholder="Email" required class="w-full p-3 rounded-lg border focus:ring-novan-primary focus:border-novan-primary" />
                </div>
                <div class="relative">
                    <input type="password" id="login_password" placeholder="Senha" required class="w-full p-3 rounded-lg border focus:ring-novan-primary focus:border-novan-primary pr-10" />
                    <button type="button" onclick="togglePasswordVisibility()" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-novan-primary transition-colors">
                        <svg id="togglePasswordIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path id="togglePasswordPath1" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path id="togglePasswordPath2" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                    </button>
                </div>
                <button type="submit" id="loginButton" class="w-full bg-novan-primary hover:bg-novan-hover text-white font-bold p-3 rounded-lg shadow-lg transition-all transform hover:scale-[1.02] hover:shadow-neon">
                    ENTRAR
                </button>
            </form>
            <p id="authError" class="text-center text-red-400 mt-4 text-sm hidden bg-red-900/20 p-2 rounded border border-red-500/30"></p>
        </div>
    </div>

    <!-- Dashboard Principal -->
    <div id="dashboard-container" class="hidden contents">
        <!-- Sidebar - Dark Blue Theme -->
        <aside id="sidebar" class="bg-[#0f172a] text-gray-300 w-full lg:w-64 flex-shrink-0 p-4 border-r border-slate-800">
            <div class="flex items-center gap-4 mb-8 px-2 border-b border-slate-800 pb-4">
                <div class="logo-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 20V4l14 16V4" class="n-path" />
                    </svg>
                </div>
                <span class="text-2xl font-bold tracking-tight logo-text">Novan</span>
            </div>
            <nav class="space-y-1 px-1">
                <!-- Se√ß√£o Principal -->
                <div class="sidebar-header header-cyan !mt-0">Principal</div>
                
                <div id="nav-clientes" class="sidebar-item theme-cyan active" onclick="switchTab('clientes')" data-tab="clientes">
                    <span class="menu-emoji">üëΩ</span> Clientes
                </div>
                <div id="nav-resultados-trafego" class="sidebar-item theme-cyan" onclick="switchTab('resultados-trafego')" data-tab="resultados-trafego">
                    <span class="menu-emoji">üöÄ</span> Res. Tr√°fego
                </div>
                <div id="nav-resultados-social" class="sidebar-item theme-pink" onclick="switchTab('resultados-social')" data-tab="resultados-social">
                    <span class="menu-emoji">üíñ</span> Res. Social
                </div>

                <!-- Se√ß√£o Gest√£o -->
                <div class="sidebar-header header-emerald">Gest√£o</div>
                
                <div id="nav-calendario" class="sidebar-item theme-emerald" onclick="switchTab('calendario')" data-tab="calendario">
                    <span class="menu-emoji">üìÖ</span> Calend√°rio
                </div>
                <div id="nav-gestao" class="sidebar-item theme-emerald" onclick="switchTab('gestao')" data-tab="gestao">
                    <span class="menu-emoji">üéØ</span> Tarefas
                </div>

                <!-- Se√ß√£o Produ√ß√£o -->
                <div class="sidebar-header header-orange">Produ√ß√£o</div>
                
                <div id="nav-controle-videos" class="sidebar-item theme-orange" onclick="switchTab('controle-videos')" data-tab="controle-videos">
                    <span class="menu-emoji">üé¨</span> Controle de V√≠deos
                </div>

                <!-- Se√ß√£o Intelig√™ncia -->
                <div class="sidebar-header header-purple">Intelig√™ncia</div>
                
                <!-- Mant√©m Tr√°fego = Ciano e Social = Pink para conex√£o visual constante -->
                <div id="nav-relatorios" class="sidebar-item theme-cyan" onclick="switchTab('relatorios')" data-tab="relatorios">
                    <span class="menu-emoji">üß†</span> Insights Tr√°fego
                </div>
                <div id="nav-relatorios-social" class="sidebar-item theme-pink" onclick="switchTab('relatorios-social')" data-tab="relatorios-social">
                    <span class="menu-emoji">üîÆ</span> Insights Social
                </div>

                <div onclick="handleLogout()" class="sidebar-item theme-red">
                    <span class="menu-emoji">üö™</span> Sair
                </div>
            </nav>
        </aside>

        <main class="flex-grow p-4 md:p-8 overflow-x-hidden">
            <div id="messageBox" class="fixed top-4 right-4 bg-novan-primary text-white p-4 rounded-xl shadow-lg hidden z-50 transition-all duration-300 font-medium"></div>

            <!-- Tab: Clientes -->
            <section id="clientes" class="tab-content">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                    <h1 class="text-3xl font-bold text-white tracking-wide flex items-center">
                        <div class="title-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" class="title-path"></path>
                                <circle cx="9" cy="7" r="4" class="title-path"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87" class="title-path"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75" class="title-path"></path>
                            </svg>
                        </div>
                        <span class="title-text-glow">Clientes</span>
                    </h1>
                    <div class="flex gap-2">
                        <button onclick="transitionToForm(toggleClientForm, 'Acessando Dossi√™ de Parceiro...')" class="btn-animate-cyan bg-novan-primary hover:bg-novan-hover text-white font-bold py-2 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-transform hover:scale-105">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                            Novo Cliente
                        </button>
                    </div>
                </div>

                <!-- Registration Form Block (MODAL) -->
                <div id="clientRegistrationContainer" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/85 backdrop-blur-xl p-4 transition-all duration-300">
                    <div class="bg-slate-900 p-6 md:p-10 rounded-3xl shadow-[0_0_60px_rgba(6,182,212,0.2)] w-full max-w-5xl border border-cyan-500/30 relative overflow-y-auto max-h-[92vh] custom-scrollbar">
                        <div class="absolute inset-0 overflow-hidden rounded-3xl pointer-events-none">
                            <div class="absolute -top-32 -right-32 w-96 h-96 bg-cyan-500/10 rounded-full blur-[100px]"></div>
                            <div class="absolute -bottom-32 -left-32 w-96 h-96 bg-indigo-500/10 rounded-full blur-[100px]"></div>
                        </div>
                        
                        <button onclick="toggleClientForm()" class="absolute top-6 right-6 text-gray-400 hover:text-white hover:bg-red-500/20 hover:border-red-500/50 transition-all bg-slate-800 border border-slate-700 p-2.5 rounded-xl z-20"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>

                        <div class="flex items-center gap-4 mb-8 pb-4 border-b border-slate-700/50 relative z-10">
                            <div class="bg-gradient-to-br from-cyan-500/20 to-blue-600/20 p-3.5 rounded-2xl border border-cyan-500/40 shadow-[0_0_20px_rgba(6,182,212,0.3)]">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                            </div>
                            <div>
                                <h2 class="text-3xl font-black text-white tracking-wide uppercase">Dossi√™ do Parceiro</h2>
                                <p class="text-cyan-400 text-xs font-bold tracking-[0.2em] uppercase mt-1">Configura√ß√£o de Intelig√™ncia Estrat√©gica</p>
                            </div>
                        </div>

                        <form id="clientForm" class="space-y-8 relative z-10">
                            <input type="hidden" id="cli_id_edit" value="">
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Bloco Esquerdo: Identidade -->
                            <div class="space-y-6">
                                <div class="bg-slate-800/40 p-6 rounded-2xl border border-slate-700/50 group hover:border-cyan-500/30 transition-colors">
                                    <h3 class="text-[10px] font-black text-cyan-500 uppercase tracking-[0.2em] mb-5 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-cyan-500 shadow-[0_0_8px_#06b6d4]"></span> 01. Identidade Corporativa</h3>
                                    
                                    <div class="space-y-4">
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg></div>
                                            <input type="text" id="cli_nome" placeholder="Nome da Marca / Empresa" required class="w-full pl-10 p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500 transition-colors shadow-inner" />
                                        </div>
                                        
                                        <div class="grid grid-cols-2 gap-4">
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg></div>
                                                <input type="text" id="cli_segmento" placeholder="Nicho/Segmento" class="w-full pl-10 p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500 transition-colors shadow-inner" />
                                            </div>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg></div>
                                                <input type="url" id="cli_logo" placeholder="URL da Logo (√çcone)" class="w-full pl-10 p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500 transition-colors shadow-inner" />
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg></div>
                                                <input type="email" id="cli_email" placeholder="E-mail Contato" class="w-full pl-10 p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500 transition-colors shadow-inner" />
                                            </div>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg></div>
                                                <input type="tel" id="cli_telefone" placeholder="WhatsApp (00) 0..." required class="w-full pl-10 p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500 transition-colors shadow-inner" oninput="maskPhone(this)" maxlength="15" />
                                            </div>
                                        </div>

                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg></div>
                                            <input type="url" id="cli_link" placeholder="Site, LP ou Linktree" class="w-full pl-10 p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500 transition-colors shadow-inner" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bloco Direito: Contrato e Servi√ßo -->
                            <div class="space-y-6">
                                <div class="bg-slate-800/40 p-6 rounded-2xl border border-slate-700/50 group hover:border-indigo-500/30 transition-colors h-full flex flex-col">
                                    <h3 class="text-[10px] font-black text-indigo-400 uppercase tracking-[0.2em] mb-5 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-indigo-500 shadow-[0_0_8px_#6366f1]"></span> 02. Estrat√©gia e Contrato</h3>
                                    
                                    <div class="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label class="text-[10px] uppercase font-bold text-slate-500 ml-1 mb-1 block">In√≠cio Contrato</label>
                                            <input type="date" id="cli_data_inicio" required class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-indigo-500 transition-colors" />
                                        </div>
                                        <div>
                                            <label class="text-[10px] uppercase font-bold text-slate-500 ml-1 mb-1 block">Respons√°vel Interno</label>
                                            <select id="cli_responsavel" required class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-indigo-500">
                                                <option value="Ag√™ncia">Gest√£o: Ag√™ncia</option>
                                                <option value="Freelancer">Gest√£o: Freelancer</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="bg-slate-900/80 p-1.5 rounded-xl border border-slate-700/50 mb-5 flex gap-1 relative z-10">
                                        <button type="button" id="form_btn_traffic" onclick="toggleFormCategory('traffic')" class="flex-1 py-3 rounded-lg font-black tracking-widest uppercase text-xs bg-gradient-to-r from-cyan-600 to-cyan-500 text-white shadow-[0_0_15px_rgba(6,182,212,0.4)] transition-all transform scale-100 relative overflow-hidden">Tr√°fego<div class="absolute inset-0 bg-white/20 opacity-0 hover:opacity-100 transition-opacity"></div></button>
                                        <button type="button" id="form_btn_social" onclick="toggleFormCategory('social')" class="flex-1 py-3 rounded-lg font-black tracking-widest uppercase text-xs bg-transparent text-slate-500 hover:text-white transition-all transform scale-95 hover:scale-100 relative overflow-hidden">Social<div class="absolute inset-0 bg-white/5 opacity-0 hover:opacity-100 transition-opacity"></div></button>
                                    </div>
                                    <input type="hidden" id="cli_service_type" value="traffic">

                                    <!-- Campos Tr√°fego -->
                                    <div id="trafficFields" class="flex-grow flex flex-col gap-4 contents">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div class="relative">
                                                <label class="text-[9px] uppercase font-bold text-slate-500 absolute -top-2 left-3 bg-slate-800 px-1 z-10 rounded">Verba Mensal (R$)</label>
                                                <input type="number" step="0.01" id="cli_budget_value_traffic" placeholder="Ex: 5000.00" class="w-full p-3.5 pt-4 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500" />
                                            </div>
                                            <div class="relative">
                                                <label class="text-[9px] uppercase font-bold text-slate-500 absolute -top-2 left-3 bg-slate-800 px-1 z-10 rounded">Meta ROAS</label>
                                                <input type="number" step="0.1" id="cli_target_roas" placeholder="Ex: 5.0x" class="w-full p-3.5 pt-4 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500" />
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <select id="cli_plataforma_traffic" class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500"><option value="Meta">Plataforma: Meta Ads</option><option value="Google">Plataforma: Google Ads</option><option value="TikTok">Plataforma: TikTok Ads</option><option value="Ambos">M√∫ltiplas Plataformas</option></select>
                                            <select id="cli_conversion_goals_traffic" class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500"><option value="Mensagem">Obj: Mensagens (WA)</option><option value="Compras">Obj: Compras (E-com)</option><option value="Leads">Obj: Captura de Leads</option></select>
                                        </div>
                                    </div>

                                    <!-- Campos Social Media -->
                                    <div id="socialMediaFields" class="hidden flex-grow flex flex-col gap-4 contents">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div class="relative">
                                                <label class="text-[9px] uppercase font-bold text-slate-500 absolute -top-2 left-3 bg-slate-800 px-1 z-10 rounded">Fee Ag√™ncia (R$)</label>
                                                <input type="number" step="0.01" id="cli_sm_fee" placeholder="Ex: 2500.00" class="w-full p-3.5 pt-4 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-pink-500" />
                                            </div>
                                            <div class="relative">
                                                <label class="text-[9px] uppercase font-bold text-slate-500 absolute -top-2 left-3 bg-slate-800 px-1 z-10 rounded">Meta de Seguidores</label>
                                                <input type="number" id="cli_target_followers" placeholder="Novos por M√™s" class="w-full p-3.5 pt-4 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-pink-500" />
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <select id="cli_sm_platform" class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-pink-500"><option value="Instagram">Foco: Instagram</option><option value="TikTok">Foco: TikTok</option><option value="LinkedIn">Foco: LinkedIn</option></select>
                                            <select id="cli_sm_needs" class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-pink-500"><option value="Full">Escopo: Full Service</option><option value="Conteudo">Escopo: Conte√∫do + Copy</option><option value="Design">Escopo: Apenas Design</option></select>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>

                        <div class="bg-slate-800/40 p-6 rounded-2xl border border-slate-700/50">
                            <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4">03. Contexto Adicional</h3>
                            <textarea id="cli_observacoes" placeholder="Dores do cliente, detalhes operacionais, login do painel de afiliado ou notas estrat√©gicas relevantes..." class="w-full p-4 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500 shadow-inner h-28 resize-none"></textarea>
                        </div>

                        <button type="submit" id="clientSubmitButton" class="w-full bg-gradient-to-r from-cyan-500 via-blue-600 to-indigo-600 text-white p-5 rounded-2xl font-black text-xl tracking-[0.2em] uppercase shadow-[0_10px_30px_rgba(6,182,212,0.4)] hover:shadow-[0_10px_40px_rgba(6,182,212,0.6)] hover:-translate-y-1 transition-all duration-300 relative overflow-hidden group">
                            <div class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-[shimmer_1.5s_infinite]"></div>
                            SALVAR DOSSI√ä DO PARCEIRO
                        </button>
                    </form>
                    </div>
                </div>

                <!-- Client List Block with Alpha Index -->
                <div class="mt-8 flex gap-4">
                    <div class="flex-grow">
                        <div class="flex justify-start space-x-4 mb-6 border-b border-slate-700 pb-4">
                            <button onclick="setListingCategory('traffic')" id="list_tab_traffic" class="px-6 py-2 rounded-lg text-xs font-bold tracking-widest uppercase transition-all duration-300 border border-slate-400 text-white bg-slate-800 hover:border-cyan-500 hover:text-cyan-400 hover:bg-cyan-900/30 hover:shadow-[0_0_12px_rgba(6,182,212,0.5)]">Tr√°fego</button>
                            <button onclick="setListingCategory('social')" id="list_tab_social" class="px-6 py-2 rounded-lg text-xs font-bold tracking-widest uppercase transition-all duration-300 border border-slate-700 text-slate-500 bg-transparent hover:border-pink-500 hover:text-pink-400 hover:bg-pink-900/30 hover:shadow-[0_0_12px_rgba(236,72,153,0.5)]">Social</button>
                        </div>
                        <div id="clientList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 scroll-mt-20"></div>
                        <p id="noClients" class="text-center text-slate-500 mt-12 hidden italic">Nenhum registro encontrado.</p>
                    </div>
                    <!-- Menu Lateral (√çndice Alfab√©tico) -->
                    <div id="alphaIndexSidebar" class="hidden md:flex flex-col gap-1 w-12 alpha-sidebar bg-slate-900/50 backdrop-blur-sm p-1 rounded-lg border border-slate-800">
                        <!-- Index injected here by JS -->
                    </div>
                </div>
            </section>

            <!-- Tab: Resultados Tr√°fego -->
            <section id="resultados-trafego" class="tab-content">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-white tracking-wide flex items-center">
                        <div class="title-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" class="title-path"></circle>
                                <circle cx="12" cy="12" r="6" class="title-path"></circle>
                                <circle cx="12" cy="12" r="2" class="title-path"></circle>
                            </svg>
                        </div>
                        <span class="title-text-glow">Performance Tr√°fego</span>
                    </h1>
                    <button onclick="transitionToForm(window.openNewTrafficForm, 'Inicializando Protocolo de Tr√°fego...')" class="btn-animate-cyan bg-novan-primary hover:bg-novan-hover text-white font-bold py-2 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>
                        Novo Resultado
                    </button>
                </div>

                <!-- Modal de Resultados Tr√°fego -->
                <div id="resultFormContainer" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-md p-4 transition-all duration-300">
                    <div class="bg-slate-900 p-6 md:p-8 rounded-2xl shadow-[0_0_40px_rgba(6,182,212,0.15)] w-full max-w-5xl border border-cyan-500/30 relative overflow-y-auto max-h-[90vh] custom-scrollbar">
                        <button onclick="toggleResultForm()" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                        
                        <div class="flex items-center gap-4 mb-8 pb-4 border-b border-slate-700/50">
                            <div class="bg-cyan-500/20 p-3 rounded-xl border border-cyan-500/40">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold text-white tracking-wide">Registro de Tr√°fego</h2>
                                <p class="text-cyan-400 text-xs font-semibold tracking-widest uppercase mt-1">M√©tricas e Convers√µes</p>
                            </div>
                        </div>

                        <form id="campaignForm" class="space-y-6">
                            <input type="hidden" id="res_id_edit" value=""> 
                            
                            <!-- BLOCO 1: Contexto e Configura√ß√£o -->
                            <div class="bg-slate-800/40 p-5 rounded-xl border border-slate-700/50 relative z-30 group">
                                <div class="absolute top-0 left-0 w-1 h-full rounded-l-xl bg-cyan-500 opacity-50 group-hover:opacity-100 transition-opacity"></div>
                                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-cyan-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg> 1. Setup da Campanha</h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="col-span-1 md:col-span-4 flex items-center gap-4 bg-slate-900/50 p-3 rounded-lg border border-slate-700">
                                        <span class="text-xs font-bold text-cyan-400 uppercase ml-1"><span class="animate-pulse inline-block w-2 h-2 bg-cyan-500 rounded-full mr-1"></span>Tipo de Registro:</span>
                                        <label class="inline-flex items-center cursor-pointer hover:text-white transition"><input type="radio" name="traffic_type_date" value="daily" checked onchange="toggleTrafficDateMode()" class="accent-cyan-500 h-4 w-4"><span class="ml-2 text-sm text-gray-300">Di√°rio</span></label>
                                        <label class="inline-flex items-center cursor-pointer hover:text-white transition"><input type="radio" name="traffic_type_date" value="period" onchange="toggleTrafficDateMode()" class="accent-cyan-500 h-4 w-4"><span class="ml-2 text-sm text-gray-300">Per√≠odo</span></label>
                                    </div>
                                    <div id="traffic_daily_input" class="col-span-1 md:col-span-2"><input type="date" id="res_data" required class="w-full p-3 rounded-lg bg-slate-900 border-slate-700 text-white focus:border-cyan-500 outline-none transition-all" /></div>
                                    <div id="traffic_period_input" class="col-span-1 md:col-span-2 hidden gap-2"><input type="date" id="res_data_inicio" class="w-1/2 p-3 rounded-lg bg-slate-900 border-slate-700 text-white" /><input type="date" id="res_data_fim" class="w-1/2 p-3 rounded-lg bg-slate-900 border-slate-700 text-white" /></div>
                                    <div class="col-span-1 md:col-span-2"><select id="res_cliente" required class="w-full p-3 rounded-lg"><option value="">Cliente</option></select></div>
                                    <div class="col-span-1 md:col-span-2"><select id="res_plataforma" required class="w-full p-3 rounded-lg"><option value="Meta">Meta Ads</option><option value="Google">Google Ads</option><option value="TikTok">TikTok Ads</option><option value="LinkedIn">LinkedIn Ads</option></select></div>
                                    <div class="col-span-1 md:col-span-2">
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg></div>
                                            <input type="text" id="res_campanha" placeholder="Nome da Campanha (Opcional)" class="w-full pl-10 p-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:border-cyan-500 transition-colors" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- BLOCO 2: Topo do Funil -->
                                <div class="bg-slate-800/40 p-5 rounded-xl border border-slate-700/50 relative z-20 group">
                                    <div class="absolute top-0 left-0 w-1 h-full rounded-l-xl bg-indigo-500 opacity-50 group-hover:opacity-100 transition-opacity"></div>
                                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg> 2. Topo do Funil (Alcance)</h3>
                                    
                                    <div class="space-y-4">
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
                                            <input type="number" step="0.01" id="res_investimento" placeholder="Investimento (Gasto R$)" required class="w-full pl-10 p-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:border-red-500 transition-colors" />
                                        </div>
                                        <div class="flex gap-4">
                                            <div class="relative flex-1">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></div>
                                                <input type="number" id="res_impressoes" placeholder="Impress√µes" required class="w-full pl-10 p-3 rounded-lg bg-slate-900 border border-slate-700 text-white transition-colors" />
                                            </div>
                                            <div class="relative flex-1">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M7 14v-4a5 5 0 0110 0v4M7 14l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17" /></svg></div>
                                                <input type="number" id="res_alcance" placeholder="Alcance" required class="w-full pl-10 p-3 rounded-lg bg-slate-900 border border-slate-700 text-white transition-colors" />
                                            </div>
                                        </div>
                                        <div class="relative w-full">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" /></svg></div>
                                            <input type="number" id="res_cliques" placeholder="Cliques no Link" required class="w-full pl-10 p-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:border-orange-500 transition-colors" />
                                        </div>
                                    </div>
                                </div>

                                <!-- BLOCO 3: Convers√£o e Retorno -->
                                <div class="bg-slate-800/40 p-5 rounded-xl border border-slate-700/50 relative z-10 group">
                                    <div class="absolute top-0 left-0 w-1 h-full rounded-l-xl bg-emerald-500 opacity-50 group-hover:opacity-100 transition-opacity"></div>
                                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> 3. Fundo do Funil (Convers√£o)</h3>
                                    
                                    <div class="space-y-4">
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
                                            <input type="number" step="0.01" id="res_vendas" placeholder="Faturamento Bruto / Retorno (R$)" required class="w-full pl-10 p-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:border-emerald-500 transition-colors" />
                                        </div>
                                        <div class="flex gap-4 items-center">
                                            <div class="w-1/2">
                                                <select id="res_conversion_type" required class="w-full p-3 rounded-lg bg-slate-900 border-slate-700">
                                                    <option value="">A√ß√£o Principal</option>
                                                    <option value="Compras">üõí Compras (E-com)</option>
                                                    <option value="Mensagem">üí¨ Mensagens (WA/Direct)</option>
                                                    <option value="Leads">üìù Leads (Formul√°rio)</option>
                                                    <option value="Ligacoes">üìû Liga√ß√µes</option>
                                                </select>
                                            </div>
                                            <div class="relative w-1/2">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg></div>
                                                <input type="number" id="res_conversion_count" placeholder="Qtd Convers√µes" required class="w-full pl-10 p-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:border-purple-500 transition-colors" />
                                            </div>
                                        </div>
                                        <textarea id="res_observacoes" placeholder="Observa√ß√µes e aprendizados do dia/per√≠odo..." class="w-full p-3 rounded-lg bg-slate-900 border-slate-700 h-[60px] resize-none"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- BLOCO 4: Dashboard em Tempo Real -->
                            <div class="bg-slate-950 p-4 rounded-xl border border-slate-800 relative shadow-inner mt-4">
                                <div class="absolute -top-3 left-4 bg-slate-900 px-2 text-[10px] font-bold text-cyan-500 uppercase tracking-widest border border-cyan-500/30 rounded">Simulador em Tempo Real</div>
                                <div class="grid grid-cols-3 md:grid-cols-6 gap-3 mt-2">
                                    <div class="live-metric-box bg-slate-800/80 rounded-lg p-3 border border-slate-700 transition-all text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span>ROAS</p>
                                        <p id="roas_calc" class="font-bold text-green-400 text-base group-hover:scale-110 transition-transform">0.00x</p>
                                    </div>
                                    <div class="live-metric-box bg-slate-800/80 rounded-lg p-3 border border-slate-700 transition-all text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-indigo-500 rounded-full"></span>CPA</p>
                                        <p id="cpa_calc" class="font-bold text-indigo-400 text-base group-hover:scale-110 transition-transform">R$ 0,00</p>
                                    </div>
                                    <div class="live-metric-box bg-slate-800/80 rounded-lg p-3 border border-slate-700 transition-all text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-cyan-500 rounded-full"></span>CPC</p>
                                        <p id="cpc_calc" class="font-bold text-cyan-400 text-base group-hover:scale-110 transition-transform">R$ 0,00</p>
                                    </div>
                                    <div class="live-metric-box bg-slate-800/80 rounded-lg p-3 border border-slate-700 transition-all text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-yellow-500 rounded-full"></span>CTR</p>
                                        <p id="ctr_calc" class="font-bold text-yellow-400 text-base group-hover:scale-110 transition-transform">0.00%</p>
                                    </div>
                                    <div class="live-metric-box bg-slate-800/80 rounded-lg p-3 border border-slate-700 transition-all text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-blue-500 rounded-full"></span>FREQ</p>
                                        <p id="freq_calc" class="font-bold text-blue-400 text-base group-hover:scale-110 transition-transform">0.00</p>
                                    </div>
                                    <div class="live-metric-box bg-slate-800/80 rounded-lg p-3 border border-slate-700 transition-all text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-purple-500 rounded-full"></span>CONV</p>
                                        <p id="tx_conv_calc" class="font-bold text-purple-400 text-base group-hover:scale-110 transition-transform">0.00%</p>
                                    </div>
                                </div>
                            </div>

                            <div class="flex flex-col md:flex-row gap-4 mt-6 pt-4 border-t border-slate-800">
                                <button type="button" onclick="generateDailySummary()" class="flex-1 bg-slate-800 hover:bg-slate-700 text-white font-bold p-4 rounded-xl transition-colors border border-slate-700 hover:border-slate-500 flex justify-center items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg> RESUMO DO DIA
                                </button>
                                <button type="submit" id="resultsSubmitButton" class="flex-[2] bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-black p-4 rounded-xl transition-all shadow-lg shadow-cyan-900/50 hover:shadow-cyan-500/30 flex justify-center items-center gap-2 text-lg tracking-wide">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg> SALVAR RESULTADO
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="bg-slate-800 p-4 rounded-xl mb-6 flex flex-wrap gap-3 items-center border border-cyan-500/20 shadow-lg relative z-30">
                    <span class="text-xs font-bold text-cyan-400 uppercase mr-auto">Filtros</span>
                    <div class="flex gap-1 mr-2">
                        <button onclick="setTrafficDateRange(1)" class="px-3 py-1 bg-slate-700 hover:bg-cyan-600 text-white text-[10px] rounded transition font-bold">Hoje</button>
                        <button onclick="setTrafficDateRange(7)" class="px-3 py-1 bg-slate-700 hover:bg-cyan-600 text-white text-[10px] rounded transition font-bold">7D</button>
                        <button onclick="setTrafficDateRange(15)" class="px-3 py-1 bg-slate-700 hover:bg-cyan-600 text-white text-[10px] rounded transition font-bold">15D</button>
                        <button onclick="setTrafficDateRange(30)" class="px-3 py-1 bg-slate-700 hover:bg-cyan-600 text-white text-[10px] rounded transition font-bold">30D</button>
                        <button onclick="setTrafficDateRange('all')" class="px-3 py-1 bg-slate-700 hover:bg-cyan-600 text-white text-[10px] rounded transition font-bold">Sempre</button>
                    </div>
                    <select id="results_filter_cliente" class="p-2 rounded-lg text-sm bg-slate-900 border-slate-700 text-white" onchange="renderResultsTable()"><option value="">Todos</option></select>
                    <input type="date" id="results_filter_start_date" class="p-2 rounded-lg text-sm bg-slate-900 border-slate-700 text-white" onchange="renderResultsTable()" />
                    <input type="date" id="results_filter_end_date" class="p-2 rounded-lg text-sm bg-slate-900 border-slate-700 text-white" onchange="renderResultsTable()" />
                    <button onclick="renderResultsTable()" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold p-2 rounded-lg px-4 text-xs">FILTRAR</button>
                </div>

                <div id="kpiCardsContainer" class="grid grid-cols-2 md:grid-cols-5 lg:grid-cols-5 gap-3 mb-8 text-white"></div>
                <div id="resultsListContainer" class="space-y-3"></div>
            </section>

            <!-- Tab: Resultados Social -->
            <section id="resultados-social" class="tab-content">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-white tracking-wide flex items-center">
                        <div class="title-wrapper pink-theme">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" class="title-path-pink"></path>
                            </svg>
                        </div>
                        <span class="title-text-glow-pink">Performance Social</span>
                    </h1>
                    <button onclick="transitionToForm(toggleSocialResultForm, 'Preparando Auditoria Social...')" class="btn-animate-pink bg-pink-600 hover:bg-pink-500 text-white font-bold py-2 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>
                        Novo Resultado Social
                    </button>
                </div>

                <!-- Modal de Resultados Social -->
                <div id="socialResultFormContainer" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/85 backdrop-blur-xl p-4 transition-all duration-300">
                    <div class="bg-slate-900 p-6 md:p-10 rounded-3xl shadow-[0_0_60px_rgba(236,72,153,0.2)] w-full max-w-5xl border border-pink-500/30 relative overflow-y-auto max-h-[92vh] custom-scrollbar">
                        <button onclick="toggleSocialResultForm()" class="absolute top-6 right-6 text-gray-400 hover:text-white hover:bg-red-500/20 hover:border-red-500/50 transition-all bg-slate-800 border border-slate-700 p-2.5 rounded-xl z-20"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                        
                        <div class="flex items-center gap-4 mb-8 pb-5 border-b border-slate-700/50 relative z-10">
                            <div class="bg-gradient-to-br from-pink-500/20 to-rose-600/20 p-3.5 rounded-2xl border border-pink-500/40 shadow-[0_0_20px_rgba(236,72,153,0.3)]">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-pink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                            </div>
                            <div>
                                <h2 class="text-3xl font-black text-white tracking-wide uppercase">Auditoria Social</h2>
                                <p class="text-pink-400 text-xs font-bold tracking-[0.2em] uppercase mt-1">Engajamento, Qualidade e Convers√£o</p>
                            </div>
                        </div>

                        <form id="socialResultForm" class="space-y-6 relative z-10">
                            <input type="hidden" id="soc_id_edit" value=""> 
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Coluna 1: Dados Base e Crescimento -->
                                <div class="space-y-6">
                                    <div class="bg-slate-800/40 p-5 rounded-2xl border border-slate-700/50 relative z-30 group">
                                        <div class="absolute top-0 left-0 w-1 h-full rounded-l-2xl bg-pink-500 opacity-50 group-hover:opacity-100 transition-opacity"></div>
                                        <h3 class="text-[10px] font-black text-pink-400 uppercase tracking-widest mb-4 flex items-center gap-2">1. Base e Per√≠odo</h3>
                                        
                                        <div class="grid grid-cols-2 gap-3 mb-4">
                                            <div class="col-span-2"><select id="soc_cliente" required class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-pink-500"><option value="">Selecionar Cliente</option></select></div>
                                            <div>
                                                <label class="text-[9px] uppercase font-bold text-slate-500 ml-1 block">In√≠cio</label>
                                                <input type="date" id="soc_data_inicio" required class="w-full p-3 rounded-xl bg-slate-900 border-slate-700 focus:border-pink-500" />
                                            </div>
                                            <div>
                                                <label class="text-[9px] uppercase font-bold text-slate-500 ml-1 block">Fim</label>
                                                <input type="date" id="soc_data_fim" required class="w-full p-3 rounded-xl bg-slate-900 border-slate-700 focus:border-pink-500" />
                                            </div>
                                            <div class="col-span-2"><select id="soc_plataforma" class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-pink-500"><option value="Instagram">Instagram</option><option value="TikTok">TikTok</option><option value="LinkedIn">LinkedIn</option><option value="Youtube">YouTube</option></select></div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 pt-4 border-t border-slate-700/50">
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-pink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg></div>
                                                <input type="number" id="soc_seguidores" placeholder="Seguidores Atuais" required class="w-full pl-9 p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-pink-500" />
                                            </div>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg></div>
                                                <input type="number" id="soc_novos_seguidores" placeholder="Novos no Per√≠odo" class="w-full pl-9 p-3 rounded-xl bg-slate-900 border-green-900/50 text-white focus:border-green-500" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="bg-slate-800/40 p-5 rounded-2xl border border-slate-700/50 relative z-20 group">
                                        <div class="absolute top-0 left-0 w-1 h-full rounded-l-2xl bg-cyan-500 opacity-50 group-hover:opacity-100 transition-opacity"></div>
                                        <h3 class="text-[10px] font-black text-cyan-400 uppercase tracking-widest mb-4 flex items-center gap-2">2. Descoberta e Funil</h3>
                                        <div class="grid grid-cols-2 gap-3">
                                            <input type="number" id="soc_alcance" placeholder="Alcance Total" required class="w-full p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500" />
                                            <input type="number" id="soc_impressoes" placeholder="Impress√µes Totais" required class="w-full p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500" />
                                            <input type="number" id="soc_visitas_perfil" placeholder="Visitas ao Perfil" class="w-full p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-cyan-500" />
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg></div>
                                                <input type="number" id="soc_link_cliques" placeholder="Cliques no Link" class="w-full pl-9 p-3 rounded-xl bg-slate-900 border-emerald-900/50 text-white focus:border-emerald-500" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Coluna 2: Engajamento Granular e Qualidade -->
                                <div class="space-y-6">
                                    <div class="bg-slate-800/40 p-5 rounded-2xl border border-slate-700/50 relative z-10 group h-full flex flex-col">
                                        <div class="absolute top-0 left-0 w-1 h-full rounded-l-2xl bg-yellow-500 opacity-50 group-hover:opacity-100 transition-opacity"></div>
                                        <h3 class="text-[10px] font-black text-yellow-400 uppercase tracking-widest mb-4 flex items-center gap-2">3. Intera√ß√£o Profunda</h3>
                                        
                                        <div class="grid grid-cols-2 gap-3 mb-4">
                                            <div class="col-span-2 relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" /></svg></div>
                                                <input type="number" id="soc_interacoes" placeholder="Soma Likes + Coment√°rios" required class="w-full pl-9 p-3.5 rounded-xl bg-slate-900 border-yellow-900/50 text-white focus:border-yellow-500 font-bold" />
                                            </div>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg></div>
                                                <input type="number" id="soc_compartilhamentos" placeholder="Compartilhamentos" class="w-full pl-9 p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-blue-500" />
                                            </div>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" /></svg></div>
                                                <input type="number" id="soc_salvamentos" placeholder="Salvamentos" class="w-full pl-9 p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-purple-500" />
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 pt-4 border-t border-slate-700/50 mb-4">
                                            <input type="number" id="soc_posts" placeholder="N¬∫ Posts Feed" required class="w-full p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-yellow-500" />
                                            <select id="soc_sentimento" class="w-full p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-yellow-500 text-sm"><option value="Positivo">Sentimento: Positivo ü§©</option><option value="Neutro">Sentimento: Neutro üòê</option><option value="Negativo">Sentimento: Negativo üò†</option></select>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 mt-auto">
                                            <input type="number" id="soc_stories_views" placeholder="M√©dia Views Stories" class="w-full p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-yellow-500" />
                                            <input type="number" id="soc_reels_views" placeholder="Total Views Reels/V√≠deo" class="w-full p-3 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-yellow-500" />
                                            <div class="col-span-2 relative mt-2">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-4 h-4 text-rose-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg></div>
                                                <input type="url" id="soc_best_post" placeholder="Link do Post Campe√£o" class="w-full pl-9 p-3 rounded-xl bg-slate-900 border-rose-900/50 text-white focus:border-rose-500 transition-colors" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Dashboard de Simula√ß√£o Real-Time -->
                            <div class="bg-slate-950 p-5 rounded-2xl border border-slate-800 relative shadow-inner mt-6">
                                <div class="absolute -top-3 left-6 bg-slate-900 px-3 py-0.5 text-[10px] font-black text-pink-500 uppercase tracking-widest border border-pink-500/40 rounded-lg shadow-[0_0_10px_rgba(236,72,153,0.2)]">An√°lise Cognitiva Ao Vivo</div>
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mt-3">
                                    <div class="social-metric-box bg-slate-800/80 rounded-xl p-4 border border-slate-700 text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-pink-500 rounded-full"></span>Engajamento</p>
                                        <p id="soc_er_calc" class="text-2xl font-black text-pink-400 group-hover:scale-110 transition-transform">0.00%</p>
                                    </div>
                                    <div class="social-metric-box bg-slate-800/80 rounded-xl p-4 border border-slate-700 text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span>Cresc. Base</p>
                                        <p id="soc_gr_calc" class="text-2xl font-black text-green-400 group-hover:scale-110 transition-transform">0.00%</p>
                                    </div>
                                    <div class="social-metric-box bg-slate-800/80 rounded-xl p-4 border border-slate-700 text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></span>Conv. Perfil</p>
                                        <p id="soc_cv_calc" class="text-2xl font-black text-emerald-400 group-hover:scale-110 transition-transform" title="Cliques no Link / Visitas ao Perfil">0.00%</p>
                                    </div>
                                    <div class="social-metric-box bg-slate-800/80 rounded-xl p-4 border border-slate-700 text-center group">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-yellow-500 rounded-full"></span>Inter/Post</p>
                                        <p id="soc_ipp_calc" class="text-2xl font-black text-yellow-400 group-hover:scale-110 transition-transform">0.0</p>
                                    </div>
                                    <div class="social-metric-box bg-slate-800/80 rounded-xl p-4 border border-slate-700 text-center group col-span-2 md:col-span-1">
                                        <p class="text-[9px] text-slate-400 uppercase tracking-wider mb-1 flex justify-center items-center gap-1"><span class="w-1.5 h-1.5 bg-white rounded-full"></span>Total Views</p>
                                        <p id="soc_tv_calc" class="text-2xl font-black text-white group-hover:scale-110 transition-transform">0</p>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-6 border-t border-slate-800 pt-6">
                                <label class="text-[10px] uppercase font-bold text-slate-500 ml-1 mb-2 block">Diagn√≥stico Humano</label>
                                <textarea id="soc_observacoes" placeholder="Resumo estrat√©gico, an√°lise de formato vencedor, justificativa de queda ou pr√≥ximos passos para o pr√≥ximo m√™s..." class="w-full p-4 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-pink-500 h-24 resize-none"></textarea>
                            </div>

                            <button type="submit" class="w-full bg-gradient-to-r from-pink-600 via-rose-500 to-pink-600 bg-[length:200%_auto] text-white font-black p-5 rounded-2xl shadow-[0_10px_30px_rgba(236,72,153,0.4)] hover:shadow-[0_10px_40px_rgba(236,72,153,0.6)] hover:bg-[position:right_center] transition-all duration-500 text-xl tracking-[0.2em] uppercase mt-4">
                                PROCESSAR AUDITORIA
                            </button>
                        </form>
                    </div>
                </div>

                <div class="bg-slate-800 p-4 rounded-xl mb-6 flex flex-wrap gap-3 items-center border border-pink-500/20 shadow-lg relative z-30">
                    <span class="text-xs font-bold text-pink-400 uppercase mr-auto">Filtros</span>
                    <div class="flex gap-1 mr-2">
                        <button onclick="setSocialDateRange(1)" class="px-3 py-1 bg-slate-700 hover:bg-pink-600 text-white text-[10px] rounded transition font-bold">Hoje</button>
                        <button onclick="setSocialDateRange(7)" class="px-3 py-1 bg-slate-700 hover:bg-pink-600 text-white text-[10px] rounded transition font-bold">7D</button>
                        <button onclick="setSocialDateRange(15)" class="px-3 py-1 bg-slate-700 hover:bg-pink-600 text-white text-[10px] rounded transition font-bold">15D</button>
                        <button onclick="setSocialDateRange(30)" class="px-3 py-1 bg-slate-700 hover:bg-pink-600 text-white text-[10px] rounded transition font-bold">30D</button>
                        <button onclick="setSocialDateRange('all')" class="px-3 py-1 bg-slate-700 hover:bg-pink-600 text-white text-[10px] rounded transition font-bold">Sempre</button>
                    </div>
                    <input type="date" id="social_filter_start" class="p-2 rounded-lg text-sm bg-slate-900 border-slate-700 text-white w-32" onchange="renderSocialResultsTable()" /><span class="text-gray-500 text-xs">at√©</span><input type="date" id="social_filter_end" class="p-2 rounded-lg text-sm bg-slate-900 border-slate-700 text-white w-32" onchange="renderSocialResultsTable()" />
                    <select id="social_filter_cliente" class="p-2 rounded-lg text-sm bg-slate-900 border-slate-700 text-white" onchange="renderSocialResultsTable()"><option value="">Todos</option></select>
                </div>

                <!-- NOVO: Container de KPI Social -->
                <div id="socialKpiCardsContainer" class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-6 text-white"></div>
                <div id="socialResultsListContainer" class="space-y-3"></div>
            </section>

            <!-- Tab: Insights Tr√°fego -->
            <section id="relatorios" class="tab-content">
                <div class="flex flex-col lg:flex-row justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-white tracking-wide flex items-center">
                        <div class="title-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" class="title-path"></polyline>
                                <polyline points="17 6 23 6 23 12" class="title-path"></polyline>
                            </svg>
                        </div>
                        <span class="title-text-glow">Insights Tr√°fego</span>
                    </h1>
                    <div class="flex gap-2 mt-4 lg:mt-0 flex-wrap justify-end">
                        <button onclick="shareWhatsAppTraffic()" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg shadow-[0_0_15px_rgba(34,197,94,0.4)] flex items-center gap-2 transition-all transform hover:scale-105 border border-green-400/50 hover:shadow-[0_0_25px_rgba(34,197,94,0.6)]">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51a12.8 12.8 0 0 0-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0 0 12.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 0 0-3.48-8.413Z"/></svg>
                            Relat√≥rio em Texto
                        </button>
                        <button onclick="exportReportMobile()" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-6 rounded-lg shadow-[0_0_15px_rgba(79,70,229,0.4)] flex items-center gap-2 transition-all transform hover:scale-105 border border-indigo-400/50 hover:shadow-[0_0_25px_rgba(79,70,229,0.6)]">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                            Exportar Imagem
                        </button>
                    </div>
                </div>
                
                <!-- Painel de Filtros Futurista -->
                <div class="bg-slate-900/80 backdrop-blur-xl p-6 rounded-2xl mb-8 border border-cyan-500/30 shadow-[0_0_40px_rgba(6,182,212,0.1)] relative group z-30">
                    <div class="absolute inset-0 overflow-hidden rounded-2xl pointer-events-none">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-50"></div>
                        <div class="absolute -top-24 -right-24 w-48 h-48 bg-cyan-500/10 rounded-full blur-3xl"></div>
                    </div>
                    
                    <div class="flex flex-wrap gap-4 items-end relative z-10">
                        <div class="flex-grow min-w-[200px]">
                            <label class="text-[10px] font-black text-cyan-400 mb-2 flex items-center gap-1 uppercase tracking-widest"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M7 14v-4a5 5 0 0110 0v4M7 14l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17" /></svg> Cliente Alvo</label>
                            <select id="report_cliente" class="w-full p-3 rounded-xl bg-slate-950 border border-slate-700 text-white shadow-inner focus:border-cyan-500 transition-colors"><option value="">Todos os Clientes</option></select>
                        </div>
                        <div class="min-w-[180px]">
                            <label class="text-[10px] font-black text-cyan-400 mb-2 flex items-center gap-1 uppercase tracking-widest"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-4 10h.01M3 21h18a2 2 0 002-2V7a2 2 0 00-2-2H3a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg> Range Din√¢mico</label>
                            <select id="report_range" onchange="applyDateRange('report', this.value)" class="w-full p-3 rounded-xl bg-slate-950 border border-slate-700 text-white shadow-inner focus:border-cyan-500 transition-colors">
                                <option value="custom">Personalizado</option>
                                <option value="today">Hoje</option>
                                <option value="yesterday">Ontem</option>
                                <option value="today_yesterday">Hoje e Ontem</option>
                                <option value="last_7">√öltimos 7 dias</option>
                                <option value="last_14">√öltimos 14 dias</option>
                                <option value="last_28">√öltimos 28 dias</option>
                                <option value="last_30">√öltimos 30 dias</option>
                                <option value="this_week">Esta semana</option>
                                <option value="last_week">Semana passada</option>
                                <option value="this_month">Este m√™s</option>
                                <option value="last_month">M√™s passado</option>
                                <option value="max">M√°ximo</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-[10px] font-black text-slate-500 mb-2 block uppercase tracking-widest">In√≠cio</label>
                            <input type="date" id="report_start_date" class="p-3 rounded-xl bg-slate-950 border border-slate-700 text-white shadow-inner focus:border-cyan-500 transition-colors" />
                        </div>
                        <div>
                            <label class="text-[10px] font-black text-slate-500 mb-2 block uppercase tracking-widest">Fim</label>
                            <input type="date" id="report_end_date" class="p-3 rounded-xl bg-slate-950 border border-slate-700 text-white shadow-inner focus:border-cyan-500 transition-colors" />
                        </div>
                        <button onclick="generateReport()" class="bg-gradient-to-r from-cyan-600 to-cyan-400 text-slate-900 p-3 rounded-xl px-8 font-black tracking-[0.2em] uppercase hover:shadow-[0_0_20px_rgba(6,182,212,0.6)] transition-all transform hover:-translate-y-1 flex items-center gap-2 border border-cyan-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg> PROCESSAR
                        </button>
                    </div>
                </div>

                <div id="report-export-container" class="bg-[#020617] p-6 lg:p-8 rounded-2xl border border-slate-800 relative shadow-[inset_0_0_50px_rgba(0,0,0,0.5)]">
                    <!-- Resumo Agregado KPIs -->
                    <div id="reportSummaryAggregated" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-7 gap-3 mb-10 text-white"></div>
                    
                    <!-- Grid de Gr√°ficos Futuristas -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Chart 1: Financeiro -->
                        <div class="bg-slate-900/60 backdrop-blur-md p-6 rounded-2xl border border-slate-700/50 hover:border-emerald-500/30 transition-colors shadow-lg group">
                            <h3 class="text-[10px] font-black text-emerald-400 mb-6 uppercase tracking-[0.2em] flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981] animate-pulse"></span> Din√¢mica Financeira (Gasto vs Retorno)
                            </h3>
                            <div class="chart-container"><canvas id="spendRevenueChart"></canvas></div>
                        </div>

                        <!-- Chart 2: ROAS -->
                        <div class="bg-slate-900/60 backdrop-blur-md p-6 rounded-2xl border border-slate-700/50 hover:border-yellow-500/30 transition-colors shadow-lg group">
                            <h3 class="text-[10px] font-black text-yellow-400 mb-6 uppercase tracking-[0.2em] flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-yellow-500 shadow-[0_0_8px_#eab308] animate-pulse"></span> Tra√ß√£o de ROAS (Evolu√ß√£o Di√°ria)
                            </h3>
                            <div class="chart-container"><canvas id="roasDailyChart"></canvas></div>
                        </div>

                        <!-- Chart 3: Efici√™ncia (CPA x Convers√£o) -->
                        <div class="bg-slate-900/60 backdrop-blur-md p-6 rounded-2xl border border-slate-700/50 hover:border-indigo-500/30 transition-colors shadow-lg group">
                            <h3 class="text-[10px] font-black text-indigo-400 mb-6 uppercase tracking-[0.2em] flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-indigo-500 shadow-[0_0_8px_#6366f1] animate-pulse"></span> Efici√™ncia de Funil (CPA vs Tx. Convers√£o)
                            </h3>
                            <div class="chart-container"><canvas id="cpaConvChart"></canvas></div>
                        </div>

                        <!-- Chart 4: Tr√°fego (Impressoes x Cliques) -->
                        <div class="bg-slate-900/60 backdrop-blur-md p-6 rounded-2xl border border-slate-700/50 hover:border-cyan-500/30 transition-colors shadow-lg group">
                            <h3 class="text-[10px] font-black text-cyan-400 mb-6 uppercase tracking-[0.2em] flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-cyan-500 shadow-[0_0_8px_#06b6d4] animate-pulse"></span> Volume de Tr√°fego (Impress√µes vs Cliques)
                            </h3>
                            <div class="chart-container"><canvas id="impressionsClicksChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab: Insights Social -->
            <section id="relatorios-social" class="tab-content">
                <div class="flex flex-col lg:flex-row justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-white tracking-wide flex items-center">
                        <div class="title-wrapper pink-theme">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" class="title-path-pink"></polyline>
                            </svg>
                        </div>
                        <span class="title-text-glow-pink">Insights Social</span>
                    </h1>
                    <div class="flex gap-2 mt-4 lg:mt-0 flex-wrap justify-end">
                        <button onclick="shareWhatsAppSocial()" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg shadow-[0_0_15px_rgba(34,197,94,0.4)] flex items-center gap-2 transition-all transform hover:scale-105 border border-green-400/50 hover:shadow-[0_0_25px_rgba(34,197,94,0.6)]">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51a12.8 12.8 0 0 0-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0 0 12.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 0 0-3.48-8.413Z"/></svg>
                            Relat√≥rio em Texto
                        </button>
                        <button onclick="exportSocialReportMobile()" class="bg-pink-600 hover:bg-pink-500 text-white font-bold py-2 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-transform hover:scale-105">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                            Exportar Imagem
                        </button>
                    </div>
                </div>
                
                <!-- Painel de Filtros Futurista (Social) -->
                <div class="bg-slate-900/80 backdrop-blur-xl p-6 rounded-2xl mb-8 border border-pink-500/30 shadow-[0_0_40px_rgba(236,72,153,0.1)] relative group z-30">
                    <div class="absolute inset-0 overflow-hidden rounded-2xl pointer-events-none">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-pink-500 to-transparent opacity-50"></div>
                        <div class="absolute -top-24 -right-24 w-48 h-48 bg-pink-500/10 rounded-full blur-3xl"></div>
                    </div>
                    
                    <div class="flex flex-wrap gap-4 items-end relative z-10">
                        <div class="flex-grow min-w-[200px]">
                            <label class="text-[10px] font-black text-pink-400 mb-2 flex items-center gap-1 uppercase tracking-widest"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M7 14v-4a5 5 0 0110 0v4M7 14l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17" /></svg> Cliente Alvo</label>
                            <select id="report_social_cliente" class="w-full p-3 rounded-xl bg-slate-950 border border-slate-700 text-white shadow-inner focus:border-pink-500 transition-colors"><option value="">Todos os Clientes</option></select>
                        </div>
                        <div class="min-w-[180px]">
                            <label class="text-[10px] font-black text-pink-400 mb-2 flex items-center gap-1 uppercase tracking-widest"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-4 10h.01M3 21h18a2 2 0 002-2V7a2 2 0 00-2-2H3a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg> Range Din√¢mico</label>
                            <select id="report_social_range" onchange="applyDateRange('report_social', this.value)" class="w-full p-3 rounded-xl bg-slate-950 border border-slate-700 text-white shadow-inner focus:border-pink-500 transition-colors">
                                <option value="custom">Personalizado</option>
                                <option value="today">Hoje</option>
                                <option value="yesterday">Ontem</option>
                                <option value="today_yesterday">Hoje e Ontem</option>
                                <option value="last_7">√öltimos 7 dias</option>
                                <option value="last_14">√öltimos 14 dias</option>
                                <option value="last_28">√öltimos 28 dias</option>
                                <option value="last_30">√öltimos 30 dias</option>
                                <option value="this_week">Esta semana</option>
                                <option value="last_week">Semana passada</option>
                                <option value="this_month">Este M√™s</option>
                                <option value="last_month">M√™s Passado</option>
                                <option value="max">M√°ximo</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-[10px] font-black text-slate-500 mb-2 block uppercase tracking-widest">In√≠cio</label>
                            <input type="date" id="report_social_start_date" class="p-3 rounded-xl bg-slate-950 border border-slate-700 text-white shadow-inner focus:border-pink-500 transition-colors" />
                        </div>
                        <div>
                            <label class="text-[10px] font-black text-slate-500 mb-2 block uppercase tracking-widest">Fim</label>
                            <input type="date" id="report_social_end_date" class="p-3 rounded-xl bg-slate-950 border border-slate-700 text-white shadow-inner focus:border-pink-500 transition-colors" />
                        </div>
                        <button onclick="generateSocialReport()" class="bg-gradient-to-r from-pink-600 to-rose-400 text-white p-3 rounded-xl px-8 font-black tracking-[0.2em] uppercase hover:shadow-[0_0_20px_rgba(236,72,153,0.6)] transition-all transform hover:-translate-y-1 flex items-center gap-2 border border-pink-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg> PROCESSAR
                        </button>
                    </div>
                </div>

                <div id="social-report-export-container" class="bg-[#0b1120] p-6 rounded-xl border border-slate-800 relative">
                    <div id="socialReportSummaryAggregated" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-white"></div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-slate-900/50 p-6 rounded-xl border border-slate-800"><h3 class="text-sm font-bold text-gray-300 mb-4 uppercase">Crescimento de Seguidores</h3><div class="chart-container"><canvas id="socialGrowthChart"></canvas></div></div>
                        <div class="bg-slate-900/50 p-6 rounded-xl border border-slate-800"><h3 class="text-sm font-bold text-gray-300 mb-4 uppercase">Engajamento vs Alcance</h3><div class="chart-container"><canvas id="socialEngagementChart"></canvas></div></div>
                    </div>
                </div>
            </section>
            
            <!-- Calendario -->
            <section id="calendario" class="tab-content">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-white tracking-wide flex items-center">
                        <div class="title-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" class="title-path"></rect>
                                <line x1="16" y1="2" x2="16" y2="6" class="title-path"></line>
                                <line x1="8" y1="2" x2="8" y2="6" class="title-path"></line>
                                <line x1="3" y1="10" x2="21" y2="10" class="title-path"></line>
                            </svg>
                        </div>
                        <span class="title-text-glow">Calend√°rio</span>
                    </h1>
                    <div class="flex gap-2"><button onclick="changeMonth(-1)" class="bg-slate-800/80 backdrop-blur-md p-2 rounded-xl border border-slate-700 hover:bg-slate-700 hover:border-cyan-500/50 hover:text-cyan-400 text-white transition-all shadow-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button><span id="currentMonthYear" class="text-xl font-bold text-cyan-400 min-w-[200px] text-center flex items-center justify-center uppercase tracking-widest drop-shadow-md"></span><button onclick="changeMonth(1)" class="bg-slate-800/80 backdrop-blur-md p-2 rounded-xl border border-slate-700 hover:bg-slate-700 hover:border-cyan-500/50 hover:text-cyan-400 text-white transition-all shadow-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg></button></div>
                </div>
                <div class="mb-4 relative z-30"><select id="filterClient" onchange="renderCalendar()" class="p-3 rounded-xl bg-slate-800/80 backdrop-blur-md border border-slate-700 text-white w-full md:w-auto shadow-lg hover:border-cyan-500/50 transition-colors"><option value="">Filtrar: Todos os Clientes</option></select></div>
                
                <!-- Cabe√ßalho dos Dias (Tipografia Premium) -->
                <div class="grid grid-cols-7 gap-3 text-center text-slate-500 text-[10px] font-black uppercase mb-4 tracking-[0.2em]">
                    <div class="border-b border-slate-800 pb-2">Dom</div>
                    <div class="border-b border-slate-800 pb-2">Seg</div>
                    <div class="border-b border-slate-800 pb-2">Ter</div>
                    <div class="border-b border-slate-800 pb-2">Qua</div>
                    <div class="border-b border-slate-800 pb-2">Qui</div>
                    <div class="border-b border-slate-800 pb-2">Sex</div>
                    <div class="border-b border-slate-800 pb-2">Sab</div>
                </div>
                
                <div id="calendarGrid" class="grid grid-cols-7"></div>
                
                <!-- √Årea de Resumo do Dia -->
                <div id="calendarSummary" class="mt-10 bg-slate-900/40 backdrop-blur-md p-6 lg:p-8 rounded-2xl border border-slate-800 shadow-2xl transition-all relative overflow-hidden hidden">
                    <!-- Detalhe de fundo do resumo -->
                    <div class="absolute -top-24 -right-24 w-48 h-48 bg-cyan-500/10 rounded-full blur-3xl"></div>
                    
                    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 relative z-10">
                        <h3 class="text-2xl font-bold text-white flex items-center gap-3">
                            <div class="bg-cyan-900/50 p-2 rounded-lg border border-cyan-500/30">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-2 4l-2 2m0 0l-2-2m2 2V5" /></svg>
                            </div>
                            Agenda: <span id="summaryDateDisplay" class="text-cyan-400"></span>
                        </h3>
                        
                        <!-- Filtro de Checkboxes Moderno (Smart Pills) -->
                        <div class="flex flex-wrap gap-3 items-center bg-slate-900/60 p-2.5 rounded-xl border border-slate-700/50 backdrop-blur-sm shadow-inner">
                            <span class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mr-1">Filtrar:</span>
                            
                            <label class="relative cursor-pointer group">
                                <input type="checkbox" name="taskFilter" value="Pendente" checked onchange="renderDaySummaryList()" class="peer sr-only">
                                <div class="px-3 py-1.5 rounded-lg border border-slate-700 bg-slate-800 text-slate-400 text-xs font-bold uppercase tracking-wider transition-all duration-300 peer-checked:bg-cyan-900/30 peer-checked:border-cyan-500 peer-checked:text-cyan-400 group-hover:border-cyan-500/50 peer-checked:shadow-[0_0_12px_rgba(6,182,212,0.3)] flex items-center gap-2 transform active:scale-95">
                                    <div class="w-2 h-2 rounded-full bg-slate-600 transition-all duration-300 peer-checked:bg-cyan-400 peer-checked:shadow-[0_0_8px_rgba(34,211,238,0.8)]"></div>
                                    Pendentes
                                </div>
                            </label>
                            
                            <label class="relative cursor-pointer group">
                                <input type="checkbox" name="taskFilter" value="Em Andamento" checked onchange="renderDaySummaryList()" class="peer sr-only">
                                <div class="px-3 py-1.5 rounded-lg border border-slate-700 bg-slate-800 text-slate-400 text-xs font-bold uppercase tracking-wider transition-all duration-300 peer-checked:bg-amber-900/30 peer-checked:border-amber-500 peer-checked:text-amber-400 group-hover:border-amber-500/50 peer-checked:shadow-[0_0_12px_rgba(245,158,11,0.3)] flex items-center gap-2 transform active:scale-95">
                                    <div class="w-2 h-2 rounded-full bg-slate-600 transition-all duration-300 peer-checked:bg-amber-400 peer-checked:shadow-[0_0_8px_rgba(251,191,36,0.8)]"></div>
                                    Andamento
                                </div>
                            </label>

                            <label class="relative cursor-pointer group">
                                <input type="checkbox" name="taskFilter" value="Concluido" checked onchange="renderDaySummaryList()" class="peer sr-only">
                                <div class="px-3 py-1.5 rounded-lg border border-slate-700 bg-slate-800 text-slate-400 text-xs font-bold uppercase tracking-wider transition-all duration-300 peer-checked:bg-emerald-900/30 peer-checked:border-emerald-500 peer-checked:text-emerald-400 group-hover:border-emerald-500/50 peer-checked:shadow-[0_0_12px_rgba(16,185,129,0.3)] flex items-center gap-2 transform active:scale-95">
                                    <div class="w-2 h-2 rounded-full bg-slate-600 transition-all duration-300 peer-checked:bg-emerald-400 peer-checked:shadow-[0_0_8px_rgba(52,211,153,0.8)]"></div>
                                    Conclu√≠dos
                                </div>
                            </label>
                        </div>
                    </div>
                    <div id="summaryList" class="space-y-3"></div>
                </div>
            </section>

            <!-- Gest√£o -->
            <section id="gestao" class="tab-content">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-white tracking-wide flex items-center">
                        <div class="title-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 11l3 3L22 4" class="title-path"></path>
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" class="title-path"></path>
                            </svg>
                        </div>
                        <span class="title-text-glow">Gest√£o de Tarefas</span>
                    </h1>
                    <button onclick="transitionToForm(toggleTaskForm, 'Acessando Painel de Tarefas...')" class="btn-animate-cyan bg-novan-primary hover:bg-novan-hover text-white font-bold py-2 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                        Nova Tarefa
                    </button>
                </div>
                <div id="taskFormContainer" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
                    <div class="bg-slate-900 p-8 rounded-2xl shadow-2xl w-full max-w-lg border border-cyan-500/30 relative">
                        <button onclick="toggleTaskForm()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                        <h2 class="text-xl font-bold mb-6 text-white" id="taskFormTitle">Nova Tarefa</h2>
                        <form id="taskForm" class="space-y-4">
                            <input type="hidden" id="task_id_edit" value="">
                            <select id="task_cliente" required class="w-full p-3 rounded-lg"><option value="">Cliente</option></select>
                            <select id="task_tipo" required class="w-full p-3 rounded-lg">
                                <option value="Alinhamento">Alinhamento</option>
                                <option value="Analise">An√°lise</option>
                                <option value="Campanha">Campanha</option>
                                <option value="Copywriting">Copywriting</option>
                                <option value="Criativo">Criativo</option>
                                <option value="Design">Design</option>
                                <option value="Estrategia">Estrat√©gia</option>
                                <option value="Financeiro">Financeiro</option>
                                <option value="Foto">Foto</option>
                                <option value="Otimizacao">Otimiza√ß√£o</option>
                                <option value="Planejamento">Planejamento</option>
                                <option value="Post">Post</option>
                                <option value="Relatorio">Relat√≥rio</option>
                                <option value="Reuniao">Reuni√£o</option>
                                <option value="Video">V√≠deo</option>
                            </select>
                            <input type="datetime-local" id="task_data" required class="w-full p-3 rounded-lg" />
                            <select id="task_status" class="w-full p-3 rounded-lg"><option value="Pendente">Pendente</option><option value="Em Andamento">Em Andamento</option><option value="Concluido">Conclu√≠do</option></select>
                            <textarea id="task_observacoes" placeholder="Detalhes..." class="w-full p-3 rounded-lg h-24"></textarea>
                            <button type="submit" class="w-full bg-novan-primary text-white p-3 rounded-lg font-bold">Salvar Tarefa</button>
                        </form>
                    </div>
                </div>
                <div id="taskManagementBoard" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            </section>

            <!-- Tab: Controle de V√≠deos -->
            <section id="controle-videos" class="tab-content">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-white tracking-wide flex items-center">
                        <div class="title-wrapper orange-theme">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18" class="title-path-orange"></rect>
                                <line x1="7" y1="2" x2="7" y2="22" class="title-path-orange"></line>
                                <line x1="17" y1="2" x2="17" y2="22" class="title-path-orange"></line>
                                <line x1="2" y1="12" x2="22" y2="12" class="title-path-orange"></line>
                                <line x1="2" y1="7" x2="7" y2="7" class="title-path-orange"></line>
                                <line x1="2" y1="17" x2="7" y2="17" class="title-path-orange"></line>
                                <line x1="17" y1="17" x2="22" y2="17" class="title-path-orange"></line>
                                <line x1="17" y1="7" x2="22" y2="7" class="title-path-orange"></line>
                            </svg>
                        </div>
                        <span class="title-text-glow-orange">Controle de V√≠deos</span>
                    </h1>
                    <button onclick="transitionToForm(toggleVideoForm, 'Inicializando Est√∫dio Criativo...')" class="btn-animate-orange bg-orange-600 hover:bg-orange-500 text-white font-bold py-2 px-6 rounded-lg shadow-lg flex items-center gap-2 transition-transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>
                        Novo Delivery
                    </button>
                </div>

                <!-- Modal de Cadastro de V√≠deos -->
                <div id="videoFormContainer" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/85 backdrop-blur-xl p-4 transition-all duration-300">
                    <div class="bg-slate-900 p-6 md:p-10 rounded-3xl shadow-[0_0_60px_rgba(249,115,22,0.2)] w-full max-w-4xl border border-orange-500/30 relative overflow-y-auto max-h-[92vh] custom-scrollbar">
                        <button onclick="toggleVideoForm()" class="absolute top-6 right-6 text-gray-400 hover:text-white hover:bg-red-500/20 hover:border-red-500/50 transition-all bg-slate-800 border border-slate-700 p-2.5 rounded-xl z-20"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                        
                        <div class="flex items-center gap-4 mb-8 pb-5 border-b border-slate-700/50 relative z-10">
                            <div class="bg-gradient-to-br from-orange-500/20 to-red-600/20 p-3.5 rounded-2xl border border-orange-500/40 shadow-[0_0_20px_rgba(249,115,22,0.3)]">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                            </div>
                            <div>
                                <h2 class="text-3xl font-black text-white tracking-wide uppercase">Delivery Criativo</h2>
                                <p class="text-orange-400 text-xs font-bold tracking-[0.2em] uppercase mt-1">Registro e Hospedagem de V√≠deos</p>
                            </div>
                        </div>

                        <form id="videoForm" class="space-y-6 relative z-10">
                            <input type="hidden" id="vid_id_edit" value="">
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-slate-800/40 p-5 rounded-2xl border border-slate-700/50">
                                    <h3 class="text-[10px] font-black text-orange-400 uppercase tracking-widest mb-4">Informa√ß√µes Base</h3>
                                    <div class="space-y-4">
                                        <select id="vid_cliente" required class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-orange-500 transition-colors"><option value="">Selecionar Cliente</option></select>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="text-[10px] uppercase font-bold text-slate-500 ml-1 block">Data de Entrega</label>
                                                <input type="date" id="vid_data" required class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-orange-500 transition-colors" />
                                            </div>
                                            <div>
                                                <label class="text-[10px] uppercase font-bold text-slate-500 ml-1 block">Quantidade (Qtd)</label>
                                                <input type="number" id="vid_quantidade" placeholder="Ex: 5" required min="1" class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-orange-500 transition-colors" />
                                            </div>
                                        </div>
                                        <select id="vid_formato" required class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-orange-500 transition-colors">
                                            <option value="">Formato / Plataforma</option>
                                            <option value="Reels/TikTok">Reels / TikTok (Vertical)</option>
                                            <option value="YouTube Longo">YouTube Longo (Horizontal)</option>
                                            <option value="Nuggets">Nuggets / Cortes</option>
                                            <option value="Institucional">Institucional</option>
                                            <option value="VSL / Vendas">VSL / V√≠deo de Vendas</option>
                                            <option value="Criativo Ads">Criativo para An√∫ncio (Ads)</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="bg-slate-800/40 p-5 rounded-2xl border border-slate-700/50 flex flex-col justify-between">
                                    <h3 class="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-4">Hospedagem & Status</h3>
                                    <div class="space-y-4">
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg></div>
                                            <input type="url" id="vid_link" placeholder="Link do Google Drive ou Pasta" required class="w-full pl-10 p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-indigo-500 transition-colors shadow-inner" />
                                        </div>
                                        <select id="vid_status" required class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-indigo-500 transition-colors">
                                            <option value="Entregue">Status: Entregue (Aprovado)</option>
                                            <option value="Aguardando Aprova√ß√£o">Status: Aguardando Aprova√ß√£o</option>
                                            <option value="Refa√ß√£o">Status: Em Refa√ß√£o</option>
                                        </select>
                                        <textarea id="vid_observacoes" placeholder="Briefing, notas de edi√ß√£o ou link do Trello..." class="w-full p-3.5 rounded-xl bg-slate-900 border-slate-700 text-white focus:border-indigo-500 transition-colors h-24 resize-none"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full bg-gradient-to-r from-orange-600 via-amber-500 to-orange-600 bg-[length:200%_auto] text-white font-black p-5 rounded-2xl shadow-[0_10px_30px_rgba(249,115,22,0.4)] hover:shadow-[0_10px_40px_rgba(249,115,22,0.6)] hover:bg-[position:right_center] transition-all duration-500 text-xl tracking-[0.2em] uppercase mt-4">
                                SALVAR REGISTRO
                            </button>
                        </form>
                    </div>
                </div>

                <div class="bg-slate-800 p-4 rounded-xl mb-6 flex flex-wrap gap-3 items-center border border-orange-500/20 shadow-lg relative z-30">
                    <span class="text-xs font-bold text-orange-400 uppercase mr-auto">Filtros</span>
                    <select id="vid_filter_cliente" class="p-2 rounded-lg text-sm bg-slate-900 border-slate-700 text-white" onchange="renderVideosList()"><option value="">Todos os Clientes</option></select>
                    <input type="date" id="vid_filter_start" class="p-2 rounded-lg text-sm bg-slate-900 border-slate-700 text-white w-32" onchange="renderVideosList()" /><span class="text-gray-500 text-xs">at√©</span><input type="date" id="vid_filter_end" class="p-2 rounded-lg text-sm bg-slate-900 border-slate-700 text-white w-32" onchange="renderVideosList()" />
                    <button onclick="renderVideosList()" class="bg-orange-600 hover:bg-orange-500 text-white font-bold p-2 rounded-lg px-4 text-xs shadow-lg">Aplicar</button>
                </div>

                <div id="videoKpiCardsContainer" class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6 text-white"></div>
                
                <div id="videosListContainer" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </section>

            <!-- Tab: Insights Tr√°fego -->
            <section id="relatorios" class="tab-content">
        </main>
    </div>

    <!-- Modais Gen√©ricos -->
    <div id="summaryModal" class="fixed inset-0 bg-black/90 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-slate-900 p-8 rounded-2xl w-full max-w-2xl border border-cyan-500/30 shadow-neon">
            <h3 id="summaryTitle" class="text-2xl font-bold mb-4 text-white"></h3>
            <div id="summaryContent" class="text-gray-300 max-h-[60vh] overflow-y-auto mb-6 custom-scrollbar"></div>
            <button onclick="closeSummaryModal()" class="w-full bg-slate-800 hover:bg-slate-700 text-white p-3 rounded-lg font-bold border border-slate-700">FECHAR</button>
        </div>
    </div>
    
    <!-- Modal de Confirma√ß√£o -->
    <div id="confirmationModal" class="fixed inset-0 bg-black/90 hidden items-center justify-center p-4 z-50 backdrop-blur-md">
        <div class="bg-slate-900 p-8 rounded-2xl w-full max-w-sm border border-red-500/30 shadow-[0_0_20px_rgba(239,68,68,0.3)] text-center">
            <div class="w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4 border border-red-500/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></div>
            <h3 class="text-xl font-bold mb-2 text-white">Excluir Registro?</h3><p class="text-gray-400 mb-6 text-sm">Esta a√ß√£o √© irrevers√≠vel.</p>
            <div class="flex gap-3"><button onclick="closeConfirmModal()" class="flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold transition">Cancelar</button><button onclick="confirmDeleteAction()" class="flex-1 py-3 bg-red-600 hover:bg-red-500 text-white rounded-xl font-bold shadow-lg shadow-red-900/40 transition">Confirmar</button></div>
        </div>
    </div>

    <!-- NOVO: Modal de Gest√£o de Acessos (Cofre de Senhas) -->
    <div id="credentialsModal" class="fixed inset-0 bg-black/95 hidden flex items-center justify-center p-4 z-[70] backdrop-blur-lg">
        <div class="bg-slate-900 p-6 md:p-8 rounded-2xl w-full max-w-4xl border border-indigo-500/30 shadow-2xl relative h-[90vh] flex flex-col">
            <button onclick="toggleCredentialsModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            <div class="flex items-center gap-4 mb-6 pb-4 border-b border-slate-700">
                <div class="bg-indigo-500/20 p-3 rounded-full border border-indigo-500/40"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg></div>
                <div><h2 class="text-2xl font-bold text-white">Cofre de Acessos</h2><p id="cred_client_name" class="text-indigo-400 text-sm font-semibold">Cliente: ...</p></div>
            </div>
            <div class="flex-grow flex flex-col md:flex-row gap-6 overflow-hidden">
                <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar">
                    <h3 class="text-xs font-bold text-gray-400 uppercase mb-3 sticky top-0 bg-slate-900 z-10 py-2">Acessos Cadastrados</h3>
                    <div id="credentialsList" class="space-y-3"></div>
                    <p id="noCredentials" class="text-center text-gray-600 italic mt-10 text-sm">Nenhum acesso cadastrado.</p>
                </div>
                <div class="w-full md:w-1/3 bg-slate-950 p-5 rounded-xl border border-slate-800 h-fit">
                    <h3 class="text-sm font-bold text-white mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg> Novo Acesso</h3>
                    <form id="credentialForm" class="space-y-3">
                        <input type="hidden" id="cred_client_id">
                        <input type="hidden" id="cred_id_edit"> <!-- Campo para ID de Edi√ß√£o -->
                        <select id="cred_platform" required class="w-full p-2 text-sm rounded-lg bg-slate-900 border-slate-700">
                            <option value="">Selecione a Plataforma...</option><option value="Instagram">Instagram</option><option value="Facebook">Facebook (Perfil)</option><option value="Meta Ads">Meta Ads (BM)</option><option value="Google Ads">Google Ads</option><option value="LinkedIn">LinkedIn</option><option value="TikTok">TikTok</option><option value="Youtube">YouTube</option><option value="Site/Wordpress">Site / Wordpress</option><option value="Email">E-mail</option><option value="Outro">Outro</option>
                        </select>
                        <input type="text" id="cred_login" placeholder="Login / E-mail" required class="w-full p-2 text-sm rounded-lg" />
                        <div class="relative"><input type="text" id="cred_password" placeholder="Senha" required class="w-full p-2 text-sm rounded-lg pr-8" /></div>
                        <textarea id="cred_notes" placeholder="Obs (Link de acesso, 2FA...)" class="w-full p-2 text-sm rounded-lg h-20 resize-none"></textarea>
                        <div class="flex gap-2">
                            <button type="submit" id="btn_save_cred" class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white font-bold p-2 rounded-lg text-sm transition shadow-lg">SALVAR NO COFRE</button>
                            <button type="button" id="btn_cancel_cred" onclick="cancelEditCredential()" class="hidden px-4 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm font-bold transition">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, deleteDoc, onSnapshot, updateDoc, writeBatch, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCTj0St5odkB_t_7_gpbOAcAVDkoXWCFDk",
            authDomain: "novangestao.firebaseapp.com",
            projectId: "novangestao",
            storageBucket: "novangestao.firebasestorage.app",
            messagingSenderId: "740883145809",
            appId: "1:740883145809:web:7087959104b24526028470"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = null;
        let clients = [];
        let results = [];
        let socialResults = [];
        let tasks = [];
        let videos = []; // Array para armazenar os v√≠deos
        let currentCredentialsList = []; 
        let credentialsCollection;
        let clientsCollection, resultsCollection, socialResultsCollection, tasksCollection, videosCollection; // Adicionado videosCollection
        let currentMonth = new Date();
        let reportCharts = { spend: null, metrics: null, roas: null };
        let socialReportCharts = { growth: null, engagement: null };
        
        // Helper to get local date string YYYY-MM-DD
        const toLocalISO = (date) => {
            const offset = date.getTimezoneOffset() * 60000;
            return new Date(date.getTime() - offset).toISOString().split('T')[0];
        }
        let currentSummaryDateStr = toLocalISO(new Date()); // Initialize with today's date

        window.lastTrafficStats = null;
        window.lastSocialStats = null;
        let currentListingTab = 'traffic';
        let matrixInterval;
        let customUIInitialized = false;

        // --- Helper de KPI Animado ---
        window.renderKpiCard = (label, value, theme, delayIndex) => {
            const themes = {
                red: { c: '#ef4444', classes: 'hover:border-red-500/50 group-hover:bg-red-500/20 from-red-500/0 via-red-500 to-red-500/0 bg-red-500 text-red-400 bg-red-500/10' },
                emerald: { c: '#10b981', classes: 'hover:border-emerald-500/50 group-hover:bg-emerald-500/20 from-emerald-500/0 via-emerald-500 to-emerald-500/0 bg-emerald-500 text-emerald-400 bg-emerald-500/10' },
                green: { c: '#22c55e', classes: 'hover:border-green-500/50 group-hover:bg-green-500/20 from-green-500/0 via-green-500 to-green-500/0 bg-green-500 text-green-400 bg-green-500/10' },
                yellow: { c: '#eab308', classes: 'hover:border-yellow-500/50 group-hover:bg-yellow-500/20 from-yellow-500/0 via-yellow-500 to-yellow-500/0 bg-yellow-500 text-yellow-400 bg-yellow-500/10' },
                indigo: { c: '#6366f1', classes: 'hover:border-indigo-500/50 group-hover:bg-indigo-500/20 from-indigo-500/0 via-indigo-500 to-indigo-500/0 bg-indigo-500 text-indigo-400 bg-indigo-500/10' },
                cyan: { c: '#06b6d4', classes: 'hover:border-cyan-500/50 group-hover:bg-cyan-500/20 from-cyan-500/0 via-cyan-500 to-cyan-500/0 bg-cyan-500 text-cyan-400 bg-cyan-500/10' },
                purple: { c: '#a855f7', classes: 'hover:border-purple-500/50 group-hover:bg-purple-500/20 from-purple-500/0 via-purple-500 to-purple-500/0 bg-purple-500 text-purple-400 bg-purple-500/10' },
                pink: { c: '#ec4899', classes: 'hover:border-pink-500/50 group-hover:bg-pink-500/20 from-pink-500/0 via-pink-500 to-pink-500/0 bg-pink-500 text-pink-400 bg-pink-500/10' },
                blue: { c: '#3b82f6', classes: 'hover:border-blue-500/50 group-hover:bg-blue-500/20 from-blue-500/0 via-blue-500 to-blue-500/0 bg-blue-500 text-blue-400 bg-blue-500/10' },
                orange: { c: '#f97316', classes: 'hover:border-orange-500/50 group-hover:bg-orange-500/20 from-orange-500/0 via-orange-500 to-orange-500/0 bg-orange-500 text-orange-400 bg-orange-500/10' },
                teal: { c: '#14b8a6', classes: 'hover:border-teal-500/50 group-hover:bg-teal-500/20 from-teal-500/0 via-teal-500 to-teal-500/0 bg-teal-500 text-teal-400 bg-teal-500/10' }
            };
            const t = themes[theme] || themes.cyan;
            const cls = t.classes.split(' ');
            
            return `<div class="animate-kpi bg-slate-800/60 backdrop-blur-sm p-4 rounded-2xl border border-slate-700/50 ${cls[0]} transition-all duration-300 transform hover:-translate-y-1 hover:shadow-[0_8px_16px_rgba(0,0,0,0.4)] group relative overflow-hidden" style="animation-delay: ${delayIndex * 0.05}s">
                <div class="absolute -right-6 -top-6 w-24 h-24 ${cls[7]} rounded-full blur-2xl ${cls[1]} transition-all"></div>
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r ${cls[2]} ${cls[3]} ${cls[4]} opacity-50 group-hover:opacity-100 transition-opacity"></div>
                <p class="text-[10px] text-gray-400 uppercase font-bold tracking-wider mb-1 flex items-center gap-1.5 relative z-10">
                    <span class="w-1.5 h-1.5 rounded-full ${cls[5]} shadow-[0_0_5px_${t.c}] animate-pulse"></span>
                    ${label}
                </p>
                <p class="text-xl font-black ${cls[6]} tracking-tight relative z-10">${value}</p>
            </div>`;
        };

        // L√≥gica de Custom Select Engine
        window.setupCustomSelects = () => {
            document.querySelectorAll('select:not(.no-custom-select)').forEach(select => {
                if (select.closest('.custom-select-wrapper')) {
                    window.updateCustomSelect(select);
                    return;
                }
                const wrapper = document.createElement('div');
                wrapper.className = 'custom-select-wrapper relative';
                if(select.classList.contains('w-full')) wrapper.classList.add('w-full');
                if(select.classList.contains('flex-grow')) wrapper.classList.add('flex-grow');
                if(select.classList.contains('w-1/2')) wrapper.classList.add('w-1/2');
                
                select.parentNode.insertBefore(wrapper, select);
                select.classList.add('select-hidden');
                wrapper.appendChild(select);

                const trigger = document.createElement('div');
                trigger.className = `custom-select-trigger ${select.className.replace('select-hidden', '')}`;
                trigger.classList.remove('w-full', 'w-1/2', 'flex-grow'); 
                trigger.innerHTML = `<span class="truncate pr-4 w-full text-left font-medium"></span><svg class="w-4 h-4 text-cyan-500 transition-transform duration-300 arrow absolute right-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>`;
                
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'custom-select-options custom-scrollbar';

                wrapper.appendChild(trigger);
                wrapper.appendChild(optionsContainer);

                window.updateCustomSelect(select);

                trigger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isOpen = wrapper.classList.contains('open');
                    document.querySelectorAll('.custom-select-wrapper').forEach(w => w.classList.remove('open'));
                    document.querySelectorAll('.custom-select-trigger .arrow').forEach(a => a.style.transform = 'rotate(0deg)');
                    if (!isOpen) {
                        wrapper.classList.add('open');
                        trigger.querySelector('.arrow').style.transform = 'rotate(180deg)';
                        
                        const searchInput = optionsContainer.querySelector('.custom-select-search input');
                        if (searchInput) {
                            searchInput.value = '';
                            optionsContainer.querySelectorAll('.custom-select-option').forEach(item => item.style.display = 'block');
                            setTimeout(() => searchInput.focus(), 50);
                        }

                        const opts = optionsContainer.querySelectorAll('.custom-select-option');
                        opts.forEach((opt, i) => {
                            opt.style.animation = 'none';
                            opt.offsetHeight; 
                            opt.style.animation = `slideInOption 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards ${i * 0.015}s`;
                        });
                    }
                });
            });
        };

        window.updateCustomSelect = (select) => {
            const wrapper = select.closest('.custom-select-wrapper');
            if (!wrapper) return;
            const optionsContainer = wrapper.querySelector('.custom-select-options');
            const triggerSpan = wrapper.querySelector('.custom-select-trigger span');
            optionsContainer.innerHTML = '';
            triggerSpan.innerHTML = select.options[select.selectedIndex]?.text || 'Selecione...';
            if (select.options[select.selectedIndex]?.value === '') triggerSpan.style.color = '#94a3b8';
            else triggerSpan.style.color = '#f1f5f9';

            if (select.options.length > 5) {
                const searchDiv = document.createElement('div');
                searchDiv.className = 'custom-select-search';
                searchDiv.innerHTML = `<input type="text" placeholder="Buscar cliente ou op√ß√£o..." onclick="event.stopPropagation()">`;
                optionsContainer.appendChild(searchDiv);

                const searchInput = searchDiv.querySelector('input');
                searchInput.addEventListener('input', (e) => {
                    const filter = e.target.value.toLowerCase();
                    const items = optionsContainer.querySelectorAll('.custom-select-option');
                    items.forEach(item => {
                        if (item.textContent.toLowerCase().includes(filter)) item.style.display = 'block';
                        else item.style.display = 'none';
                    });
                });
            }

            Array.from(select.options).forEach((option, index) => {
                const optDiv = document.createElement('div');
                optDiv.className = `custom-select-option ${option.selected ? 'selected' : ''}`;
                optDiv.innerHTML = option.text;
                optDiv.addEventListener('click', (e) => {
                    e.stopPropagation();
                    select.selectedIndex = index;
                    window.updateCustomSelect(select);
                    select.dispatchEvent(new Event('change'));
                    wrapper.classList.remove('open');
                    wrapper.querySelector('.arrow').style.transform = 'rotate(0deg)';
                });
                optionsContainer.appendChild(optDiv);
            });
        };

        window.initCustomUI = () => {
            if(customUIInitialized) return;
            customUIInitialized = true;
            
            // Intercepta altera√ß√µes de valor via Javascript
            const originalSelectSetter = Object.getOwnPropertyDescriptor(HTMLSelectElement.prototype, 'value').set;
            Object.defineProperty(HTMLSelectElement.prototype, 'value', {
                set: function(val) {
                    originalSelectSetter.call(this, val);
                    if (this.closest('.custom-select-wrapper')) window.updateCustomSelect(this);
                },
                get: Object.getOwnPropertyDescriptor(HTMLSelectElement.prototype, 'value').get
            });
            
            // Re-sincroniza ao resetar formul√°rios
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('reset', () => { setTimeout(() => { form.querySelectorAll('select').forEach(s => { if(s.closest('.custom-select-wrapper')) window.updateCustomSelect(s); }); }, 10); });
            });
            
            // Fecha as caixas quando clicar fora
            document.addEventListener('click', () => {
                document.querySelectorAll('.custom-select-wrapper').forEach(w => w.classList.remove('open'));
                document.querySelectorAll('.custom-select-trigger .arrow').forEach(a => a.style.transform = 'rotate(0deg)');
            });
            window.setupCustomSelects();
        };

        let animationFrameId;
        function startMatrix() {
            const canvas = document.getElementById('matrixCanvas');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            
            const resize = () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            };
            window.addEventListener('resize', resize);
            resize();

            let particles = [];
            const particleCount = Math.floor((canvas.width * canvas.height) / 12000); // Densidade baseada na tela
            
            for(let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 1.0,
                    vy: (Math.random() - 0.5) * 1.0,
                    radius: Math.random() * 2 + 1,
                    color: Math.random() > 0.5 ? '#06b6d4' : '#ec4899' // Cyan ou Pink (Tr√°fego / Social)
                });
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                for(let i = 0; i < particles.length; i++) {
                    let p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if(p.y < 0 || p.y > canvas.height) p.vy *= -1;
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                    
                    // Conex√µes (Networking / Dados)
                    for(let j = i + 1; j < particles.length; j++) {
                        let p2 = particles[j];
                        let dx = p.x - p2.x;
                        let dy = p.y - p2.y;
                        let dist = Math.sqrt(dx*dx + dy*dy);
                        
                        if(dist < 150) {
                            ctx.beginPath();
                            ctx.moveTo(p.x, p.y);
                            ctx.lineTo(p2.x, p2.y);
                            
                            let grad = ctx.createLinearGradient(p.x, p.y, p2.x, p2.y);
                            let alpha = 1 - (dist / 150);
                            
                            let color1 = p.color === '#06b6d4' ? `rgba(6, 182, 212, ${alpha})` : `rgba(236, 72, 153, ${alpha})`;
                            let color2 = p2.color === '#06b6d4' ? `rgba(6, 182, 212, ${alpha})` : `rgba(236, 72, 153, ${alpha})`;
                            
                            grad.addColorStop(0, color1);
                            grad.addColorStop(1, color2);
                            
                            ctx.strokeStyle = grad;
                            ctx.lineWidth = 1;
                            ctx.stroke();
                        }
                    }
                }
                animationFrameId = requestAnimationFrame(draw);
            }
            if(animationFrameId) cancelAnimationFrame(animationFrameId);
            draw();
        }

        function stopMatrix() { 
            if(animationFrameId) cancelAnimationFrame(animationFrameId); 
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                stopMatrix();
                await initAppContent();
                window.initCustomUI();
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('dashboard-container').classList.remove('hidden');
                document.getElementById('dashboard-container').classList.add('flex');
            } else {
                document.getElementById('dashboard-container').classList.add('hidden');
                document.getElementById('login-page').classList.remove('hidden');
                startMatrix();
            }
        });

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login_email').value;
            const password = document.getElementById('login_password').value;
            try {
                await setPersistence(auth, browserLocalPersistence);
                await signInWithEmailAndPassword(auth, email, password);
            } catch (err) {
                document.getElementById('authError').classList.remove('hidden');
                document.getElementById('authError').textContent = "Acesso negado.";
            }
        }
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        window.handleLogout = () => signOut(auth);
        window.togglePasswordVisibility = () => { const pwd = document.getElementById('login_password'); pwd.type = pwd.type === 'password' ? 'text' : 'password'; };

        function formatCurrency(v) { return (parseFloat(v) || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); }
        function formatCompact(v) { if (v >= 1000000) return (v / 1000000).toFixed(1) + 'M'; if (v >= 1000) return (v / 1000).toFixed(1) + 'k'; return v.toString(); }
        function showMessage(t, e = false) { const b = document.getElementById('messageBox'); b.innerHTML = `<span class="${e ? 'text-red-400' : 'text-green-400'} mr-2">‚óè</span> ${t}`; b.classList.remove('hidden'); b.classList.add(e ? 'bg-red-900/80' : 'bg-slate-800'); setTimeout(() => b.classList.add('hidden'), 3000); }

        async function initAppContent() {
            clientsCollection = collection(db, 'users', userId, 'clients');
            resultsCollection = collection(db, 'users', userId, 'results');
            socialResultsCollection = collection(db, 'users', userId, 'social_results');
            tasksCollection = collection(db, 'users', userId, 'tasks');
            credentialsCollection = collection(db, 'users', userId, 'credentials');
            videosCollection = collection(db, 'users', userId, 'videos'); // Setup da cole√ß√£o

            onSnapshot(clientsCollection, s => { clients = s.docs.map(d => ({ id: d.id, ...d.data() })); renderClientList(); populateClientSelects(); });
            onSnapshot(resultsCollection, s => { results = s.docs.map(d => ({ id: d.id, ...d.data() })); renderResultsTable(); });
            onSnapshot(socialResultsCollection, s => { socialResults = s.docs.map(d => ({ id: d.id, ...d.data() })); renderSocialResultsTable(); });
            onSnapshot(videosCollection, s => { videos = s.docs.map(d => ({ id: d.id, ...d.data() })); renderVideosList(); }); // Listener de v√≠deos
            onSnapshot(tasksCollection, s => { 
                tasks = s.docs.map(d => ({ id: d.id, ...d.data() })); 
                renderCalendar(); 
                renderTaskManagement(); 
                
                // Initialize Header if empty
                const displayDate = document.getElementById('summaryDateDisplay');
                if (displayDate && !displayDate.textContent) {
                     const selectedDate = new Date(currentSummaryDateStr + "T00:00:00");
                     displayDate.textContent = selectedDate.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
                }

                renderDaySummaryList(); // Always render summary on updates
            });
            switchTab('clientes');
            attachCalculationListeners();
        }

        window.toggleCredentialsModal = () => document.getElementById('credentialsModal').classList.toggle('hidden');
        window.openCredentialsModal = async (clientId) => {
            const client = clients.find(c => c.id === clientId); if(!client) return;
            document.getElementById('cred_client_name').textContent = `Cliente: ${client.nome}`; 
            document.getElementById('cred_client_id').value = client.id; 
            document.getElementById('credentialsList').innerHTML = '<p class="text-center text-gray-500 animate-pulse mt-4">Carregando acessos...</p>';
            cancelEditCredential(); // Limpa o formul√°rio
            toggleCredentialsModal();
            const q = query(credentialsCollection, where("clientId", "==", clientId));
            const snapshot = await getDocs(q);
            currentCredentialsList = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            renderCredentialsList(currentCredentialsList);
        };

        function renderCredentialsList(list) {
            const container = document.getElementById('credentialsList'); container.innerHTML = '';
            if(list.length === 0) { document.getElementById('noCredentials').classList.remove('hidden'); return; }
            document.getElementById('noCredentials').classList.add('hidden');
            list.forEach(cred => {
                const div = document.createElement('div');
                div.className = "bg-slate-800/80 p-4 rounded-xl border border-slate-700 shadow-lg hover:border-indigo-500/50 transition group";
                div.innerHTML = `<div class="flex justify-between items-start"><div class="flex items-center gap-2"><span class="bg-indigo-900/50 text-indigo-300 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider border border-indigo-500/20">${cred.platform}</span></div><div class="flex items-center gap-2"><button onclick="editCredential('${cred.id}')" class="text-slate-600 hover:text-indigo-400 transition" title="Editar"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg></button><button onclick="deleteCredential('${cred.id}', '${cred.clientId}')" class="text-slate-600 hover:text-red-400 transition" title="Excluir"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button></div></div><div class="mt-3 space-y-2"><div class="flex items-center gap-2 bg-slate-900 p-2 rounded border border-slate-800"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg><span class="text-sm text-gray-300 select-all font-mono">${cred.login}</span><button onclick="copyToClipboard('${cred.login}')" class="ml-auto text-xs text-indigo-400 hover:text-white">Copiar</button></div><div class="flex items-center gap-2 bg-slate-900 p-2 rounded border border-slate-800"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg><span class="text-sm text-gray-300 font-mono flex-grow tracking-widest" id="pwd_disp_${cred.id}">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span><input type="hidden" id="pwd_val_${cred.id}" value="${cred.password}"><button onclick="toggleCredVisibility('${cred.id}')" class="text-gray-500 hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg></button><button onclick="copyToClipboard('${cred.password}')" class="text-xs text-indigo-400 hover:text-white ml-2">Copiar</button></div>${cred.notes ? `<p class="text-xs text-gray-500 mt-1 italic pl-1 border-l-2 border-slate-700">${cred.notes}</p>` : ''}</div>`;
                container.appendChild(div);
            });
        }

        window.toggleCredVisibility = (id) => { const disp = document.getElementById(`pwd_disp_${id}`); const val = document.getElementById(`pwd_val_${id}`).value; if(disp.textContent.includes('‚Ä¢')) { disp.textContent = val; disp.classList.remove('tracking-widest'); } else { disp.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'; disp.classList.add('tracking-widest'); } };
        window.copyToClipboard = (text) => { navigator.clipboard.writeText(text).then(() => showMessage("Copiado!")); };
        
        window.editCredential = (id) => {
            const cred = currentCredentialsList.find(c => c.id === id);
            if (!cred) return;
            document.getElementById('cred_id_edit').value = cred.id;
            document.getElementById('cred_platform').value = cred.platform;
            document.getElementById('cred_login').value = cred.login;
            document.getElementById('cred_password').value = cred.password;
            document.getElementById('cred_notes').value = cred.notes || "";
            document.getElementById('btn_save_cred').textContent = "ATUALIZAR ACESSO";
            document.getElementById('btn_cancel_cred').classList.remove('hidden');
        };

        window.cancelEditCredential = () => {
            document.getElementById('cred_id_edit').value = "";
            document.getElementById('cred_platform').value = "";
            document.getElementById('cred_login').value = "";
            document.getElementById('cred_password').value = "";
            document.getElementById('cred_notes').value = "";
            document.getElementById('btn_save_cred').textContent = "SALVAR NO COFRE";
            document.getElementById('btn_cancel_cred').classList.add('hidden');
        };

        window.deleteCredential = (id, clientId) => { window.pendingDeleteId = id; window.pendingDeleteCollection = 'credentials'; document.getElementById('confirmationModal').classList.remove('hidden'); document.getElementById('confirmationModal').classList.add('flex'); };
        
        document.getElementById('credentialForm').addEventListener('submit', async (e) => { 
            e.preventDefault(); 
            const clientId = document.getElementById('cred_client_id').value; 
            const editId = document.getElementById('cred_id_edit').value;
            const data = { 
                clientId: clientId, 
                platform: document.getElementById('cred_platform').value, 
                login: document.getElementById('cred_login').value, 
                password: document.getElementById('cred_password').value, 
                notes: document.getElementById('cred_notes').value, 
                createdAt: new Date().toISOString() 
            }; 
            
            if (editId) {
                await updateDoc(doc(db, 'users', userId, 'credentials', editId), data);
                showMessage("Acesso atualizado!");
            } else {
                await addDoc(credentialsCollection, data); 
                showMessage("Acesso salvo no cofre!"); 
            }
            
            cancelEditCredential();
            
            const q = query(credentialsCollection, where("clientId", "==", clientId)); 
            const snapshot = await getDocs(q); 
            currentCredentialsList = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            renderCredentialsList(currentCredentialsList); 
        });

        // --- CORE FUNCTIONS ---
        window.toggleServiceType = async (id, newType) => { const client = clients.find(c => c.id === id); if (!client) return; let types = client.serviceTypes || [client.serviceType]; if (!types.includes(newType)) { types.push(newType); await updateDoc(doc(db, 'users', userId, 'clients', id), { serviceTypes: types }); showMessage(`Servi√ßo ${newType.toUpperCase()} ativado!`); } };
        
        window.attachCalculationListeners = () => { 
            // Traffic Listeners
            ['res_investimento', 'res_impressoes', 'res_cliques', 'res_alcance', 'res_vendas', 'res_conversion_count'].forEach(id => { const el = document.getElementById(id); if(el) el.addEventListener('input', calculateLiveMetrics); }); 
            // Social Listeners
            ['soc_alcance', 'soc_interacoes', 'soc_seguidores', 'soc_novos_seguidores', 'soc_posts', 'soc_stories_views', 'soc_reels_views', 'soc_compartilhamentos', 'soc_salvamentos', 'soc_visitas_perfil', 'soc_link_cliques'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.addEventListener('input', calculateSocialLiveMetrics);
            });
        };
        
        window.calculateLiveMetrics = () => { 
            const inv = parseFloat(document.getElementById('res_investimento').value) || 0; 
            const imps = parseFloat(document.getElementById('res_impressoes').value) || 0; 
            const clicks = parseFloat(document.getElementById('res_cliques').value) || 0; 
            const reach = parseFloat(document.getElementById('res_alcance').value) || 0; 
            const sales = parseFloat(document.getElementById('res_vendas').value) || 0; 
            const conv = parseFloat(document.getElementById('res_conversion_count').value) || 0; 
            
            document.getElementById('roas_calc').textContent = (inv > 0 ? sales / inv : 0).toFixed(2) + 'x'; 
            document.getElementById('cpa_calc').textContent = formatCurrency(conv > 0 ? inv / conv : 0); 
            document.getElementById('cpc_calc').textContent = formatCurrency(clicks > 0 ? inv / clicks : 0); 
            document.getElementById('ctr_calc').textContent = (imps > 0 ? (clicks / imps) * 100 : 0).toFixed(2) + '%'; 
            document.getElementById('freq_calc').textContent = (reach > 0 ? imps / reach : 0).toFixed(2); 
            document.getElementById('tx_conv_calc').textContent = (clicks > 0 ? (conv / clicks) * 100 : 0).toFixed(2) + '%'; 
            
            // Ativa Anima√ß√£o de Pulsar
            const dashBoxes = document.querySelectorAll('.live-metric-box');
            dashBoxes.forEach(box => {
                box.classList.remove('metric-update');
                void box.offsetWidth; // Force reflow para reiniciar anima√ß√£o
                box.classList.add('metric-update');
            });
        };

        window.calculateSocialLiveMetrics = () => {
            const alc = parseFloat(document.getElementById('soc_alcance').value) || 0;
            const intBase = parseFloat(document.getElementById('soc_interacoes').value) || 0;
            const comp = parseFloat(document.getElementById('soc_compartilhamentos').value) || 0;
            const salv = parseFloat(document.getElementById('soc_salvamentos').value) || 0;
            const totalInt = intBase + comp + salv; // Soma real para engajamento completo

            const seg = parseFloat(document.getElementById('soc_seguidores').value) || 0;
            const novos = parseFloat(document.getElementById('soc_novos_seguidores').value) || 0;
            const posts = parseFloat(document.getElementById('soc_posts').value) || 0;
            
            const visitas = parseFloat(document.getElementById('soc_visitas_perfil').value) || 0;
            const cliques = parseFloat(document.getElementById('soc_link_cliques').value) || 0;
            
            const st = parseFloat(document.getElementById('soc_stories_views').value) || 0;
            const re = parseFloat(document.getElementById('soc_reels_views').value) || 0;

            document.getElementById('soc_er_calc').textContent = (alc > 0 ? (totalInt / alc) * 100 : 0).toFixed(2) + '%';
            document.getElementById('soc_gr_calc').textContent = (seg > 0 ? (novos / seg) * 100 : 0).toFixed(2) + '%';
            document.getElementById('soc_cv_calc').textContent = (visitas > 0 ? (cliques / visitas) * 100 : 0).toFixed(2) + '%';
            document.getElementById('soc_ipp_calc').textContent = (posts > 0 ? (totalInt / posts) : 0).toFixed(1);
            document.getElementById('soc_tv_calc').textContent = formatCompact(st + re);

            document.querySelectorAll('.social-metric-box').forEach(box => {
                box.classList.remove('social-metric-update'); void box.offsetWidth; box.classList.add('social-metric-update');
            });
        };

        window.switchTab = (id) => { document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active')); const tab = document.getElementById(id); if (tab) tab.classList.add('active'); document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active')); const nav = document.getElementById(`nav-${id}`); if(nav) nav.classList.add('active'); };
        
        // --- FUN√á√ÉO DE TRANSI√á√ÉO (LOADING PAGE) ---
        window.transitionToForm = (actionCallback, message = 'Acessando M√≥dulo...') => {
            const loader = document.getElementById('pageTransitionLoader');
            const textEl = document.getElementById('transitionLoaderText');
            const progressBar = document.getElementById('transitionProgressBar');

            textEl.textContent = message;
            
            // Reinicia a anima√ß√£o da barra
            progressBar.classList.remove('animate-load-progress');
            void progressBar.offsetWidth; // For√ßa o reflow
            progressBar.classList.add('animate-load-progress');

            // Mostra o fundo de loading
            loader.classList.remove('hidden');
            requestAnimationFrame(() => {
                loader.classList.remove('opacity-0');
                loader.classList.add('opacity-100');
            });

            // Tempo de "Carregamento" antes de abrir a p√°gina alvo
            setTimeout(() => {
                actionCallback(); // Executa a abertura do formul√°rio
                
                // Esconde a tela de loading suavemente
                loader.classList.remove('opacity-100');
                loader.classList.add('opacity-0');
                setTimeout(() => {
                    loader.classList.add('hidden');
                }, 300); // Aguarda o fim da opacidade
            }, 700); // 700ms de tempo de tela do "loading"
        };

        // Fun√ß√£o wrapper para o formul√°rio de Tr√°fego (limpeza de campos antes de abrir)
        window.openNewTrafficForm = () => {
            document.getElementById('campaignForm').reset(); 
            document.getElementById('res_id_edit').value=''; 
            document.querySelector('input[name=\'traffic_type_date\'][value=\'daily\']').checked=true; 
            toggleTrafficDateMode(); 
            toggleResultForm();
        };

        window.toggleFormCategory = (type) => { const btnTraffic = document.getElementById('form_btn_traffic'); const btnSocial = document.getElementById('form_btn_social'); const trafficFields = document.getElementById('trafficFields'); const socialFields = document.getElementById('socialMediaFields'); const hiddenType = document.getElementById('cli_service_type'); hiddenType.value = type; if(type === 'traffic') { btnTraffic.className = "flex-1 py-2 rounded-lg font-semibold bg-novan-primary text-white shadow-neon transition"; btnSocial.className = "flex-1 py-2 rounded-lg font-semibold bg-slate-700 text-gray-400 border border-slate-600 transition"; trafficFields.classList.remove('hidden'); socialFields.classList.add('hidden'); } else { btnSocial.className = "flex-1 py-2 rounded-lg font-semibold bg-novan-primary text-white shadow-neon transition"; btnTraffic.className = "flex-1 py-2 rounded-lg font-semibold bg-slate-700 text-gray-400 border border-slate-600 transition"; socialFields.classList.remove('hidden'); trafficFields.classList.add('hidden'); } };
        window.toggleClientForm = () => document.getElementById('clientRegistrationContainer').classList.toggle('hidden');
        
        window.setListingCategory = (type) => { 
            currentListingTab = type; 
            const tabTraffic = document.getElementById('list_tab_traffic'); 
            const tabSocial = document.getElementById('list_tab_social'); 
            const baseClass = "px-6 py-2 rounded-lg text-xs font-bold tracking-widest uppercase transition-all duration-300 border ";
            const trafficHover = "hover:border-cyan-500 hover:text-cyan-400 hover:bg-cyan-900/30 hover:shadow-[0_0_12px_rgba(6,182,212,0.5)]";
            const socialHover = "hover:border-pink-500 hover:text-pink-400 hover:bg-pink-900/30 hover:shadow-[0_0_12px_rgba(236,72,153,0.5)]";
            
            if(type === 'traffic') { 
                tabTraffic.className = baseClass + "border-slate-400 text-white bg-slate-800 " + trafficHover; 
                tabSocial.className = baseClass + "border-slate-700 text-slate-500 bg-transparent " + socialHover; 
            } else { 
                tabSocial.className = baseClass + "border-slate-400 text-white bg-slate-800 " + socialHover; 
                tabTraffic.className = baseClass + "border-slate-700 text-slate-500 bg-transparent " + trafficHover; 
            } 
            
            // Inicia o Estado de "Carregamento Futurista"
            const container = document.getElementById('clientList');
            const alphaSidebar = document.getElementById('alphaIndexSidebar');
            
            if(container) {
                alphaSidebar.classList.add('hidden');
                
                const ringColor = type === 'traffic' ? 'border-cyan-500' : 'border-pink-500';
                const ringBg = type === 'traffic' ? 'border-cyan-500/20' : 'border-pink-500/20';
                const textColor = type === 'traffic' ? 'text-cyan-400' : 'text-pink-400';
                const dotColor = type === 'traffic' ? 'bg-cyan-400' : 'bg-pink-400';
                const label = type === 'traffic' ? 'TR√ÅFEGO' : 'SOCIAL';
                const shadowGlow = type === 'traffic' ? 'shadow-[0_0_15px_rgba(6,182,212,0.6)]' : 'shadow-[0_0_15px_rgba(236,72,153,0.6)]';
                
                container.innerHTML = `
                    <div class="col-span-full flex flex-col items-center justify-center py-20">
                        <div class="relative w-16 h-16 mb-6">
                            <div class="absolute inset-0 border-4 ${ringBg} rounded-full"></div>
                            <div class="absolute inset-0 border-4 ${ringColor} rounded-full border-t-transparent animate-spin"></div>
                            <div class="absolute inset-0 flex items-center justify-center"><span class="w-2.5 h-2.5 ${dotColor} rounded-full ${shadowGlow} animate-pulse"></span></div>
                        </div>
                        <p class="${textColor} font-mono text-xs uppercase tracking-widest animate-pulse">A Sincronizar Base ${label}...</p>
                    </div>
                `;
                
                // Aguarda 500ms para criar a sensa√ß√£o de consulta ao banco de dados, depois renderiza
                setTimeout(() => {
                    renderClientList();
                }, 500);
            } else {
                renderClientList();
            }
        };
        
        // --- UPDATED RENDER CLIENT LIST WITH ALPHA SORT AND SIDEBAR ---
        window.renderClientList = () => { 
            const container = document.getElementById('clientList'); 
            const alphaSidebar = document.getElementById('alphaIndexSidebar');
            if(!container) return; 
            container.innerHTML = ''; 
            alphaSidebar.innerHTML = '';
            
            const filteredClients = clients.filter(c => (c.serviceTypes || [c.serviceType]).includes(currentListingTab)); 
            
            if (filteredClients.length === 0) { 
                document.getElementById('noClients').classList.remove('hidden'); 
                alphaSidebar.classList.add('hidden');
                return; 
            } 
            
            document.getElementById('noClients').classList.add('hidden'); 
            alphaSidebar.classList.remove('hidden');
            alphaSidebar.classList.add('md:flex'); // Restore flex if it was hidden

            // 1. Sort Alphabetically
            filteredClients.sort((a, b) => a.nome.localeCompare(b.nome));

            // 2. Track letters for Sidebar
            let currentLetter = '';
            let lettersFound = new Set();
            let index = 0; // Utilizado para o atraso (stagger) na anima√ß√£o

            filteredClients.forEach(c => { 
                const isActive = c.active !== false; 
                const cardColor = isActive ? (c.color || '#06b6d4') : '#334155'; 
                const otherType = currentListingTab === 'traffic' ? 'social' : 'traffic'; 
                const hasOtherService = (c.serviceTypes || [c.serviceType]).includes(otherType); 
                
                // Letter grouping logic
                const firstLetter = c.nome.charAt(0).toUpperCase();
                let anchorId = '';
                if (firstLetter !== currentLetter) {
                    currentLetter = firstLetter;
                    lettersFound.add(currentLetter);
                    anchorId = `client-anchor-${currentLetter}`;
                }

                // Ajuste no bot√£o de Multiservi√ßo para caber perfeitamente
                let actionButton = hasOtherService ? 
                    `<span class="bg-slate-900/80 border border-cyan-500/30 text-cyan-400 text-[9px] uppercase font-bold py-1.5 px-0 rounded-md flex items-center justify-center cursor-default tracking-widest w-full text-center truncate">MULTI ‚ú®</span>` : 
                    `<button onclick="toggleServiceType('${c.id}', '${otherType}')" class="bg-slate-700/80 hover:bg-slate-600 text-amber-400 text-[9px] uppercase font-bold py-1.5 px-0 rounded-md transition border border-transparent hover:border-amber-400/30 tracking-widest w-full text-center truncate">+ ${otherType === 'traffic' ? 'TR√ÅFEGO' : 'SOCIAL'}</button>`; 
                
                const statusIndicator = isActive 
                    ? `<span class="relative flex h-3 w-3" title="Ativo"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-green-500 shadow-[0_0_8px_#22c55e]"></span></span>` 
                    : `<span class="relative flex h-3 w-3" title="Inativo"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75" style="animation-duration: 2s;"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-red-600 shadow-[0_0_10px_#ef4444]"></span></span>`;

                // Inserindo a classe client-card-animate e o c√°lculo de animation-delay
                container.innerHTML += `
                    <div ${anchorId ? `id="${anchorId}"` : ''} class="client-card-animate group relative bg-slate-800/80 p-4 rounded-xl border-t-2 border-b border-r border-l border-slate-700/50 hover:bg-slate-800 transition-all hover:shadow-lg hover:shadow-cyan-900/20 overflow-hidden ${!isActive ? 'opacity-60 grayscale-[40%]' : ''}" style="border-top-color: ${cardColor}; animation-delay: ${index * 0.05}s;">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-base text-white group-hover:text-cyan-400 transition truncate pr-2">${c.nome}</h4>
                            ${statusIndicator}
                        </div>
                        <p class="text-[10px] text-gray-400 mb-4 font-mono tracking-tight">${c.serviceType === 'traffic' ? 'TR√ÅFEGO' : 'SOCIAL'}</p>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-1.5 mt-auto relative z-10 opacity-70 group-hover:opacity-100 transition-opacity">
                            <button onclick="viewClientDetails('${c.id}')" class="bg-slate-700/80 hover:bg-slate-600 text-white text-[9px] uppercase font-bold py-1.5 px-1 rounded-md transition tracking-wider w-full flex items-center justify-center truncate">Ver Info</button>
                            ${actionButton}
                            <button onclick="openCredentialsModal('${c.id}')" class="bg-slate-700/80 hover:bg-slate-600 text-indigo-300 text-[9px] uppercase font-bold py-1.5 px-1 rounded-md transition flex items-center justify-center gap-1 tracking-wider w-full truncate">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg> Acessos
                            </button>
                            <button onclick="editClient('${c.id}')" class="bg-slate-700/80 hover:bg-slate-600 text-indigo-400 text-[9px] uppercase font-bold py-1.5 px-1 rounded-md transition tracking-wider w-full flex items-center justify-center truncate">Editar</button>
                            <button onclick="toggleClientStatus('${c.id}', ${isActive})" class="bg-slate-700/80 hover:bg-slate-600 ${isActive ? 'text-orange-400' : 'text-green-400'} text-[9px] uppercase font-bold py-1.5 px-1 rounded-md transition tracking-wider w-full flex items-center justify-center truncate">${isActive ? 'Inativar' : 'Ativar'}</button>
                            <button onclick="deleteClient('${c.id}')" class="bg-slate-700/80 hover:bg-slate-600 text-red-400 text-[9px] uppercase font-bold py-1.5 px-1 rounded-md transition tracking-wider w-full flex items-center justify-center truncate">Excluir</button>
                        </div>
                    </div>`; 
                index++;
            });

            // 3. Render Sidebar
            lettersFound.forEach(letter => {
                alphaSidebar.innerHTML += `<a onclick="scrollToClientLetter('${letter}')" class="alpha-link">${letter}</a>`;
            });
        };
        
        window.scrollToClientLetter = (letter) => {
            const el = document.getElementById(`client-anchor-${letter}`);
            if(el) {
                // Adjust scroll position to account for sticky header or padding if needed
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Visual feedback
                el.classList.add('ring-2', 'ring-cyan-500', 'ring-offset-2', 'ring-offset-slate-900');
                setTimeout(() => el.classList.remove('ring-2', 'ring-cyan-500', 'ring-offset-2', 'ring-offset-slate-900'), 2000);
            }
        };

        window.editClient = (id) => { 
            const c = clients.find(item => item.id === id); 
            if(!c) return; 
            document.getElementById('cli_id_edit').value = c.id; 
            document.getElementById('cli_nome').value = c.nome; 
            document.getElementById('cli_segmento').value = c.segmento || ""; 
            document.getElementById('cli_email').value = c.email || ""; 
            document.getElementById('cli_data_inicio').value = c.dataInicio || ""; 
            document.getElementById('cli_responsavel').value = c.responsavel; 
            document.getElementById('cli_telefone').value = c.telefone; 
            document.getElementById('cli_logo').value = c.logo || ""; 
            document.getElementById('cli_link').value = c.link || ""; 
            document.getElementById('cli_observacoes').value = c.observacoes || ""; 
            
            const editType = c.serviceType || (c.serviceTypes ? c.serviceTypes[0] : 'traffic'); 
            toggleFormCategory(editType); 
            document.getElementById('clientRegistrationContainer').classList.remove('hidden'); 
            
            if(editType === 'traffic') { 
                document.getElementById('cli_plataforma_traffic').value = c.plataformaTraffic || "Meta"; 
                document.getElementById('cli_budget_value_traffic').value = c.budgetValueTraffic || ""; 
                document.getElementById('cli_target_roas').value = c.targetRoas || "";
                document.getElementById('cli_conversion_goals_traffic').value = c.conversionGoalsTraffic || "Mensagem"; 
            } else { 
                document.getElementById('cli_sm_fee').value = c.smFee || ""; 
                document.getElementById('cli_target_followers').value = c.targetFollowers || "";
                document.getElementById('cli_sm_platform').value = c.smPlatform || "Instagram"; 
                document.getElementById('cli_sm_needs').value = c.smNeeds || "Conteudo"; 
            } 
            window.scrollTo({ top: 0, behavior: 'smooth' }); 
        };

        window.toggleClientStatus = async (id, current) => { await updateDoc(doc(db, 'users', userId, 'clients', id), { active: !current }); showMessage(`Status alterado!`); };
        window.viewClientDetails = (id) => { const c = clients.find(item => item.id === id); if(!c) return; const content = `<div class="p-4 bg-slate-950 rounded-lg space-y-3 text-sm text-gray-300 border border-slate-800"><p><strong>Respons√°vel:</strong> <span class="text-white">${c.responsavel}</span></p><p><strong>Contato:</strong> ${c.telefone}</p><p><strong>Plataforma:</strong> ${c.plataformaTraffic || c.smPlatform}</p><p><strong>Investimento:</strong> ${formatCurrency(c.budgetValueTraffic || c.smFee)}</p><p><strong>Link:</strong> <a href="${c.link}" target="_blank" class="text-cyan-400 hover:text-white transition underline">${c.link || '-'}</a></p><p class="border-t border-slate-800 pt-2 italic text-xs">"${c.observacoes || 'Sem notas'}"</p></div>`; document.getElementById('summaryModal').classList.remove('hidden'); document.getElementById('summaryModal').classList.add('flex'); document.getElementById('summaryTitle').textContent = c.nome; document.getElementById('summaryContent').innerHTML = content; };
        window.deleteClient = (id) => { window.pendingDeleteId = id; window.pendingDeleteCollection = 'clients'; document.getElementById('confirmationModal').classList.remove('hidden'); document.getElementById('confirmationModal').classList.add('flex'); };
        window.toggleResultForm = () => { document.getElementById('resultFormContainer').classList.toggle('hidden'); if(!document.getElementById('resultFormContainer').classList.contains('hidden')) calculateLiveMetrics(); };
        window.toggleVideoForm = () => { document.getElementById('videoFormContainer').classList.toggle('hidden'); }; // Novo toggle
        window.toggleTrafficDateMode = () => { const type = document.querySelector('input[name="traffic_type_date"]:checked').value; const daily = type === 'daily'; document.getElementById('traffic_daily_input').classList.toggle('hidden', !daily); document.getElementById('traffic_period_input').classList.toggle('hidden', daily); document.getElementById('traffic_period_input').classList.toggle('flex', !daily); document.getElementById('res_data').required = daily; document.getElementById('res_data_inicio').required = !daily; document.getElementById('res_data_fim').required = !daily; };
        window.setTrafficDateRange = (days) => { if (days === 'all') { document.getElementById('results_filter_end_date').value = ""; document.getElementById('results_filter_start_date').value = ""; renderResultsTable(); return; } const end = new Date(); const start = new Date(); if (days !== 1) start.setDate(end.getDate() - (days - 1)); document.getElementById('results_filter_end_date').value = end.toISOString().split('T')[0]; document.getElementById('results_filter_start_date').value = start.toISOString().split('T')[0]; renderResultsTable(); };
        window.renderResultsTable = function() { 
            const list = document.getElementById('resultsListContainer'); 
            const filterClient = document.getElementById('results_filter_cliente').value; 
            const start = document.getElementById('results_filter_start_date').value; 
            const end = document.getElementById('results_filter_end_date').value; 
            if (!list) return; 
            let filtered = [...results]; 
            if (filterClient) filtered = filtered.filter(r => r.clientId === filterClient); 
            if (start) filtered = filtered.filter(r => (r.dataFim || r.data) >= start); 
            if (end) filtered = filtered.filter(r => (r.dataFim || r.data) <= end); 
            filtered.sort((a, b) => new Date(b.dataFim || b.data) - new Date(a.dataFim || a.data)); 
            const summary = filtered.reduce((acc, r) => { acc.gasto += r.investimento; acc.vendas += r.vendas; acc.conv += r.conversionCount || 0; acc.imp += r.impressoes; acc.cliques += r.cliques || 0; acc.alcance += r.alcance || 0; return acc; }, { gasto: 0, vendas: 0, conv: 0, imp: 0, cliques: 0, alcance: 0 }); 
            
            const ticketMedioRes = summary.conv > 0 ? summary.vendas / summary.conv : 0;

            const kpis = [
                { l: 'Investimento', v: formatCurrency(summary.gasto), c: 'red' },
                { l: 'Retorno', v: formatCurrency(summary.vendas), c: 'emerald' },
                { l: 'ROAS', v: (summary.gasto > 0 ? summary.vendas / summary.gasto : 0).toFixed(2) + 'x', c: 'yellow' },
                { l: 'Ticket M√©dio', v: formatCurrency(ticketMedioRes), c: 'green' },
                { l: 'CPA', v: formatCurrency(summary.conv > 0 ? summary.gasto / summary.conv : 0), c: 'indigo' },
                { l: 'CPC M√©dio', v: formatCurrency(summary.cliques > 0 ? summary.gasto / summary.cliques : 0), c: 'cyan' },
                { l: 'CTR M√©dio', v: (summary.imp > 0 ? (summary.cliques / summary.imp) * 100 : 0).toFixed(2) + '%', c: 'purple' },
                { l: 'Tx. Conv.', v: (summary.cliques > 0 ? (summary.conv / summary.cliques) * 100 : 0).toFixed(2) + '%', c: 'pink' },
                { l: 'Freq. M√©d', v: (summary.alcance > 0 ? summary.imp / summary.alcance : 0).toFixed(2), c: 'blue' },
                { l: 'Cliques', v: formatCompact(summary.cliques), c: 'orange' },
                { l: 'Convers√µes', v: formatCompact(summary.conv), c: 'teal' }
            ];
            document.getElementById('kpiCardsContainer').className = "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-8 text-white";
            document.getElementById('kpiCardsContainer').innerHTML = kpis.map((k, i) => window.renderKpiCard(k.l, k.v, k.c, i)).join('');
            
            list.innerHTML = ''; 
            
            if (filtered.length === 0) { 
                list.innerHTML = '<div class="text-center py-10 bg-slate-900/50 rounded-xl border border-slate-800"><p class="text-slate-500 italic">Nenhum resultado de tr√°fego encontrado para este filtro.</p></div>'; 
                return; 
            }

            let index = 0;
            filtered.forEach(res => { 
                const client = clients.find(c => c.id === res.clientId); 
                const color = client?.color || '#06b6d4'; 
                const dateDisplay = (res.dataInicio && res.dataFim && res.dataInicio !== res.dataFim) ? `${new Date(res.dataInicio+'T12:00:00').toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit'})} a ${new Date(res.dataFim+'T12:00:00').toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit'})}` : new Date(res.data+'T12:00:00').toLocaleDateString('pt-BR'); 
                
                // C√°lculos Seguros Extras
                const roasNum = res.roas || (res.investimento > 0 ? res.vendas / res.investimento : 0);
                const roasColor = roasNum >= 2 ? 'text-emerald-400 drop-shadow-[0_0_8px_rgba(52,211,153,0.5)]' : (roasNum >= 1 ? 'text-yellow-400' : 'text-red-400');
                const lucro = (res.vendas || 0) - (res.investimento || 0);
                const lucroStr = formatCurrency(lucro);
                const lucroColor = lucro >= 0 ? 'text-emerald-400' : 'text-red-400';
                
                const cpaNum = res.cpa || (res.conversionCount > 0 ? res.investimento / res.conversionCount : 0);
                const ticketMedioCard = res.conversionCount > 0 ? res.vendas / res.conversionCount : 0;
                const cpcNum = res.cpc || (res.cliques > 0 ? res.investimento / res.cliques : 0);
                const ctrNum = res.ctr || (res.impressoes > 0 ? (res.cliques / res.impressoes) * 100 : 0);
                const freqNum = res.frequency || (res.alcance > 0 ? res.impressoes / res.alcance : 0);

                // √çcones de Plataforma Inteligentes
                let platIcon = '<svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" /></svg>';
                if(res.plataforma === 'Meta') platIcon = '<svg class="w-3 h-3 text-blue-500" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.879V15.34H7.898v-3.34h2.54V9.45c0-2.507 1.493-3.89 3.776-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562v1.873h2.773l-.443 3.34h-2.33v6.54C18.343 21.129 22 16.99 22 12c0-5.523-4.477-10-10-10z"/></svg>';
                if(res.plataforma === 'Google') platIcon = '<svg class="w-3 h-3 text-red-500" viewBox="0 0 24 24" fill="currentColor"><path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"/></svg>';
                if(res.plataforma === 'TikTok') platIcon = '<svg class="w-3 h-3 text-white" viewBox="0 0 24 24" fill="currentColor"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 2.23-1.15 4.35-2.96 5.6-2.19 1.52-5.18 1.63-7.48.24-2.22-1.33-3.47-3.85-3.23-6.42.23-2.58 1.78-4.85 4.15-5.83 1.34-.56 2.84-.66 4.23-.39V14.2c-1.07-.4-2.3-.3-3.26.24-1.05.58-1.7 1.76-1.57 2.97.13 1.25 1.12 2.31 2.33 2.63 1.46.38 3.12-.13 3.94-1.42.34-.53.53-1.16.51-1.8V.02z"/></svg>';
                
                list.innerHTML += `
                <div class="client-card-animate bg-slate-800/60 backdrop-blur-sm p-5 rounded-2xl border border-slate-700/50 hover:bg-slate-800 hover:border-cyan-500/30 hover:shadow-[0_8px_30px_rgba(6,182,212,0.15)] transition-all duration-300 group relative overflow-hidden flex flex-col" style="animation-delay: ${index * 0.05}s;">
                    <!-- Linha Decorativa Din√¢mica -->
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[${color}] to-transparent opacity-40 group-hover:opacity-100 transition-all duration-500 shadow-[0_0_10px_${color}]"></div>
                    
                    <!-- Cabe√ßalho do Card -->
                    <div class="flex justify-between items-start mb-4">
                        <div class="max-w-[75%]">
                            <div class="flex items-center gap-2 mb-1.5 flex-wrap">
                                <h4 class="font-black text-lg text-white group-hover:text-cyan-400 transition-colors drop-shadow-md truncate" style="text-shadow: 0 0 10px ${color}40;">${client?.nome || 'Geral'}</h4>
                                <span class="px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider bg-slate-900 border border-slate-700 text-slate-300 flex items-center gap-1 shadow-inner">${platIcon} ${res.plataforma}</span>
                            </div>
                            <div class="flex flex-wrap items-center gap-2 text-[10px] text-gray-500 font-mono tracking-tight">
                                <span class="bg-slate-900/80 px-2 py-0.5 rounded-md border border-slate-700/50 text-cyan-200/80 flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-4 10h.01M3 21h18a2 2 0 002-2V7a2 2 0 00-2-2H3a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                    ${dateDisplay}
                                </span>
                                ${res.campanha ? `<span class="bg-indigo-900/30 text-indigo-300 px-2 py-0.5 rounded-md border border-indigo-500/30 truncate max-w-[160px] flex items-center gap-1 shadow-[0_0_8px_rgba(99,102,241,0.1)]" title="${res.campanha}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg>
                                    ${res.campanha}
                                </span>` : ''}
                            </div>
                        </div>
                        
                        <!-- A√ß√µes R√°pidas (Aparecem no Hover) -->
                        <div class="flex gap-1 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity bg-slate-900/80 p-1 rounded-lg border border-slate-700">
                            <button onclick="editResult('${res.id}')" class="p-1.5 text-slate-400 hover:text-indigo-400 hover:bg-slate-800 rounded transition-colors" title="Editar"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg></button>
                            <button onclick="deleteResult('${res.id}')" class="p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-800 rounded transition-colors" title="Excluir"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                        </div>
                    </div>

                    <!-- Grade de M√©tricas Principais -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-4">
                        <div class="bg-slate-900/50 p-3 rounded-xl border border-slate-700/50 hover:border-red-500/30 transition-colors">
                            <p class="text-[9px] uppercase tracking-widest text-slate-500 mb-0.5 font-bold">Gasto (Ads)</p>
                            <p class="text-sm font-bold text-red-400">${formatCurrency(res.investimento)}</p>
                        </div>
                        <div class="bg-slate-900/50 p-3 rounded-xl border border-slate-700/50 hover:border-emerald-500/30 transition-colors">
                            <p class="text-[9px] uppercase tracking-widest text-slate-500 mb-0.5 font-bold">Faturamento</p>
                            <p class="text-sm font-bold text-emerald-400">${formatCurrency(res.vendas)}</p>
                        </div>
                        <div class="bg-slate-900/80 p-3 rounded-xl border border-slate-700/80 shadow-inner group/roas relative overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/20 pointer-events-none"></div>
                            <p class="text-[9px] uppercase tracking-widest text-slate-500 mb-0.5 font-bold">ROAS</p>
                            <p class="text-xl font-black tracking-tight ${roasColor} relative z-10 transition-transform group-hover/roas:scale-105 origin-left">${roasNum.toFixed(2)}x</p>
                        </div>
                        <div class="bg-slate-900/50 p-3 rounded-xl border border-slate-700/50 hover:border-indigo-500/30 transition-colors relative">
                            <p class="text-[9px] uppercase tracking-widest text-slate-500 mb-0.5 font-bold flex justify-between">
                                CPA 
                                <span class="text-purple-400 font-mono">${res.conversionCount || 0} ${res.conversionType === 'Compras' ? 'üõí' : (res.conversionType === 'Leads' ? 'üìù' : '‚ö°')}</span>
                            </p>
                            <p class="text-sm font-bold text-indigo-400">${formatCurrency(cpaNum)}</p>
                        </div>
                    </div>

                    <!-- Rodap√© do Card (M√©tricas Secund√°rias) -->
                    <div class="mt-auto pt-3 border-t border-slate-700/50 flex flex-wrap items-center justify-between gap-3 text-[10px] md:text-xs">
                        <!-- Lucro / Preju√≠zo Destacado -->
                        <div class="flex items-center gap-1.5 px-2.5 py-1 rounded bg-slate-950 border border-slate-800 shadow-inner">
                            <span class="text-slate-500 uppercase tracking-widest font-bold text-[9px]">Lucro:</span>
                            <span class="font-bold font-mono tracking-tight ${lucroColor}">${lucro >= 0 ? '+' : ''}${lucroStr}</span>
                        </div>
                        
                        <!-- Mini KPIs Inferiores -->
                        <div class="flex gap-4 font-mono">
                            <span class="text-slate-500" title="Ticket M√©dio">TM: <strong class="text-emerald-400">${formatCurrency(ticketMedioCard)}</strong></span>
                            <span class="text-slate-500" title="Custo por Clique">CPC: <strong class="text-cyan-400">${formatCurrency(cpcNum)}</strong></span>
                            <span class="text-slate-500 hidden md:inline" title="Click-Through Rate">CTR: <strong class="text-yellow-400">${ctrNum.toFixed(2)}%</strong></span>
                            <span class="text-slate-500 hidden lg:inline" title="Frequ√™ncia">Freq: <strong class="text-blue-400">${freqNum.toFixed(2)}</strong></span>
                        </div>
                    </div>
                    
                    ${res.observacoes ? `<div class="mt-3 text-[10px] text-slate-400 italic bg-slate-900/30 p-2 rounded-lg border border-slate-700/30 border-l-2 border-l-cyan-500/50 line-clamp-1 group-hover:line-clamp-none transition-all duration-300">üí¨ ${res.observacoes}</div>` : ''}
                </div>`; 
                index++;
            }); 
        };
        window.toggleSocialResultForm = () => document.getElementById('socialResultFormContainer').classList.toggle('hidden');
        window.setSocialDateRange = (days) => { if (days === 'all') { document.getElementById('social_filter_end').value = ""; document.getElementById('social_filter_start').value = ""; renderSocialResultsTable(); return; } const end = new Date(); const start = new Date(); if (days !== 1) start.setDate(end.getDate() - (days - 1)); document.getElementById('social_filter_end').value = end.toISOString().split('T')[0]; document.getElementById('social_filter_start').value = start.toISOString().split('T')[0]; renderSocialResultsTable(); };
        window.renderSocialResultsTable = function() { 
            const list = document.getElementById('socialResultsListContainer'); 
            const kpiCont = document.getElementById('socialKpiCardsContainer');
            const filterClient = document.getElementById('social_filter_cliente').value; 
            const start = document.getElementById('social_filter_start').value; 
            const end = document.getElementById('social_filter_end').value; 
            if (!list) return; 
            let filtered = [...socialResults]; 
            if (filterClient) filtered = filtered.filter(r => r.clientId === filterClient); 
            if (start) filtered = filtered.filter(r => (r.dataFim || r.data) >= start); 
            if (end) filtered = filtered.filter(r => (r.dataFim || r.data) <= end); 
            filtered.sort((a, b) => new Date(b.dataFim || b.data) - new Date(a.dataFim || a.data)); 
            
            const totalNewFollowers = filtered.reduce((acc, r) => acc + (r.novosSeguidores || 0), 0);
            const avgEngagement = filtered.length > 0 ? (filtered.reduce((acc, r) => acc + (r.engagementRate || 0), 0) / filtered.length) : 0;
            const totalReach = filtered.reduce((acc, r) => acc + (r.alcance || 0), 0);
            const totalInteractions = filtered.reduce((acc, r) => acc + (r.interacoes || 0), 0);
            const totalImpressions = filtered.reduce((acc, r) => acc + (r.impressoes || 0), 0);

            const skpis = [
                { l: 'Novos Seguid.', v: '+'+formatCompact(totalNewFollowers), c: 'green' },
                { l: 'Engajamento', v: avgEngagement.toFixed(2)+'%', c: 'pink' },
                { l: 'Alcance', v: formatCompact(totalReach), c: 'cyan' },
                { l: 'Intera√ß√µes', v: formatCompact(totalInteractions), c: 'yellow' },
                { l: 'Impress√µes', v: formatCompact(totalImpressions), c: 'indigo' }
            ];
            if(kpiCont) kpiCont.innerHTML = skpis.map((k, i) => window.renderKpiCard(k.l, k.v, k.c, i)).join('');

            list.innerHTML = ''; 
            if (filtered.length === 0) { list.innerHTML = '<p class="text-center text-slate-500 italic mt-4">Nenhum resultado social encontrado.</p>'; return; } 
            filtered.forEach(res => { 
                const client = clients.find(c => c.id === res.clientId); 
                const color = client?.color || '#ec4899'; 
                const dateDisplay = (res.dataInicio && res.dataFim) ? `${new Date(res.dataInicio+'T12:00:00').toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit'})} √† ${new Date(res.dataFim+'T12:00:00').toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit'})}` : new Date(res.data+'T12:00:00').toLocaleDateString('pt-BR'); 
                list.innerHTML += `<div class="bg-slate-800 p-4 rounded-lg border-l-4 border-b border-r border-slate-700 shadow hover:bg-slate-700 transition-all group" style="border-left-color: ${color}"><div class="flex justify-between items-center mb-2"><div><div class="flex items-center gap-2"><span class="font-bold text-white text-sm group-hover:text-pink-400 transition">${client?.nome || 'Cliente'}</span><span class="text-[10px] text-pink-200 font-mono bg-pink-900/40 px-1 rounded border border-pink-500/30">${res.plataforma}</span><span class="text-[10px] text-gray-500 font-mono flex items-center gap-1">üìÖ ${dateDisplay}</span></div></div><div class="flex items-center gap-4"><div class="text-right"><span class="block text-lg font-bold text-pink-400">${(res.engagementRate || 0).toFixed(2)}%</span><span class="text-[9px] uppercase text-gray-500">Engajamento</span></div><div class="flex gap-1"><button onclick="editSocialResult('${res.id}')" class="p-2 text-slate-600 hover:text-indigo-400 transition-colors rounded-full hover:bg-slate-900/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg></button><button onclick="deleteSocialResult('${res.id}')" class="p-2 text-slate-600 hover:text-red-500 transition-colors rounded-full hover:bg-slate-900/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button></div></div></div><div class="grid grid-cols-2 md:grid-cols-5 gap-2 mt-2 pt-2 border-t border-slate-700/50 text-xs"><div class="text-gray-400">Seguidores: <span class="text-white font-medium">${formatCompact(res.seguidores)}</span> <span class="text-green-400 text-[10px]">(+${res.novosSeguidores || 0})</span></div><div class="text-gray-400">Alcance: <span class="text-cyan-400 font-medium">${formatCompact(res.alcance)}</span></div><div class="text-gray-400 hidden md:block">Impress√µes: <span class="text-white">${formatCompact(res.impressoes)}</span></div><div class="text-gray-400 hidden md:block">Intera√ß√µes: <span class="text-yellow-400">${formatCompact(res.interacoes)}</span></div><div class="text-gray-400 hidden md:block">Posts: <span class="text-white">${res.posts}</span></div></div></div>`; 
            }); 
        };

        window.editSocialResult = (id) => { 
            const res = socialResults.find(r => r.id === id); 
            if (!res) return; 
            document.getElementById('soc_id_edit').value = res.id; 
            if (res.dataInicio && res.dataFim) { 
                document.getElementById('soc_data_inicio').value = res.dataInicio; 
                document.getElementById('soc_data_fim').value = res.dataFim; 
            } else { 
                document.getElementById('soc_data_inicio').value = res.data; 
                document.getElementById('soc_data_fim').value = res.data; 
            } 
            document.getElementById('soc_cliente').value = res.clientId; 
            document.getElementById('soc_plataforma').value = res.plataforma; 
            document.getElementById('soc_seguidores').value = res.seguidores; 
            document.getElementById('soc_novos_seguidores').value = res.novosSeguidores || ""; 
            document.getElementById('soc_alcance').value = res.alcance; 
            document.getElementById('soc_impressoes').value = res.impressoes; 
            document.getElementById('soc_visitas_perfil').value = res.visitasPerfil || ""; 
            document.getElementById('soc_link_cliques').value = res.cliquesLink || ""; 
            
            document.getElementById('soc_interacoes').value = res.interacoes; 
            document.getElementById('soc_compartilhamentos').value = res.compartilhamentos || ""; 
            document.getElementById('soc_salvamentos').value = res.salvamentos || ""; 
            
            document.getElementById('soc_posts').value = res.posts; 
            document.getElementById('soc_sentimento').value = res.sentimento || "Positivo"; 
            document.getElementById('soc_stories_views').value = res.storiesViews || ""; 
            document.getElementById('soc_reels_views').value = res.reelsViews || ""; 
            document.getElementById('soc_best_post').value = res.bestPost || ""; 
            
            document.getElementById('soc_observacoes').value = res.observacoes || ""; 
            
            toggleSocialResultForm(); 
            calculateSocialLiveMetrics();
        };

        // --- SISTEMA DE CONTROLE DE V√çDEOS (NOVO) ---
        window.renderVideosList = () => {
            const list = document.getElementById('videosListContainer');
            const kpiCont = document.getElementById('videoKpiCardsContainer');
            const filterClient = document.getElementById('vid_filter_cliente').value;
            const start = document.getElementById('vid_filter_start').value;
            const end = document.getElementById('vid_filter_end').value;

            if (!list) return;
            
            let filtered = [...videos];
            if (filterClient) filtered = filtered.filter(v => v.clientId === filterClient);
            if (start) filtered = filtered.filter(v => v.dataEntrega >= start);
            if (end) filtered = filtered.filter(v => v.dataEntrega <= end);
            filtered.sort((a, b) => new Date(b.dataEntrega) - new Date(a.dataEntrega));

            // Calculando KPIs
            const totalVideos = filtered.reduce((acc, v) => acc + (v.quantidade || 0), 0);
            const clientsServed = new Set(filtered.map(v => v.clientId)).size;
            const pendingApproval = filtered.filter(v => v.status === 'Aguardando Aprova√ß√£o').reduce((acc, v) => acc + (v.quantidade || 0), 0);
            const refacoes = filtered.filter(v => v.status === 'Refa√ß√£o').length;

            const vkpis = [
                { l: 'V√≠deos Entregues', v: formatCompact(totalVideos), c: 'orange' },
                { l: 'Aprov. Pendentes', v: pendingApproval.toString(), c: 'yellow' },
                { l: 'Clientes Atendidos', v: clientsServed.toString(), c: 'teal' },
                { l: 'Alertas (Refa√ß√£o)', v: refacoes.toString(), c: 'red' }
            ];
            
            if(kpiCont) kpiCont.innerHTML = vkpis.map((k, i) => window.renderKpiCard(k.l, k.v, k.c, i)).join('');

            list.innerHTML = '';
            if (filtered.length === 0) {
                list.className = "col-span-full";
                list.innerHTML = '<div class="text-center py-10 bg-slate-900/50 rounded-xl border border-slate-800"><p class="text-slate-500 italic">Nenhum registro de v√≠deo encontrado.</p></div>';
                return;
            }
            list.className = "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6";

            filtered.forEach(vid => {
                const client = clients.find(c => c.id === vid.clientId);
                const color = client?.color || '#f97316';
                const dateDisplay = new Date(vid.dataEntrega + 'T12:00:00').toLocaleDateString('pt-BR');
                
                let statusColor = "bg-green-500/20 text-green-400 border-green-500/30";
                let statusIcon = "‚úÖ";
                if(vid.status === 'Aguardando Aprova√ß√£o') { statusColor = "bg-yellow-500/20 text-yellow-400 border-yellow-500/30"; statusIcon = "‚è≥"; }
                if(vid.status === 'Refa√ß√£o') { statusColor = "bg-red-500/20 text-red-400 border-red-500/30"; statusIcon = "üîÑ"; }

                let formatIcon = "üé¨";
                if(vid.formato.includes('Reels') || vid.formato.includes('TikTok')) formatIcon = "üì±";
                else if(vid.formato.includes('YouTube')) formatIcon = "‚ñ∂Ô∏è";

                list.innerHTML += `
                <div class="bg-slate-800/80 backdrop-blur-md p-5 rounded-2xl border border-slate-700 hover:border-orange-500/40 transition-all hover:shadow-lg group flex flex-col relative overflow-hidden" style="box-shadow: inset 0 4px 20px -10px ${color}60;">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-orange-500/5 rounded-bl-full pointer-events-none transition-transform group-hover:scale-110"></div>
                    
                    <div class="flex justify-between items-start mb-3 relative z-10">
                        <div class="flex flex-col gap-1">
                            <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider border flex items-center gap-1 w-fit ${statusColor}">${statusIcon} ${vid.status}</span>
                            <h4 class="font-black text-lg text-white group-hover:text-orange-400 transition-colors truncate max-w-[200px]">${client?.nome || 'Cliente Removido'}</h4>
                        </div>
                        <div class="flex gap-1 bg-slate-900/80 p-1 rounded-lg border border-slate-700">
                            <button onclick="editVideo('${vid.id}')" class="p-1.5 text-slate-400 hover:text-indigo-400 hover:bg-slate-800 rounded transition-colors" title="Editar"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg></button>
                            <button onclick="deleteVideo('${vid.id}')" class="p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-800 rounded transition-colors" title="Excluir"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                        </div>
                    </div>

                    <div class="flex items-end justify-between mb-4 relative z-10">
                        <div>
                            <p class="text-[10px] text-gray-400 uppercase tracking-widest font-bold mb-0.5">Entregues</p>
                            <p class="text-3xl font-black text-white leading-none">${vid.quantidade} <span class="text-sm font-medium text-slate-500 ml-1">v√≠deos</span></p>
                        </div>
                        <div class="text-right">
                            <span class="text-2xl">${formatIcon}</span>
                            <p class="text-[10px] text-orange-200 bg-orange-900/30 px-2 py-0.5 rounded border border-orange-500/20 font-mono mt-1">${vid.formato}</p>
                        </div>
                    </div>

                    <div class="mt-auto space-y-3 relative z-10">
                        <div class="flex items-center gap-2 text-xs text-slate-400 bg-slate-900/50 p-2 rounded-lg border border-slate-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-500 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-4 10h.01M3 21h18a2 2 0 002-2V7a2 2 0 00-2-2H3a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                            <span class="font-mono">${dateDisplay}</span>
                        </div>
                        
                        ${vid.observacoes ? `<p class="text-[10px] text-slate-400 italic line-clamp-1 group-hover:line-clamp-none transition-all">üí¨ ${vid.observacoes}</p>` : ''}
                        
                        <a href="${vid.linkDrive}" target="_blank" class="block w-full text-center bg-slate-800 hover:bg-orange-600 border border-slate-700 hover:border-orange-500 text-slate-300 hover:text-white font-bold py-2.5 rounded-xl transition-all shadow hover:shadow-[0_0_15px_rgba(249,115,22,0.4)] flex justify-center items-center gap-2 group/btn">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-400 group-hover/btn:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                            ACESSAR MATERIAL
                        </a>
                    </div>
                </div>`;
            });
        };

        window.editVideo = (id) => {
            const vid = videos.find(v => v.id === id);
            if (!vid) return;
            document.getElementById('vid_id_edit').value = vid.id;
            document.getElementById('vid_cliente').value = vid.clientId;
            document.getElementById('vid_data').value = vid.dataEntrega;
            document.getElementById('vid_quantidade').value = vid.quantidade;
            document.getElementById('vid_formato').value = vid.formato;
            document.getElementById('vid_link').value = vid.linkDrive;
            document.getElementById('vid_status').value = vid.status;
            document.getElementById('vid_observacoes').value = vid.observacoes || "";
            toggleVideoForm();
        };

        window.editResult = (id) => { 
            const res = results.find(r => r.id === id); 
            if (!res) return; 
            document.getElementById('res_id_edit').value = res.id; 
            
            if (res.dataInicio && res.dataFim && res.dataInicio !== res.dataFim) { 
                document.querySelector('input[name="traffic_type_date"][value="period"]').checked = true; 
                document.getElementById('res_data_inicio').value = res.dataInicio; 
                document.getElementById('res_data_fim').value = res.dataFim; 
            } else { 
                document.querySelector('input[name="traffic_type_date"][value="daily"]').checked = true; 
                document.getElementById('res_data').value = res.dataFim || res.data; 
            } 
            toggleTrafficDateMode(); 
            
            document.getElementById('res_cliente').value = res.clientId; 
            document.getElementById('res_plataforma').value = res.plataforma; 
            document.getElementById('res_campanha').value = res.campanha || ""; 
            document.getElementById('res_investimento').value = res.investimento; 
            document.getElementById('res_impressoes').value = res.impressoes; 
            document.getElementById('res_alcance').value = res.alcance; 
            document.getElementById('res_cliques').value = res.cliques; 
            document.getElementById('res_vendas').value = res.vendas; 
            document.getElementById('res_conversion_type').value = res.conversionType || ""; 
            document.getElementById('res_conversion_count').value = res.conversionCount || ""; 
            document.getElementById('res_observacoes').value = res.observacoes || ""; 
            
            toggleResultForm(); 
        };
        window.deleteVideo = (id) => { window.pendingDeleteId = id; window.pendingDeleteCollection = 'videos'; document.getElementById('confirmationModal').classList.remove('hidden'); document.getElementById('confirmationModal').classList.add('flex'); };
        window.deleteResult = (id) => { window.pendingDeleteId = id; window.pendingDeleteCollection = 'results'; document.getElementById('confirmationModal').classList.remove('hidden'); document.getElementById('confirmationModal').classList.add('flex'); };
        window.deleteSocialResult = (id) => { window.pendingDeleteId = id; window.pendingDeleteCollection = 'social_results'; document.getElementById('confirmationModal').classList.remove('hidden'); document.getElementById('confirmationModal').classList.add('flex'); };
        window.deleteTask = (id) => { window.pendingDeleteId = id; window.pendingDeleteCollection = 'tasks'; document.getElementById('confirmationModal').classList.remove('hidden'); document.getElementById('confirmationModal').classList.add('flex'); };
        window.closeConfirmModal = () => { document.getElementById('confirmationModal').classList.add('hidden'); document.getElementById('confirmationModal').classList.remove('flex'); window.pendingDeleteId = null; window.pendingDeleteCollection = null; };
        window.confirmDeleteAction = async () => { if(!window.pendingDeleteId) return; const delId = window.pendingDeleteId; const delColl = window.pendingDeleteCollection; closeConfirmModal(); try { await deleteDoc(doc(db, 'users', userId, delColl, delId)); showMessage("Item exclu√≠do com sucesso!"); if (delColl === 'credentials') { const clientId = document.getElementById('cred_client_id').value; if (clientId) { const q = query(credentialsCollection, where("clientId", "==", clientId)); const snapshot = await getDocs(q); currentCredentialsList = snapshot.docs.map(d => ({ id: d.id, ...d.data() })); renderCredentialsList(currentCredentialsList); } } } catch(e) { console.error(e); showMessage("Erro ao excluir.", true); } };
        window.generateDailySummary = async () => { const today = new Date().toISOString().split('T')[0]; const filtered = results.filter(r => r.data === today); if(!filtered.length) return showMessage("Sem dados para hoje.", true); const content = filtered.map(r => { const cli = clients.find(c => c.id === r.clientId); return `<div class="mb-2 pb-2 border-b border-gray-800 last:border-0"><span class="text-cyan-400 font-bold">${cli?.nome || 'Geral'}</span>: Gasto ${formatCurrency(r.investimento)} ‚ûî Retorno ${formatCurrency(r.vendas)} (${r.roas.toFixed(2)}x)</div>`; }).join(''); document.getElementById('summaryModal').classList.remove('hidden'); document.getElementById('summaryModal').classList.add('flex'); document.getElementById('summaryTitle').textContent = "Resumo Di√°rio"; document.getElementById('summaryContent').innerHTML = content; };
        window.toggleTaskForm = () => { const c = document.getElementById('taskFormContainer'); if(c.classList.contains('hidden')) { document.getElementById('taskForm').reset(); document.getElementById('task_id_edit').value = ''; document.getElementById('taskFormTitle').textContent = 'Nova Tarefa'; } c.classList.toggle('hidden'); };
        window.editTask = (id) => { const t = tasks.find(item => item.id === id); if(!t) return; document.getElementById('task_id_edit').value = t.id; document.getElementById('task_cliente').value = t.clientId; document.getElementById('task_tipo').value = t.type; document.getElementById('task_data').value = t.date; document.getElementById('task_status').value = t.status; document.getElementById('task_observacoes').value = t.notes || ""; document.getElementById('taskFormTitle').textContent = 'Editar Tarefa'; document.getElementById('taskFormContainer').classList.remove('hidden'); };
        window.changeMonth = (v) => { currentMonth.setMonth(currentMonth.getMonth() + v); window.renderCalendar(); };
        
        window.renderCalendar = () => {
            const grid = document.getElementById('calendarGrid');
            if(!grid) return;
            const myYear = currentMonth.getFullYear();
            const myMonth = currentMonth.getMonth();
            const today = new Date();
            today.setHours(0,0,0,0);
            
            const localTodayStr = toLocalISO(today);

            document.getElementById('currentMonthYear').textContent = currentMonth.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            grid.innerHTML = '';
            
            const first = new Date(myYear, myMonth, 1).getDay();
            const last = new Date(myYear, myMonth + 1, 0).getDate();
            const filter = document.getElementById('filterClient').value;

            // Renderiza Espa√ßos Vazios Elegantes
            for (let i = 0; i < first; i++) grid.innerHTML += '<div class="calendar-empty"></div>';
            
            for (let d = 1; d <= last; d++) {
                const dateStr = `${myYear}-${String(myMonth+1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                let dayTasks = tasks.filter(t => t.date.startsWith(dateStr));
                if(filter) dayTasks = dayTasks.filter(t => t.clientId === filter);
                
                const isToday = dateStr === localTodayStr;
                const isSelected = dateStr === currentSummaryDateStr && !document.getElementById('calendarSummary').classList.contains('hidden');

                const tasksHtml = dayTasks.map(t => {
                    const taskDate = new Date(t.date);
                    taskDate.setHours(0,0,0,0);
                    const isOverdue = (t.status === 'Pendente' || t.status === 'Em Andamento') && taskDate < today;
                    
                    // Design de P√≠lulas Minimalistas (Etiquetas Laterais)
                    let baseClass = "text-[9px] px-2 py-1.5 rounded mb-1.5 truncate flex items-center gap-1.5 border-l-2 bg-slate-900/60 font-medium tracking-wide border border-r border-t border-b border-slate-800/50";
                    let stateClass = "border-l-blue-500 text-blue-300";
                    let dotClass = "bg-blue-400 animate-pulse opacity-80";
                    let icon = "";

                    if (isOverdue) {
                        stateClass = "border-l-red-500 text-red-300 bg-red-900/10";
                        dotClass = "bg-red-500 animate-pulse shadow-[0_0_8px_rgba(239,68,68,0.8)]";
                    } else if (t.status === 'Concluido') {
                        stateClass = "border-l-emerald-500 text-emerald-500 opacity-60 bg-emerald-900/10";
                        icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-2.5 w-2.5 shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>`;
                        dotClass = "hidden";
                    } else if (t.status === 'Em Andamento') {
                        stateClass = "border-l-amber-500 text-amber-300 bg-amber-900/10";
                        dotClass = "bg-amber-400 animate-ping opacity-75"; // Radar effect
                    }

                    return `<div class="${baseClass} ${stateClass}" title="${t.status}: ${t.notes || ''}">
                        ${dotClass !== 'hidden' ? `<span class="relative flex h-1.5 w-1.5 shrink-0"><span class="absolute inline-flex h-full w-full rounded-full ${dotClass}"></span><span class="relative inline-flex rounded-full h-1.5 w-1.5 ${dotClass.replace('animate-pulse', '').replace('animate-ping opacity-75', '')} shadow-sm"></span></span>` : ''}
                        ${icon ? icon : ''}
                        <span class="truncate">${t.type}</span>
                    </div>`;
                }).join('');

                grid.innerHTML += `
                    <div id="cal-day-${dateStr}" class="calendar-day p-3 relative group flex flex-col cursor-pointer ${isToday ? 'is-today' : ''} ${isSelected ? 'is-selected' : ''}" onclick="viewDaySummary('${dateStr}')">
                        <div class="flex justify-between items-start mb-3">
                            <span class="day-number text-sm font-bold text-slate-500 transition-colors group-hover:text-white">${d}</span>
                            ${dayTasks.length > 0 ? `<span class="text-[9px] bg-slate-800 border border-slate-700 text-slate-400 px-1.5 py-0.5 rounded font-mono group-hover:bg-cyan-500/20 group-hover:border-cyan-500/50 group-hover:text-cyan-200 transition-colors shadow-inner">${dayTasks.length} Tarefa${dayTasks.length > 1 ? 's' : ''}</span>` : ''}
                        </div>
                        <div class="flex-grow overflow-y-auto calendar-cell-scroll pr-1" style="max-height: 80px;">
                            ${tasksHtml}
                        </div>
                    </div>`;
            }
        };

        // Fun√ß√£o Principal para Abrir o Resumo do Dia
        window.viewDaySummary = (dateStr) => {
            // Remove sele√ß√£o anterior
            if(currentSummaryDateStr) {
                const prev = document.getElementById(`cal-day-${currentSummaryDateStr}`);
                if(prev) prev.classList.remove('is-selected');
            }
            
            currentSummaryDateStr = dateStr;
            const container = document.getElementById('calendarSummary');
            const displayDate = document.getElementById('summaryDateDisplay');
            const selectedDate = new Date(dateStr + "T12:00:00"); // Fix fuso hor√°rio para exibi√ß√£o correta
            
            // Adiciona sele√ß√£o nova
            const current = document.getElementById(`cal-day-${dateStr}`);
            if(current) current.classList.add('is-selected');

            container.classList.remove('hidden');
            displayDate.textContent = selectedDate.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
            
            // Anima√ß√£o Curta de Carregamento Futurista
            const list = document.getElementById('summaryList');
            list.className = "flex justify-center items-center w-full py-16";
            list.innerHTML = `
                <div class="flex flex-col items-center">
                    <div class="relative w-12 h-12 mb-4">
                        <div class="absolute inset-0 border-2 border-cyan-500/20 rounded-full"></div>
                        <div class="absolute inset-0 border-2 border-cyan-500 rounded-full border-t-transparent animate-spin shadow-[0_0_15px_rgba(6,182,212,0.5)]" style="animation-duration: 0.8s;"></div>
                        <div class="absolute inset-0 flex items-center justify-center"><span class="w-1.5 h-1.5 bg-cyan-400 rounded-full shadow-[0_0_10px_#06b6d4] animate-pulse"></span></div>
                    </div>
                    <p class="text-cyan-400 font-mono text-[10px] uppercase tracking-[0.2em] animate-pulse">Sincronizando Agenda...</p>
                </div>
            `;
            
            container.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Delay curto de 350ms para dar a sensa√ß√£o de feedback do sistema sem lentid√£o
            setTimeout(() => {
                renderDaySummaryList();
            }, 350);
        };

        // Renderiza a lista com base na data atual selecionada e nos CHECKBOXES ativos
        window.renderDaySummaryList = () => {
            if (!currentSummaryDateStr) return;
            
            const list = document.getElementById('summaryList');
            const today = new Date();
            today.setHours(0,0,0,0);
            
            // Pega todos os valores de checkbox marcados
            const activeFilters = Array.from(document.querySelectorAll('input[name="taskFilter"]:checked')).map(cb => cb.value);

            let dayTasks = tasks.filter(t => t.date.startsWith(currentSummaryDateStr));
            dayTasks = dayTasks.filter(t => activeFilters.includes(t.status));
            dayTasks.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            list.innerHTML = '';

            if (dayTasks.length === 0) {
                list.className = "block w-full"; // Reset das classes para o estado vazio
                list.innerHTML = `
                <div class="flex flex-col items-center justify-center py-12 px-4 text-center bg-slate-900/50 rounded-xl border border-dashed border-slate-700">
                    <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-2 4l-2 2m0 0l-2-2m2 2V5" /></svg></div>
                    <p class="text-slate-400 font-medium">Sua agenda est√° limpa.</p>
                    <p class="text-xs text-slate-500 mt-1">Nenhuma tarefa atende aos filtros atuais para este dia.</p>
                </div>`;
            } else {
                list.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 relative z-10 animate-[slideUpFade_0.4s_ease-out]"; // Adicionado anima√ß√£o suave de entrada
                
                dayTasks.forEach(t => {
                    const client = clients.find(c => c.id === t.clientId);
                    const taskDate = new Date(t.date);
                    taskDate.setHours(0,0,0,0);
                    const isOverdue = (t.status === 'Pendente' || t.status === 'Em Andamento') && taskDate < today;
                    const clientColor = client?.color || '#3b82f6';
                    
                    let cardClass = "task-card-pending shadow-[0_0_15px_rgba(59,130,246,0.1)]";
                    let statusBadge = `<span class="px-2 py-0.5 rounded text-[9px] font-bold uppercase bg-blue-900/50 text-blue-300 border border-blue-500/50 flex items-center gap-1"><span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span></span> Pendente</span>`;
                    let titleStyle = "text-white";
                    
                    if (isOverdue) {
                        cardClass = "task-card-overdue shadow-[0_0_15px_rgba(239,68,68,0.15)]";
                        statusBadge = `<span class="px-2 py-0.5 rounded text-[9px] font-bold uppercase bg-red-900/80 text-red-300 border border-red-500/50 animate-pulse flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg> Atrasado</span>`;
                    } else if (t.status === 'Concluido') {
                        cardClass = "task-card-completed shadow-[0_0_15px_rgba(34,197,94,0.1)]";
                        statusBadge = `<span class="px-2 py-0.5 rounded text-[9px] font-bold uppercase bg-green-900/50 text-green-300 border border-green-500/50 flex items-center gap-1"><span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span></span> Conclu√≠do</span>`;
                        titleStyle = "text-green-400";
                    } else if (t.status === 'Em Andamento') {
                        cardClass = "task-card-progress shadow-[0_0_15px_rgba(234,179,8,0.1)]";
                        statusBadge = `<span class="px-2 py-0.5 rounded text-[9px] font-bold uppercase bg-yellow-900/50 text-yellow-300 border border-yellow-500/50 flex items-center gap-1"><span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-yellow-500"></span></span> Andamento</span>`;
                    }

                    list.innerHTML += `
                        <div class="${cardClass} rounded-xl p-5 flex flex-col justify-between hover:-translate-y-1 hover:shadow-xl transition-all duration-300 group">
                            <div>
                                <div class="flex justify-between items-start mb-3">
                                    <div class="flex flex-col gap-1.5">
                                        ${statusBadge}
                                        <span class="text-[10px] font-bold uppercase tracking-wider font-mono drop-shadow-md" style="color: ${clientColor}; text-shadow: 0 0 8px ${clientColor}80;">${client?.nome || 'Geral'}</span>
                                    </div>
                                    <span class="text-xs font-mono text-slate-500 bg-slate-900/80 px-2 py-1 rounded-md border border-slate-700/50">‚è±Ô∏è ${t.date.split('T')[1]}</span>
                                </div>
                                <h4 class="text-lg font-bold mb-2 ${titleStyle} group-hover:text-cyan-300 transition-colors">${t.type}</h4>
                                <div class="bg-slate-900/40 p-2.5 rounded-lg border border-slate-700/30">
                                    <p class="text-[11px] text-slate-400 italic line-clamp-2 leading-relaxed">${t.notes || 'Nenhuma observa√ß√£o detalhada para esta tarefa.'}</p>
                                </div>
                            </div>
                            
                            <div class="mt-4 pt-4 border-t border-slate-700/50 flex justify-end gap-2">
                                <button onclick="viewTaskDetails('${t.id}')" class="px-3 py-1.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg text-xs font-bold transition-colors border border-slate-600">Ver Infos</button>
                                ${t.status !== 'Concluido' ? `
                                <button onclick="updateTaskStatus('${t.id}', 'Concluido')" class="px-3 py-1.5 bg-gradient-to-r from-emerald-600 to-green-500 hover:from-emerald-500 hover:to-green-400 text-white rounded-lg text-xs font-bold transition-all shadow-lg hover:shadow-emerald-500/25 flex items-center gap-1 group-hover:scale-105">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg> Concluir
                                </button>` : ''}
                            </div>
                        </div>
                    `;
                });
            }
        };

        window.viewTaskDetails = (id) => { const t = tasks.find(item => item.id === id); if(!t) return; const cli = clients.find(c => c.id === t.clientId); const content = `<div class="p-4 bg-slate-950 rounded-lg space-y-3 text-sm text-gray-300 border border-slate-800"><p><strong>Cliente:</strong> <span class="text-white">${cli?.nome || 'N/A'}</span></p><p><strong>Tipo:</strong> <span class="text-cyan-400">${t.type}</span></p><p><strong>Data/Hora:</strong> ${new Date(t.date).toLocaleString('pt-BR')}</p><p><strong>Status:</strong> ${t.status}</p><hr class="border-slate-800 my-2"/><p class="text-xs text-gray-500 uppercase font-bold">Observa√ß√µes:</p><p class="text-gray-300 italic whitespace-pre-wrap bg-slate-900/50 p-3 rounded border border-slate-800">${t.notes || 'Sem descri√ß√£o.'}</p></div>`; document.getElementById('summaryModal').classList.remove('hidden'); document.getElementById('summaryModal').classList.add('flex'); document.getElementById('summaryTitle').textContent = "Detalhes da Tarefa"; document.getElementById('summaryContent').innerHTML = content; };
        
        window.renderTaskManagement = () => { 
            const board = document.getElementById('taskManagementBoard'); 
            if(!board) return; 
            board.innerHTML = ''; 
            
            const today = new Date();
            today.setHours(0,0,0,0);

            const columns = [
                { id: 'Pendente', title: 'Pendente', icon: '<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>', color: 'blue', glow: 'rgba(59,130,246,0.4)', text: 'text-blue-400' }, 
                { id: 'Em Andamento', title: 'Andamento', icon: '<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>', color: 'yellow', glow: 'rgba(234,179,8,0.4)', text: 'text-yellow-400' }, 
                { id: 'Concluido', title: 'Conclu√≠do', icon: '<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>', color: 'green', glow: 'rgba(34,197,94,0.4)', text: 'text-green-400' }
            ]; 

            columns.forEach(col => { 
                const columnTasks = tasks.filter(t => t.status === col.id); 
                if (col.id === 'Concluido') columnTasks.sort((a, b) => new Date(b.date) - new Date(a.date)); 
                else columnTasks.sort((a, b) => new Date(a.date) - new Date(b.date)); 
                
                board.innerHTML += `
                <div class="bg-slate-900/50 backdrop-blur-md p-5 rounded-2xl min-h-[500px] border border-slate-800 flex flex-col transition-all duration-300 relative overflow-hidden group/col" style="box-shadow: 0 -4px 20px -5px ${col.glow}, 0 10px 15px -3px rgba(0,0,0,0.5);">
                    <div class="absolute top-0 left-0 w-full h-1 bg-${col.color}-500 group-hover/col:h-1.5 transition-all"></div>
                    <h3 class="text-sm font-bold ${col.text} mb-6 flex justify-between items-center uppercase tracking-wider border-b border-slate-700/50 pb-3">
                        <span class="flex items-center gap-2 text-lg drop-shadow-md">
                            ${col.icon} ${col.title}
                        </span>
                        <span class="bg-slate-800 px-3 py-1 rounded-full text-white text-xs border border-${col.color}-500/30 font-mono shadow-[0_0_8px_${col.glow}]">${columnTasks.length}</span>
                    </h3>
                    
                    <div class="space-y-4 flex-grow custom-scrollbar overflow-y-auto pr-2 pb-4" style="max-height: 650px;">
                        ${columnTasks.map(t => { 
                            const cli = clients.find(c => c.id === t.clientId); 
                            const taskDate = new Date(t.date);
                            taskDate.setHours(0,0,0,0);
                            const isOverdue = (t.status === 'Pendente' || t.status === 'Em Andamento') && taskDate < today;
                            const clientColor = cli?.color || '#3b82f6';
                            
                            let cardClass = "task-card-pending shadow-[0_0_15px_rgba(59,130,246,0.1)]";
                            let statusLed = `<span class="relative flex h-2 w-2 shrink-0"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span></span>`;
                            let titleStyle = "text-white";
                            
                            if (isOverdue) {
                                cardClass = "task-card-overdue shadow-[0_0_15px_rgba(239,68,68,0.15)]";
                                statusLed = `<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-red-500 animate-pulse shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>`;
                            } else if (t.status === 'Concluido') {
                                cardClass = "task-card-completed shadow-[0_0_15px_rgba(34,197,94,0.1)]";
                                statusLed = `<span class="relative flex h-2 w-2 shrink-0"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span></span>`;
                                titleStyle = "text-green-400";
                            } else if (t.status === 'Em Andamento') {
                                cardClass = "task-card-progress shadow-[0_0_15px_rgba(234,179,8,0.1)]";
                                statusLed = `<span class="relative flex h-2 w-2 shrink-0"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-yellow-500"></span></span>`;
                            }

                            return `
                            <div class="${cardClass} rounded-xl p-4 flex flex-col hover:-translate-y-1 hover:shadow-xl transition-all duration-300 group bg-slate-800/80 backdrop-blur-sm relative">
                                
                                <!-- A√ß√µes R√°pidas (Hover) -->
                                <div class="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-all duration-300 bg-slate-900/95 rounded-lg p-1 border border-slate-700 shadow-lg z-20">
                                    <button onclick="viewTaskDetails('${t.id}')" class="p-1.5 text-slate-400 hover:text-cyan-400 hover:bg-slate-800 rounded transition-colors" title="Detalhes">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                                    </button>
                                    <button onclick="editTask('${t.id}')" class="p-1.5 text-slate-400 hover:text-indigo-400 hover:bg-slate-800 rounded transition-colors" title="Editar">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                                    </button>
                                    <button onclick="deleteTask('${t.id}')" class="p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-800 rounded transition-colors" title="Excluir">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                    </button>
                                </div>

                                <div class="flex justify-between items-start mb-2 pr-10">
                                    <div class="flex items-center gap-1.5 bg-slate-900/50 px-2 py-1 rounded-md border border-slate-700/50">
                                        ${statusLed}
                                        <span class="text-[9px] font-bold uppercase tracking-wider font-mono drop-shadow-md truncate max-w-[120px]" style="color: ${clientColor}; text-shadow: 0 0 8px ${clientColor}80;">${cli?.nome || 'Geral'}</span>
                                    </div>
                                    <span class="text-[10px] font-mono text-slate-500 flex items-center gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-4 10h.01M3 21h18a2 2 0 002-2V7a2 2 0 00-2-2H3a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                        ${new Date(t.date).toLocaleDateString('pt-BR', {day: '2-digit', month:'2-digit'})}
                                    </span>
                                </div>
                                
                                <h4 class="text-base font-bold mb-3 ${titleStyle} leading-tight">${t.type}</h4>
                                
                                <!-- Substitui√ß√£o do Select Nativo por Bot√µes Animados (Smart Pills) -->
                                <div class="mt-auto pt-3 border-t border-slate-700/50 flex gap-1 justify-between items-center bg-slate-900/40 p-1.5 rounded-lg relative z-10">
                                    <button onclick="updateTaskStatus('${t.id}', 'Pendente')" class="flex-1 py-1.5 text-[9px] font-bold uppercase tracking-wider rounded-md transition-all duration-300 ${t.status === 'Pendente' ? 'bg-blue-500/20 text-blue-400 border border-blue-500/50 shadow-[0_0_10px_rgba(59,130,246,0.3)]' : 'text-slate-500 hover:text-blue-300 hover:bg-slate-800'}">Pend</button>
                                    
                                    <button onclick="updateTaskStatus('${t.id}', 'Em Andamento')" class="flex-1 py-1.5 text-[9px] font-bold uppercase tracking-wider rounded-md transition-all duration-300 ${t.status === 'Em Andamento' ? 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/50 shadow-[0_0_10px_rgba(234,179,8,0.3)]' : 'text-slate-500 hover:text-yellow-300 hover:bg-slate-800'}">Fazendo</button>
                                    
                                    <button onclick="updateTaskStatus('${t.id}', 'Concluido')" class="flex-1 py-1.5 text-[9px] font-bold uppercase tracking-wider rounded-md transition-all duration-300 ${t.status === 'Concluido' ? 'bg-green-500/20 text-green-400 border border-green-500/50 shadow-[0_0_10px_rgba(34,197,94,0.3)]' : 'text-slate-500 hover:text-green-300 hover:bg-slate-800'}">Feito</button>
                                </div>
                            </div>`; 
                        }).join('')}
                    </div>
                </div>`; 
            }); 
            window.setupCustomSelects(); 
        };

        window.updateTaskStatus = async (id, s) => { await updateDoc(doc(db, 'users', userId, 'tasks', id), { status: s }); };
        window.populateClientSelects = () => { ['res_cliente', 'task_cliente', 'filterClient', 'report_cliente', 'report_social_cliente', 'results_filter_cliente', 'soc_cliente', 'social_filter_cliente', 'vid_cliente', 'vid_filter_cliente'].forEach(id => { const s = document.getElementById(id); if (!s) return; const current = s.value; s.innerHTML = id.includes('filter') || id.includes('report') ? '<option value="">Todos</option>' : '<option value="">Selecione...</option>'; const sortedClients = [...clients].sort((a, b) => a.nome.localeCompare(b.nome)); sortedClients.forEach(c => { const o = document.createElement('option'); o.value = c.id; o.textContent = c.nome; if (c.id === current) o.selected = true; s.appendChild(o); }); if (s.closest('.custom-select-wrapper')) { window.updateCustomSelect(s); } }); window.setupCustomSelects(); };
        window.maskPhone = (i) => { let v = i.value.replace(/\D/g, ''); v = v.replace(/^(\d{2})(\d)/g, '($1) $2'); v = v.replace(/(\d{5})(\d)/, '$1-$2'); i.value = v; };
        window.closeSummaryModal = () => document.getElementById('summaryModal').classList.add('hidden');

        // --- CHART.JS CONFIGURA√á√ïES GLOBAIS FUTURISTAS ---
        Chart.defaults.color = '#64748b'; // Slate 500
        Chart.defaults.font.family = "'Poppins', sans-serif";
        
        const futuristicTooltip = {
            backgroundColor: 'rgba(15, 23, 42, 0.95)',
            titleColor: '#22d3ee',
            bodyColor: '#f8fafc',
            borderColor: 'rgba(6, 182, 212, 0.4)',
            borderWidth: 1,
            padding: 12,
            boxPadding: 6,
            usePointStyle: true,
            titleFont: { size: 13, family: 'Poppins', weight: 'bold' },
            bodyFont: { size: 12, family: 'Poppins' },
            cornerRadius: 8,
            displayColors: true,
            callbacks: {
                labelColor: function(context) {
                    return { borderColor: context.dataset.borderColor, backgroundColor: context.dataset.backgroundColor };
                }
            }
        };

        const futuristicGridOptions = {
            color: 'rgba(51, 65, 85, 0.3)', // Slate 700 muito suave
            drawBorder: false,
            borderDash: [5, 5] // Linhas pontilhadas estilo sci-fi
        };

        // --- UPDATED REPORT GENERATION (High-End Charts) ---
        window.generateReport = () => {
            const cid = document.getElementById('report_cliente').value; const start = document.getElementById('report_start_date').value; const end = document.getElementById('report_end_date').value;
            let filtered = [...results]; 
            if(cid) filtered = filtered.filter(r => r.clientId === cid); 
            if(start) filtered = filtered.filter(r => r.data >= start); 
            if(end) filtered = filtered.filter(r => r.data <= end); 
            filtered.sort((a, b) => new Date(a.data) - new Date(b.data));
            
            const stats = filtered.reduce((acc, r) => { acc.gasto += r.investimento || 0; acc.vendas += r.vendas || 0; acc.conv += r.conversionCount || 0; acc.imp += r.impressoes || 0; acc.alcance += r.alcance || 0; acc.cliques += r.cliques || 0; return acc; }, { gasto: 0, vendas: 0, conv: 0, imp: 0, alcance: 0, cliques: 0 });
            window.lastTrafficStats = stats;
            
            const roas = stats.gasto > 0 ? stats.vendas / stats.gasto : 0;
            const cpa = stats.conv > 0 ? stats.gasto / stats.conv : 0;
            const ticketMedio = stats.conv > 0 ? stats.vendas / stats.conv : 0;
            const cpm = stats.imp > 0 ? (stats.gasto / stats.imp) * 1000 : 0;
            const cpc = stats.cliques > 0 ? stats.gasto / stats.cliques : 0;
            const ctr = stats.imp > 0 ? (stats.cliques / stats.imp) * 100 : 0;
            const freq = stats.alcance > 0 ? stats.imp / stats.alcance : 0;
            const convRate = stats.cliques > 0 ? (stats.conv / stats.cliques) * 100 : 0;

            const reportKpis = [
                { l: 'Faturamento', v: formatCurrency(stats.vendas), c: 'emerald' },
                { l: 'Gasto Ads', v: formatCurrency(stats.gasto), c: 'red' },
                { l: 'ROAS', v: roas.toFixed(2) + 'x', c: 'yellow' },
                { l: 'Ticket M√©dio', v: formatCurrency(ticketMedio), c: 'green' },
                { l: 'CPA M√©dio', v: formatCurrency(cpa), c: 'indigo' },
                { l: 'Convers√µes', v: formatCompact(stats.conv), c: 'teal' },
                { l: 'Taxa Conv.', v: convRate.toFixed(2) + '%', c: 'pink' },
                { l: 'Cliques', v: formatCompact(stats.cliques), c: 'orange' },
                { l: 'CTR M√©dio', v: ctr.toFixed(2) + '%', c: 'purple' },
                { l: 'CPC M√©dio', v: formatCurrency(cpc), c: 'cyan' },
                { l: 'Impress√µes', v: formatCompact(stats.imp), c: 'blue' }
            ];
            
            const aggCont = document.getElementById('reportSummaryAggregated');
            aggCont.innerHTML = reportKpis.map((k, i) => window.renderKpiCard(k.l, k.v, k.c, i)).join('');

            const labels = filtered.map(r => new Date(r.data + 'T12:00:00').toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit'})); 
            
            const dataGasto = filtered.map(r => r.investimento); 
            const dataVendas = filtered.map(r => r.vendas); 
            const dataImps = filtered.map(r => r.impressoes); 
            const dataCliques = filtered.map(r => r.cliques); 
            const dataRoas = filtered.map(r => (r.vendas / (r.investimento || 1)).toFixed(2));
            const dataCpa = filtered.map(r => r.conversionCount > 0 ? (r.investimento / r.conversionCount).toFixed(2) : 0);
            const dataConvRate = filtered.map(r => r.cliques > 0 ? ((r.conversionCount / r.cliques) * 100).toFixed(2) : 0);
            
            // --- GR√ÅFICO 1: Financeiro (√Årea com Gradiente) ---
            if(reportCharts.spend) reportCharts.spend.destroy(); 
            const ctxSpend = document.getElementById('spendRevenueChart').getContext('2d'); 
            
            let gradVendas = ctxSpend.createLinearGradient(0, 0, 0, 400);
            gradVendas.addColorStop(0, 'rgba(16, 185, 129, 0.4)'); // Emerald
            gradVendas.addColorStop(1, 'rgba(16, 185, 129, 0.0)');
            
            let gradGasto = ctxSpend.createLinearGradient(0, 0, 0, 400);
            gradGasto.addColorStop(0, 'rgba(239, 68, 68, 0.4)'); // Red
            gradGasto.addColorStop(1, 'rgba(239, 68, 68, 0.0)');

            reportCharts.spend = new Chart(ctxSpend, { 
                type: 'line',
                data: { 
                    labels, 
                    datasets: [ 
                        { 
                            label: 'Faturamento', 
                            data: dataVendas, 
                            borderColor: '#10B981', 
                            backgroundColor: gradVendas,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4, // Curvas suaves
                            pointBackgroundColor: '#0f172a',
                            pointBorderColor: '#10B981',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        { 
                            label: 'Gasto (Ads)', 
                            data: dataGasto, 
                            borderColor: '#EF4444', 
                            backgroundColor: gradGasto,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#0f172a',
                            pointBorderColor: '#EF4444',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        } 
                    ] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { 
                        legend: { position: 'top', labels: { usePointStyle: true, boxWidth: 8, font: {family: 'Poppins'} } },
                        tooltip: futuristicTooltip
                    }, 
                    scales: { 
                        y: { grid: futuristicGridOptions, beginAtZero: true }, 
                        x: { grid: { display: false } } 
                    } 
                } 
            });
            
            // --- GR√ÅFICO 2: ROAS (Linha Neon) ---
            if(reportCharts.roas) reportCharts.roas.destroy(); 
            const ctxRoas = document.getElementById('roasDailyChart').getContext('2d'); 
            
            let gradRoas = ctxRoas.createLinearGradient(0, 0, 0, 400);
            gradRoas.addColorStop(0, 'rgba(234, 179, 8, 0.3)'); // Yellow
            gradRoas.addColorStop(1, 'rgba(234, 179, 8, 0.0)');

            reportCharts.roas = new Chart(ctxRoas, { 
                type: 'line',
                data: { 
                    labels, 
                    datasets: [{ 
                        label: 'ROAS Di√°rio', 
                        data: dataRoas, 
                        borderColor: '#f59e0b', // Amber 500
                        backgroundColor: gradRoas,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: '#fef3c7', // Glowing dot
                        pointBorderColor: '#f59e0b',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 8,
                        shadowOffsetX: 0,
                        shadowOffsetY: 4,
                        shadowBlur: 10,
                        shadowColor: 'rgba(245, 158, 11, 0.5)' // Efeito Neon (se suportado ou visualizado via ctx)
                    }] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: futuristicTooltip
                    }, 
                    scales: { 
                        y: { grid: futuristicGridOptions, beginAtZero: true }, 
                        x: { grid: { display: false } } 
                    } 
                } 
            });

            // --- GR√ÅFICO 3: Efici√™ncia CPA vs Taxa Convers√£o (Misto) ---
            // Necess√°rio criar essa vari√°vel globalmente ou no escopo se n√£o existir
            if(window.cpaConvChartInstance) window.cpaConvChartInstance.destroy(); 
            const ctxCpa = document.getElementById('cpaConvChart').getContext('2d'); 
            
            window.cpaConvChartInstance = new Chart(ctxCpa, { 
                type: 'bar', 
                data: { 
                    labels, 
                    datasets: [ 
                        { 
                            label: 'Tx. de Convers√£o (%)', 
                            data: dataConvRate, 
                            type: 'line', 
                            borderColor: '#ec4899', // Pink
                            backgroundColor: 'rgba(236, 72, 153, 0.1)',
                            borderWidth: 2, 
                            tension: 0.4,
                            yAxisID: 'y1',
                            fill: true,
                            pointBackgroundColor: '#0f172a',
                            pointBorderColor: '#ec4899',
                            pointRadius: 4
                        },
                        { 
                            label: 'CPA (Custo Aquisi√ß√£o R$)', 
                            data: dataCpa, 
                            backgroundColor: 'rgba(99, 102, 241, 0.8)', // Indigo
                            borderRadius: 4,
                            barPercentage: 0.5,
                            yAxisID: 'y'
                        }
                    ] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { 
                        legend: { labels: { usePointStyle: true, font: {family: 'Poppins'} } },
                        tooltip: futuristicTooltip
                    }, 
                    scales: { 
                        y: { 
                            position: 'left', 
                            grid: futuristicGridOptions, 
                            title: { display: true, text: 'CPA (R$)', color: '#6366f1', font: {size: 10} }
                        }, 
                        y1: { 
                            position: 'right', 
                            grid: { drawOnChartArea: false }, 
                            title: { display: true, text: 'Convers√£o (%)', color: '#ec4899', font: {size: 10} }
                        }, 
                        x: { grid: { display: false } } 
                    } 
                } 
            });

            // --- GR√ÅFICO 4: Tr√°fego Impress√µes vs Cliques ---
            if(reportCharts.metrics) reportCharts.metrics.destroy(); 
            const ctxMetrics = document.getElementById('impressionsClicksChart').getContext('2d'); 
            
            let gradImps = ctxMetrics.createLinearGradient(0, 0, 0, 400);
            gradImps.addColorStop(0, 'rgba(6, 182, 212, 0.8)'); // Cyan
            gradImps.addColorStop(1, 'rgba(6, 182, 212, 0.2)');

            reportCharts.metrics = new Chart(ctxMetrics, { 
                type: 'bar', 
                data: { 
                    labels, 
                    datasets: [ 
                        { 
                            label: 'Cliques', 
                            data: dataCliques, 
                            type: 'line', 
                            borderColor: '#f97316', // Orange
                            borderWidth: 3, 
                            tension: 0.4,
                            yAxisID: 'y1',
                            pointBackgroundColor: '#f97316',
                            pointBorderColor: '#fff',
                            pointRadius: 4,
                            shadowOffsetX: 0, shadowOffsetY: 4, shadowBlur: 10, shadowColor: 'rgba(249, 115, 22, 0.5)'
                        },
                        { 
                            label: 'Impress√µes', 
                            data: dataImps, 
                            backgroundColor: gradImps, 
                            borderRadius: 6,
                            borderSkipped: false,
                            yAxisID: 'y' 
                        } 
                    ] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { 
                        legend: { labels: { usePointStyle: true, font: {family: 'Poppins'} } },
                        tooltip: futuristicTooltip
                    }, 
                    scales: { 
                        y: { 
                            position: 'left', 
                            grid: futuristicGridOptions,
                            ticks: { callback: function(value) { return formatCompact(value); } }
                        }, 
                        y1: { 
                            position: 'right', 
                            grid: { drawOnChartArea: false },
                            ticks: { callback: function(value) { return formatCompact(value); } }
                        }, 
                        x: { grid: { display: false } } 
                    } 
                } 
            });
        };

        window.generateSocialReport = () => {
            const cid = document.getElementById('report_social_cliente').value; const start = document.getElementById('report_social_start_date').value; const end = document.getElementById('report_social_end_date').value;
            let filtered = [...socialResults]; if(cid) filtered = filtered.filter(r => r.clientId === cid); if(start) filtered = filtered.filter(r => (r.dataFim || r.data) >= start); if(end) filtered = filtered.filter(r => (r.dataFim || r.data) <= end); filtered.sort((a, b) => new Date(a.dataFim || a.data) - new Date(b.dataFim || b.data));
            const totalNewFollowers = filtered.reduce((acc, r) => acc + (r.novosSeguidores || 0), 0); const totalReach = filtered.reduce((acc, r) => acc + (r.alcance || 0), 0); const totalImpressions = filtered.reduce((acc, r) => acc + (r.impressoes || 0), 0); const totalInteractions = filtered.reduce((acc, r) => acc + (r.interacoes || 0), 0); const avgEngagement = filtered.length > 0 ? (filtered.reduce((acc, r) => acc + (r.engagementRate || 0), 0) / filtered.length) : 0; const totalPosts = filtered.reduce((acc, r) => acc + (r.posts || 0), 0);
            
            // Salva globalmente para o WhatsApp
            window.lastSocialStats = {
                novosSeguidores: totalNewFollowers,
                engajamento: avgEngagement,
                alcance: totalReach,
                interacoes: totalInteractions,
                posts: totalPosts,
                impressoes: totalImpressions
            };

            const sRepKpis = [
                { l: 'Novos Seguidores', v: '+'+formatCompact(totalNewFollowers), c: 'green' },
                { l: 'Engajamento M√©dio', v: avgEngagement.toFixed(2)+'%', c: 'pink' },
                { l: 'Alcance Total', v: formatCompact(totalReach), c: 'cyan' },
                { l: 'Intera√ß√µes Totais', v: formatCompact(totalInteractions), c: 'yellow' },
                { l: 'Posts Publicados', v: totalPosts, c: 'teal' },
                { l: 'Impress√µes Totais', v: formatCompact(totalImpressions), c: 'indigo' }
            ];
            
            const sAggCont = document.getElementById('socialReportSummaryAggregated');
            sAggCont.className = "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8 text-white";
            sAggCont.innerHTML = sRepKpis.map((k, i) => window.renderKpiCard(k.l, k.v, k.c, i)).join('');
            
            const labels = filtered.map(r => { const d = r.dataFim || r.data; return new Date(d + 'T12:00:00').toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit'}); }); const dataTotalFollowers = filtered.map(r => r.seguidores); const dataNewFollowers = filtered.map(r => r.novosSeguidores); const dataReach = filtered.map(r => r.alcance); const dataInteractions = filtered.map(r => r.interacoes);
            if(socialReportCharts.growth) socialReportCharts.growth.destroy(); const ctxGrowth = document.getElementById('socialGrowthChart').getContext('2d'); socialReportCharts.growth = new Chart(ctxGrowth, { type: 'line', data: { labels: labels, datasets: [ { label: 'Total Seguidores', data: dataTotalFollowers, borderColor: '#ec4899', backgroundColor: 'rgba(236, 72, 153, 0.05)', fill: true, tension: 0.4, yAxisID: 'y' }, { label: 'Novos (Barras)', data: dataNewFollowers, type: 'bar', backgroundColor: '#4ade80', yAxisID: 'y1' } ] }, options: { responsive: true, plugins: { legend: { labels: { color: '#94a3b8' } } }, scales: { y: { position: 'left', grid: { color: '#1e293b' }, ticks: { color: '#ec4899' } }, y1: { position: 'right', grid: { drawOnChartArea: false }, ticks: { color: '#4ade80' } }, x: { grid: { color: '#1e293b' }, ticks: { color: '#64748b' } } } } });
            if(socialReportCharts.engagement) socialReportCharts.engagement.destroy(); const ctxEng = document.getElementById('socialEngagementChart').getContext('2d'); socialReportCharts.engagement = new Chart(ctxEng, { type: 'bar', data: { labels: labels, datasets: [ { label: 'Alcance', data: dataReach, backgroundColor: '#06b6d4', }, { label: 'Intera√ß√µes', data: dataInteractions, backgroundColor: '#fbbf24', } ] }, options: { responsive: true, plugins: { legend: { labels: { color: '#94a3b8' } } }, scales: { y: { grid: { color: '#1e293b' }, ticks: { color: '#64748b' } }, x: { grid: { display: false }, ticks: { color: '#64748b' } } } } });
        };

        // --- SISTEMA DE EXPORTA√á√ÉO DE IMAGEM (ALTA RESOLU√á√ÉO) ---
        window.exportMobile = async (elementId, filename) => { 
            const element = document.getElementById(elementId); 
            if(!element) return; 
            showMessage("Gerando formato Stories em Ultra HD..."); 
            
            const originalStyle = element.getAttribute('style') || ""; 
            const originalClass = element.className; 
            
            // Aplica a classe que formata o design para exporta√ß√£o
            element.classList.add('export-mobile'); 
            
            // For√ßa a renderiza√ß√£o otimizada de fontes no elemento pai
            element.style.textRendering = "optimizeLegibility";
            element.style.webkitFontSmoothing = "antialiased";
            
            // Aguarda o DOM e os gr√°ficos ajustarem o layout completamente 
            // (1.5s garante que as anima√ß√µes de resize do Chart.js terminem, evitando gr√°ficos borrados)
            await new Promise(r => setTimeout(r, 1500)); 
            
            try { 
                const canvas = await html2canvas(element, { 
                    scale: 3, // 3x Resolu√ß√£o garante nitidez absoluta (Ultra HD) e elimina fontes cerrilhadas
                    useCORS: true, 
                    allowTaint: true,
                    backgroundColor: '#020617', 
                    logging: false, 
                    windowWidth: 1080,
                    imageTimeout: 0, // Sem limite de tempo para renderizar os assets
                    onclone: (clonedDoc) => {
                        // Garante que o elemento clonado n√£o tenha transforma√ß√µes que causam sub-pixel blur
                        const clonedElement = clonedDoc.getElementById(elementId);
                        if(clonedElement) {
                            clonedElement.style.transform = 'none';
                        }
                    }
                }); 
                
                const link = document.createElement('a'); 
                link.download = `${filename}_MOBILE_${new Date().toISOString().split('T')[0]}.png`; 
                link.href = canvas.toDataURL('image/png', 1.0); // Compress√£o de Qualidade M√°xima (1.0)
                link.click(); 
                showMessage("Download Conclu√≠do! üì± Imagem perfeitamente n√≠tida."); 
            } catch (err) { 
                showMessage("Erro ao exportar. Tente novamente.", true); 
                console.error(err);
            } finally { 
                element.className = originalClass; 
                element.setAttribute('style', originalStyle); 
                // Restaura o tamanho dos gr√°ficos emitindo um evento de redimensionamento global
                window.dispatchEvent(new Event('resize')); 
            } 
        };
        window.exportReportMobile = () => window.exportMobile('report-export-container', 'relatorio_trafego_novan');
        window.exportSocialReportMobile = () => window.exportMobile('social-report-export-container', 'relatorio_social_novan');

        // --- SISTEMA DE COMPARTILHAMENTO WHATSAPP (TEXTO) ---
        window.shareWhatsAppTraffic = () => {
            if (!window.lastTrafficStats) { showMessage("Processe um relat√≥rio primeiro.", true); return; }
            
            const s = window.lastTrafficStats;
            const selectEl = document.getElementById('report_cliente');
            const clientName = selectEl.options[selectEl.selectedIndex].text;
            const dataInicio = document.getElementById('report_start_date').value ? new Date(document.getElementById('report_start_date').value + 'T12:00:00').toLocaleDateString('pt-BR') : 'In√≠cio';
            const dataFim = document.getElementById('report_end_date').value ? new Date(document.getElementById('report_end_date').value + 'T12:00:00').toLocaleDateString('pt-BR') : 'Hoje';
            
            const roas = s.gasto > 0 ? s.vendas / s.gasto : 0;
            const cpa = s.conv > 0 ? s.gasto / s.conv : 0;
            const ticketMedio = s.conv > 0 ? s.vendas / s.conv : 0;
            const ctr = s.imp > 0 ? (s.cliques / s.imp) * 100 : 0;
            
            let text = `üìä *Relat√≥rio de Performance Tr√°fego*\n`;
            text += `üè¢ *Ag√™ncia:* Novan Agency\n`;
            if(clientName !== "Todos os Clientes") text += `üë§ *Cliente:* ${clientName}\n`;
            text += `üìÖ *Per√≠odo:* ${dataInicio} at√© ${dataFim}\n\n`;
            
            text += `üí∞ *Resumo Financeiro*\n`;
            text += `‚ñ™Ô∏è *Investimento Ads:* ${formatCurrency(s.gasto)}\n`;
            text += `‚ñ™Ô∏è *Faturamento Bruto:* ${formatCurrency(s.vendas)}\n`;
            text += `‚ñ™Ô∏è *ROAS (Retorno):* ${roas.toFixed(2)}x\n`;
            text += `‚ñ™Ô∏è *Ticket M√©dio:* ${formatCurrency(ticketMedio)}\n\n`;
            
            text += `üéØ *M√©tricas de Convers√£o*\n`;
            text += `‚ñ™Ô∏è *Convers√µes Totais:* ${formatCompact(s.conv)}\n`;
            text += `‚ñ™Ô∏è *Custo por Aquisi√ß√£o (CPA):* ${formatCurrency(cpa)}\n`;
            text += `‚ñ™Ô∏è *Cliques Totais:* ${formatCompact(s.cliques)}\n`;
            text += `‚ñ™Ô∏è *CTR (Taxa de Clique):* ${ctr.toFixed(2)}%\n\n`;
            
            text += `üöÄ *Seguimos otimizando para escalar seus resultados!*`;
            
            window.open('https://api.whatsapp.com/send?text=' + encodeURIComponent(text), '_blank');
        };

        window.shareWhatsAppSocial = () => {
            if (!window.lastSocialStats) { showMessage("Processe um relat√≥rio primeiro.", true); return; }
            
            const s = window.lastSocialStats;
            const selectEl = document.getElementById('report_social_cliente');
            const clientName = selectEl.options[selectEl.selectedIndex].text;
            const dataInicio = document.getElementById('report_social_start_date').value ? new Date(document.getElementById('report_social_start_date').value + 'T12:00:00').toLocaleDateString('pt-BR') : 'In√≠cio';
            const dataFim = document.getElementById('report_social_end_date').value ? new Date(document.getElementById('report_social_end_date').value + 'T12:00:00').toLocaleDateString('pt-BR') : 'Hoje';
            
            let text = `üì± *Relat√≥rio de Performance Social*\n`;
            text += `üè¢ *Ag√™ncia:* Novan Agency\n`;
            if(clientName !== "Todos os Clientes") text += `üë§ *Cliente:* ${clientName}\n`;
            text += `üìÖ *Per√≠odo:* ${dataInicio} at√© ${dataFim}\n\n`;
            
            text += `üìà *Crescimento e Alcance*\n`;
            text += `‚ñ™Ô∏è *Novos Seguidores:* +${formatCompact(s.novosSeguidores)}\n`;
            text += `‚ñ™Ô∏è *Alcance de Contas:* ${formatCompact(s.alcance)}\n`;
            text += `‚ñ™Ô∏è *Impress√µes Totais:* ${formatCompact(s.impressoes)}\n\n`;
            
            text += `üíñ *Engajamento*\n`;
            text += `‚ñ™Ô∏è *Intera√ß√µes Totais:* ${formatCompact(s.interacoes)}\n`;
            text += `‚ñ™Ô∏è *Taxa M√©dia de Engajamento:* ${s.engajamento.toFixed(2)}%\n`;
            text += `‚ñ™Ô∏è *Conte√∫dos Publicados:* ${s.posts}\n\n`;
            
            text += `üöÄ *Construindo autoridade e audi√™ncia todos os dias!*`;
            
            window.open('https://api.whatsapp.com/send?text=' + encodeURIComponent(text), '_blank');
        };

        window.applyDateRange = (prefix, option) => {
            const startEl = document.getElementById(`${prefix}_start_date`);
            const endEl = document.getElementById(`${prefix}_end_date`);
            const today = new Date();
            const formatDate = (date) => date.toISOString().split('T')[0];
            
            let start = new Date(today);
            let end = new Date(today); // Padr√£o √© hoje

            if (option === 'custom') return;
            if (option === 'max') {
                startEl.value = "";
                endEl.value = "";
                return;
            }

            switch(option) {
                case 'today':
                    // In√≠cio e Fim j√° s√£o hoje
                    break;
                case 'yesterday':
                    start.setDate(today.getDate() - 1);
                    end.setDate(today.getDate() - 1);
                    break;
                case 'today_yesterday':
                    start.setDate(today.getDate() - 1);
                    // fim continua sendo hoje
                    break;
                case 'last_7':
                    start.setDate(today.getDate() - 6);
                    break;
                case 'last_14':
                    start.setDate(today.getDate() - 13);
                    break;
                case 'last_28':
                    start.setDate(today.getDate() - 27);
                    break;
                case 'last_30':
                    start.setDate(today.getDate() - 29);
                    break;
                case 'this_week':
                    // Assume Domingo como in√≠cio da semana
                    const day = today.getDay(); // 0 (Dom) a 6 (Sab)
                    const diff = today.getDate() - day;
                    start.setDate(diff);
                    break;
                case 'last_week':
                    // Semana passada (Dom a Sab)
                    const dayLast = today.getDay();
                    const endDiff = today.getDate() - dayLast - 1; // √öltimo S√°bado
                    const startDiff = today.getDate() - dayLast - 7; // Domingo anterior
                    end = new Date(today);
                    end.setDate(endDiff);
                    start = new Date(today);
                    start.setDate(startDiff);
                    break;
                case 'this_month':
                    start = new Date(today.getFullYear(), today.getMonth(), 1);
                    // fim √© hoje
                    break;
                case 'last_month':
                    start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    end = new Date(today.getFullYear(), today.getMonth(), 0); // √öltimo dia do m√™s passado
                    break;
            }
            
            startEl.value = formatDate(start);
            endEl.value = formatDate(end);
        };

        const forms = [
            { id: 'clientForm', handler: async (e) => { 
                e.preventDefault(); 
                const id = document.getElementById('cli_id_edit').value; 
                const type = document.getElementById('cli_service_type').value; 
                const data = { 
                    nome: document.getElementById('cli_nome').value, 
                    segmento: document.getElementById('cli_segmento').value, 
                    email: document.getElementById('cli_email').value, 
                    dataInicio: document.getElementById('cli_data_inicio').value, 
                    logo: document.getElementById('cli_logo').value, 
                    responsavel: document.getElementById('cli_responsavel').value, 
                    telefone: document.getElementById('cli_telefone').value, 
                    link: document.getElementById('cli_link').value, 
                    serviceType: type, 
                    observacoes: document.getElementById('cli_observacoes').value, 
                    active: true 
                }; 
                
                if(type === 'traffic') { 
                    data.plataformaTraffic = document.getElementById('cli_plataforma_traffic').value; 
                    data.budgetValueTraffic = parseFloat(document.getElementById('cli_budget_value_traffic').value) || 0; 
                    data.targetRoas = parseFloat(document.getElementById('cli_target_roas').value) || 0;
                    data.conversionGoalsTraffic = document.getElementById('cli_conversion_goals_traffic').value; 
                } else { 
                    data.smFee = parseFloat(document.getElementById('cli_sm_fee').value) || 0; 
                    data.targetFollowers = parseInt(document.getElementById('cli_target_followers').value) || 0;
                    data.smPlatform = document.getElementById('cli_sm_platform').value; 
                    data.smNeeds = document.getElementById('cli_sm_needs').value; 
                } 
                
                if(id) await updateDoc(doc(db, 'users', userId, 'clients', id), data); 
                else { data.color = `hsl(${Math.random() * 360}, 70%, 50%)`; await addDoc(clientsCollection, data); } 
                
                showMessage("Dossi√™ do Parceiro atualizado!"); 
                e.target.reset(); 
                document.getElementById('cli_id_edit').value = ""; 
                toggleFormCategory('traffic'); 
                toggleClientForm();
            }},
            { id: 'campaignForm', handler: async (e) => { 
                e.preventDefault(); 
                const id = document.getElementById('res_id_edit').value; 
                const inv = parseFloat(document.getElementById('res_investimento').value) || 0; 
                const fat = parseFloat(document.getElementById('res_vendas').value) || 0; 
                const conv = parseInt(document.getElementById('res_conversion_count').value) || 0; 
                const imps = parseInt(document.getElementById('res_impressoes').value) || 0; 
                const reach = parseInt(document.getElementById('res_alcance').value) || 0; 
                const clicks = parseInt(document.getElementById('res_cliques').value) || 0; 
                const dateType = document.querySelector('input[name="traffic_type_date"]:checked').value; 
                
                let dataInicio, dataFim; 
                if (dateType === 'daily') { 
                    const singleDate = document.getElementById('res_data').value; 
                    dataInicio = singleDate; 
                    dataFim = singleDate; 
                } else { 
                    dataInicio = document.getElementById('res_data_inicio').value; 
                    dataFim = document.getElementById('res_data_fim').value; 
                } 
                
                const data = { 
                    data: dataFim, 
                    dataInicio: dataInicio, 
                    dataFim: dataFim, 
                    clientId: document.getElementById('res_cliente').value, 
                    plataforma: document.getElementById('res_plataforma').value, 
                    campanha: document.getElementById('res_campanha').value, 
                    investimento: inv, 
                    vendas: fat, 
                    impressoes: imps, 
                    alcance: reach, 
                    cliques: clicks, 
                    conversionCount: conv, 
                    conversionType: document.getElementById('res_conversion_type').value, 
                    observacoes: document.getElementById('res_observacoes').value, 
                    roas: inv > 0 ? fat / inv : 0, 
                    cpa: conv > 0 ? inv / conv : 0, 
                    cpc: clicks > 0 ? inv / clicks : 0, 
                    ctr: imps > 0 ? (clicks / imps) * 100 : 0, 
                    frequency: reach > 0 ? imps / reach : 0, 
                    conversionRate: clicks > 0 ? (conv / clicks) * 100 : 0 
                }; 
                
                if(id) await updateDoc(doc(db, 'users', userId, 'results', id), data); 
                else await addDoc(resultsCollection, data); 
                
                showMessage("Tr√°fego salvo!"); 
                e.target.reset(); 
                document.getElementById('res_id_edit').value = ""; 
                toggleResultForm(); 
            }},
            { id: 'socialResultForm', handler: async (e) => { 
                e.preventDefault(); 
                const id = document.getElementById('soc_id_edit').value; 
                
                const alcance = parseInt(document.getElementById('soc_alcance').value) || 0; 
                const intBase = parseInt(document.getElementById('soc_interacoes').value) || 0; 
                const comp = parseInt(document.getElementById('soc_compartilhamentos').value) || 0; 
                const salv = parseInt(document.getElementById('soc_salvamentos').value) || 0; 
                
                const interacoesReais = intBase + comp + salv; // Engajamento profundo real

                const data = { 
                    dataInicio: document.getElementById('soc_data_inicio').value, 
                    dataFim: document.getElementById('soc_data_fim').value, 
                    data: document.getElementById('soc_data_fim').value, 
                    
                    clientId: document.getElementById('soc_cliente').value, 
                    plataforma: document.getElementById('soc_plataforma').value, 
                    
                    seguidores: parseInt(document.getElementById('soc_seguidores').value) || 0, 
                    novosSeguidores: parseInt(document.getElementById('soc_novos_seguidores').value) || 0, 
                    
                    alcance: alcance, 
                    impressoes: parseInt(document.getElementById('soc_impressoes').value) || 0, 
                    visitasPerfil: parseInt(document.getElementById('soc_visitas_perfil').value) || 0,
                    cliquesLink: parseInt(document.getElementById('soc_link_cliques').value) || 0,
                    
                    interacoes: intBase, 
                    compartilhamentos: comp,
                    salvamentos: salv,
                    
                    posts: parseInt(document.getElementById('soc_posts').value) || 0, 
                    sentimento: document.getElementById('soc_sentimento').value,

                    storiesViews: parseInt(document.getElementById('soc_stories_views').value) || 0, 
                    reelsViews: parseInt(document.getElementById('soc_reels_views').value) || 0, 
                    bestPost: document.getElementById('soc_best_post').value, 
                    
                    observacoes: document.getElementById('soc_observacoes').value, 
                    
                    engagementRate: alcance > 0 ? (interacoesReais / alcance) * 100 : 0 
                }; 
                
                if(id) await updateDoc(doc(db, 'users', userId, 'social_results', id), data); 
                else await addDoc(socialResultsCollection, data); 
                
                showMessage("Auditoria Social registrada!"); 
                e.target.reset(); 
                document.getElementById('soc_id_edit').value = ""; 
                toggleSocialResultForm(); 
            }},
            { id: 'videoForm', handler: async (e) => { 
                e.preventDefault(); 
                const id = document.getElementById('vid_id_edit').value; 
                const data = { 
                    clientId: document.getElementById('vid_cliente').value, 
                    dataEntrega: document.getElementById('vid_data').value, 
                    quantidade: parseInt(document.getElementById('vid_quantidade').value) || 0, 
                    formato: document.getElementById('vid_formato').value, 
                    linkDrive: document.getElementById('vid_link').value, 
                    status: document.getElementById('vid_status').value, 
                    observacoes: document.getElementById('vid_observacoes').value 
                }; 
                if(id) await updateDoc(doc(db, 'users', userId, 'videos', id), data); 
                else await addDoc(videosCollection, data); 
                showMessage("Registro de entrega salvo com sucesso!"); 
                e.target.reset(); 
                document.getElementById('vid_id_edit').value = ""; 
                toggleVideoForm(); 
            }},
            { id: 'taskForm', handler: async (e) => { 
                e.preventDefault(); 
                const id = document.getElementById('task_id_edit').value; 
                const data = { 
                    clientId: document.getElementById('task_cliente').value, 
                    type: document.getElementById('task_tipo').value, 
                    date: document.getElementById('task_data').value, 
                    status: document.getElementById('task_status').value, 
                    notes: document.getElementById('task_observacoes').value 
                }; 
                
                if(id) { 
                    await updateDoc(doc(db, 'users', userId, 'tasks', id), data); 
                    showMessage("Tarefa atualizada!"); 
                } else { 
                    await addDoc(tasksCollection, data); 
                    showMessage("Tarefa criada!"); 
                } 
                
                e.target.reset(); 
                document.getElementById('task_id_edit').value = ''; 
                document.getElementById('taskFormContainer').classList.add('hidden'); 
            }}
        ];

        forms.forEach(f => { const el = document.getElementById(f.id); if (el) el.addEventListener('submit', f.handler); });
        startMatrix();
    </script>
</body>
</html>